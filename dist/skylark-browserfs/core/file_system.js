/**
 * skylark-browserfs - A version of browserfs that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["../libs/buffers","./api_error","./file_flag","../libs/path","./util"],function(t,n,e,r,i){"use strict";const{ApiError:c,ErrorCode:s}=n,{FileFlag:l,ActionType:o}=e,{fail:a}=i;class h{supportsLinks(){return!1}diskSpace(t,n){n(0,0)}openFile(t,n,e){throw new c(s.ENOTSUP)}createFile(t,n,e,r){throw new c(s.ENOTSUP)}open(t,n,e,i){this.stat(t,!1,(l,h)=>{if(l)switch(n.pathNotExistsAction()){case o.CREATE_FILE:return this.stat(r.dirname(t),!1,(s,l)=>{s?i(s):l&&!l.isDirectory()?i(c.ENOTDIR(r.dirname(t))):this.createFile(t,n,e,i)});case o.THROW_EXCEPTION:return i(c.ENOENT(t));default:return i(new c(s.EINVAL,"Invalid FileFlag object."))}else{if(h&&h.isDirectory())return i(c.EISDIR(t));switch(n.pathExistsAction()){case o.THROW_EXCEPTION:return i(c.EEXIST(t));case o.TRUNCATE_FILE:return this.openFile(t,n,(t,n)=>{t?i(t):n?n.truncate(0,()=>{n.sync(()=>{i(null,n)})}):a()});case o.NOP:return this.openFile(t,n,i);default:return i(new c(s.EINVAL,"Invalid FileFlag object."))}}})}rename(t,n,e){e(new c(s.ENOTSUP))}renameSync(t,n){throw new c(s.ENOTSUP)}stat(t,n,e){e(new c(s.ENOTSUP))}statSync(t,n){throw new c(s.ENOTSUP)}openFileSync(t,n,e){throw new c(s.ENOTSUP)}createFileSync(t,n,e){throw new c(s.ENOTSUP)}openSync(t,n,e){let i;try{i=this.statSync(t,!1)}catch(i){switch(n.pathNotExistsAction()){case o.CREATE_FILE:if(!this.statSync(r.dirname(t),!1).isDirectory())throw c.ENOTDIR(r.dirname(t));return this.createFileSync(t,n,e);case o.THROW_EXCEPTION:throw c.ENOENT(t);default:throw new c(s.EINVAL,"Invalid FileFlag object.")}}if(i.isDirectory())throw c.EISDIR(t);switch(n.pathExistsAction()){case o.THROW_EXCEPTION:throw c.EEXIST(t);case o.TRUNCATE_FILE:return this.unlinkSync(t),this.createFileSync(t,n,i.mode);case o.NOP:return this.openFileSync(t,n,e);default:throw new c(s.EINVAL,"Invalid FileFlag object.")}}unlink(t,n){n(new c(s.ENOTSUP))}unlinkSync(t){throw new c(s.ENOTSUP)}rmdir(t,n){n(new c(s.ENOTSUP))}rmdirSync(t){throw new c(s.ENOTSUP)}mkdir(t,n,e){e(new c(s.ENOTSUP))}mkdirSync(t,n){throw new c(s.ENOTSUP)}readdir(t,n){n(new c(s.ENOTSUP))}readdirSync(t){throw new c(s.ENOTSUP)}exists(t,n){this.stat(t,null,function(t){n(!t)})}existsSync(t){try{return this.statSync(t,!0),!0}catch(t){return!1}}realpath(t,n,e){if(this.supportsLinks()){const n=t.split(r.sep);for(let t=0;t<n.length;t++){const e=n.slice(0,t+1);n[t]=r.join.apply(null,e)}}else this.exists(t,function(n){n?e(null,t):e(c.ENOENT(t))})}realpathSync(t,n){if(this.supportsLinks()){const n=t.split(r.sep);for(let t=0;t<n.length;t++){const e=n.slice(0,t+1);n[t]=r.join.apply(r,e)}return n.join(r.sep)}if(this.existsSync(t))return t;throw c.ENOENT(t)}truncate(t,n,e){this.open(t,l.getFileFlag("r+"),420,function(t,r){if(t)return e(t);r.truncate(n,function(t){r.close(function(n){e(t||n)})})})}truncateSync(t,n){const e=this.openSync(t,l.getFileFlag("r+"),420);try{e.truncateSync(n)}catch(t){throw t}finally{e.closeSync()}}readFile(t,n,e,r){const i=r;this.open(t,e,420,(t,e)=>{if(t)return r(t);r=function(t,n){e.close(function(e){return t||(t=e),i(t,n)})},e.stat((t,i)=>{if(t)return r(t);const c=Buffer.alloc(i.size);e.read(c,0,i.size,0,t=>{if(t)return r(t);if(null===n)return r(t,c);try{r(null,c.toString(n))}catch(t){r(t)}})})})}readFileSync(t,n,e){const r=this.openSync(t,e,420);try{const t=r.statSync(),e=Buffer.alloc(t.size);return r.readSync(e,0,t.size,0),r.closeSync(),null===n?e:e.toString(n)}finally{r.closeSync()}}writeFile(t,n,e,r,i,c){const s=c;this.open(t,r,420,function(t,r){if(t)return c(t);c=function(t){r.close(function(n){s(t||n)})};try{"string"==typeof n&&(n=Buffer.from(n,e))}catch(t){return c(t)}r.write(n,0,n.length,0,c)})}writeFileSync(t,n,e,r,i){const c=this.openSync(t,r,i);try{"string"==typeof n&&(n=Buffer.from(n,e)),c.writeSync(n,0,n.length,0)}finally{c.closeSync()}}appendFile(t,n,e,r,i,c){const s=c;this.open(t,r,i,function(t,r){if(t)return c(t);c=function(t){r.close(function(n){s(t||n)})},"string"==typeof n&&(n=Buffer.from(n,e)),r.write(n,0,n.length,null,c)})}appendFileSync(t,n,e,r,i){const c=this.openSync(t,r,i);try{"string"==typeof n&&(n=Buffer.from(n,e)),c.writeSync(n,0,n.length,null)}finally{c.closeSync()}}chmod(t,n,e,r){r(new c(s.ENOTSUP))}chmodSync(t,n,e){throw new c(s.ENOTSUP)}chown(t,n,e,r,i){i(new c(s.ENOTSUP))}chownSync(t,n,e,r){throw new c(s.ENOTSUP)}utimes(t,n,e,r){r(new c(s.ENOTSUP))}utimesSync(t,n,e){throw new c(s.ENOTSUP)}link(t,n,e){e(new c(s.ENOTSUP))}linkSync(t,n){throw new c(s.ENOTSUP)}symlink(t,n,e,r){r(new c(s.ENOTSUP))}symlinkSync(t,n,e){throw new c(s.ENOTSUP)}readlink(t,n){n(new c(s.ENOTSUP))}readlinkSync(t){throw new c(s.ENOTSUP)}}return{BaseFileSystem:h,SynchronousFileSystem:class extends h{supportsSynch(){return!0}rename(t,n,e){try{this.renameSync(t,n),e()}catch(t){e(t)}}stat(t,n,e){try{e(null,this.statSync(t,n))}catch(t){e(t)}}open(t,n,e,r){try{r(null,this.openSync(t,n,e))}catch(t){r(t)}}unlink(t,n){try{this.unlinkSync(t),n()}catch(t){n(t)}}rmdir(t,n){try{this.rmdirSync(t),n()}catch(t){n(t)}}mkdir(t,n,e){try{this.mkdirSync(t,n),e()}catch(t){e(t)}}readdir(t,n){try{n(null,this.readdirSync(t))}catch(t){n(t)}}chmod(t,n,e,r){try{this.chmodSync(t,n,e),r()}catch(t){r(t)}}chown(t,n,e,r,i){try{this.chownSync(t,n,e,r),i()}catch(t){i(t)}}utimes(t,n,e,r){try{this.utimesSync(t,n,e),r()}catch(t){r(t)}}link(t,n,e){try{this.linkSync(t,n),e()}catch(t){e(t)}}symlink(t,n,e,r){try{this.symlinkSync(t,n,e),r()}catch(t){r(t)}}readlink(t,n){try{n(null,this.readlinkSync(t))}catch(t){n(t)}}}}});
//# sourceMappingURL=../sourcemaps/core/file_system.js.map

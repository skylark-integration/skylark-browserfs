{"version":3,"sources":["generic/fetch.js"],"names":["define","api_error","ApiError","ErrorCode","fetchIsAvailable","fetch","fetchFileAsync","p","type","cb","request","e","EINVAL","message","then","res","ok","EIO","status","arrayBuffer","buf","Buffer","from","catch","err","json","fetchFileSizeAsync","method","parseInt","headers","get"],"mappings":";;;;;;;AAAAA,QAAQ,qBAAsB,SAAUC,GACpC,aAKA,MAAMC,SAAEA,EAAQC,UAAEA,GAAaF,EAwD/B,OACIG,iBAvDyC,oBAAZ,OAAqC,OAAVC,MAwDxDC,eAtDJ,SAAwBC,EAAGC,EAAMC,GAC7B,IAAIC,EACJ,IACIA,EAAUL,MAAME,GAEpB,MAAOI,GAEH,OAAOF,EAAG,IAAIP,EAASC,EAAUS,OAAQD,EAAEE,UAE/CH,EACKI,KAAMC,IACP,IAAKA,EAAIC,GACL,OAAOP,EAAG,IAAIP,EAASC,EAAUc,2CAA4CF,EAAIG,WAGjF,OAAQV,GACJ,IAAK,SACDO,EAAII,cACCL,KAAMM,GAAQX,EAAG,KAAMY,OAAOC,KAAKF,KACnCG,MAAOC,GAAQf,EAAG,IAAIP,EAASC,EAAUc,IAAKO,EAAIX,WACvD,MACJ,IAAK,OACDE,EAAIU,OACCX,KAAMW,GAAShB,EAAG,KAAMgB,IACxBF,MAAOC,GAAQf,EAAG,IAAIP,EAASC,EAAUc,IAAKO,EAAIX,WACvD,MACJ,QACIJ,EAAG,IAAIP,EAASC,EAAUS,OAAQ,0BAA4BJ,OAIzEe,MAAOC,GAAQf,EAAG,IAAIP,EAASC,EAAUc,IAAKO,EAAIX,YAwBvDa,mBAhBJ,SAA4BnB,EAAGE,GAC3BJ,MAAME,GAAKoB,OAAQ,SACdb,KAAMC,GACFA,EAAIC,GAIEP,EAAG,KAAMmB,SAASb,EAAIc,QAAQC,IAAI,mBAAqB,KAAM,KAH7DrB,EAAG,IAAIP,EAASC,EAAUc,gDAAiDF,EAAIG,YAMzFK,MAAOC,GAAQf,EAAG,IAAIP,EAASC,EAAUc,IAAKO,EAAIX","file":"../../generic/fetch.js","sourcesContent":["define(['../core/api_error'], function (api_error) {\n    'use strict';\n\n    /**\n     * Contains utility methods using 'fetch'.\n     */\n    const { ApiError, ErrorCode }= api_error;\n\n    const fetchIsAvailable = (typeof (fetch) !== \"undefined\" && fetch !== null);\n\n    function fetchFileAsync(p, type, cb) {\n        let request;\n        try {\n            request = fetch(p);\n        }\n        catch (e) {\n            // XXX: fetch will throw a TypeError if the URL has credentials in it\n            return cb(new ApiError(ErrorCode.EINVAL, e.message));\n        }\n        request\n            .then((res) => {\n            if (!res.ok) {\n                return cb(new ApiError(ErrorCode.EIO, `fetch error: response returned code ${res.status}`));\n            }\n            else {\n                switch (type) {\n                    case 'buffer':\n                        res.arrayBuffer()\n                            .then((buf) => cb(null, Buffer.from(buf)))\n                            .catch((err) => cb(new ApiError(ErrorCode.EIO, err.message)));\n                        break;\n                    case 'json':\n                        res.json()\n                            .then((json) => cb(null, json))\n                            .catch((err) => cb(new ApiError(ErrorCode.EIO, err.message)));\n                        break;\n                    default:\n                        cb(new ApiError(ErrorCode.EINVAL, \"Invalid download type: \" + type));\n                }\n            }\n        })\n            .catch((err) => cb(new ApiError(ErrorCode.EIO, err.message)));\n    }\n\n    /**\n     * Asynchronously retrieves the size of the given file in bytes.\n     * @hidden\n     */\n\n    function fetchFileSizeAsync(p, cb) {\n        fetch(p, { method: 'HEAD' })\n            .then((res) => {\n            if (!res.ok) {\n                return cb(new ApiError(ErrorCode.EIO, `fetch HEAD error: response returned code ${res.status}`));\n            }\n            else {\n                return cb(null, parseInt(res.headers.get('Content-Length') || '-1', 10));\n            }\n        })\n            .catch((err) => cb(new ApiError(ErrorCode.EIO, err.message)));\n    }\n\n    return {\n        fetchIsAvailable: fetchIsAvailable,\n        fetchFileAsync: fetchFileAsync,\n        fetchFileSizeAsync: fetchFileSizeAsync\n    };\n});"]}
{"version":3,"sources":["generic/inode.js"],"names":["define","buffers","node_fs_stats","Stats","FileType","Buffer","Inode","[object Object]","id","size","mode","atime","mtime","ctime","this","buffer","undefined","Error","toString","readUInt32LE","readUInt16LE","readDoubleLE","DIRECTORY","FILE","length","buff","alloc","getSize","writeUInt32LE","writeUInt16LE","writeDoubleLE","write","stats","hasChanged","atimeMs","getTime","mtimeMs","ctimeMs"],"mappings":";;;;;;;AAAAA,QACI,kBACA,yBACD,SAAUC,EAAQC,GACjB,aAEA,MAAOC,MAAEA,EAAKC,SAAEA,GAAaF,GACvBG,OAAEA,GAAWJ,QAKbK,EACFC,YAAYC,EAAIC,EAAMC,EAAMC,EAAOC,EAAOC,GACtCC,KAAKN,GAAKA,EACVM,KAAKL,KAAOA,EACZK,KAAKJ,KAAOA,EACZI,KAAKH,MAAQA,EACbG,KAAKF,MAAQA,EACbE,KAAKD,MAAQA,EAKjBN,kBAAkBQ,GACd,QAAeC,IAAXD,EACA,MAAM,IAAIE,MAAM,MAEpB,OAAO,IAAIX,EAAMS,EAAOG,SAAS,QAAS,IAAKH,EAAOI,aAAa,GAAIJ,EAAOK,aAAa,GAAIL,EAAOM,aAAa,GAAIN,EAAOM,aAAa,IAAKN,EAAOM,aAAa,KAKxKd,UACI,OAAO,IAAIJ,GAAmB,MAAZW,KAAKJ,QAAmBN,EAASkB,UAAYlB,EAASkB,UAAYlB,EAASmB,KAAMT,KAAKL,KAAMK,KAAKJ,KAAMI,KAAKH,MAAOG,KAAKF,MAAOE,KAAKD,OAK1JN,UAEI,OAAO,GAAKO,KAAKN,GAAGgB,OAKxBjB,SAASkB,EAAOpB,EAAOqB,MAAMZ,KAAKa,YAO9B,OANAF,EAAKG,cAAcd,KAAKL,KAAM,GAC9BgB,EAAKI,cAAcf,KAAKJ,KAAM,GAC9Be,EAAKK,cAAchB,KAAKH,MAAO,GAC/Bc,EAAKK,cAAchB,KAAKF,MAAO,IAC/Ba,EAAKK,cAAchB,KAAKD,MAAO,IAC/BY,EAAKM,MAAMjB,KAAKN,GAAI,GAAIM,KAAKN,GAAGgB,OAAQ,SACjCC,EAYXlB,OAAOyB,GACH,IAAIC,GAAa,EACbnB,KAAKL,OAASuB,EAAMvB,OACpBK,KAAKL,KAAOuB,EAAMvB,KAClBwB,GAAa,GAEbnB,KAAKJ,OAASsB,EAAMtB,OACpBI,KAAKJ,KAAOsB,EAAMtB,KAClBuB,GAAa,GAEjB,MAAMC,EAAUF,EAAMrB,MAAMwB,UACxBrB,KAAKH,QAAUuB,IACfpB,KAAKH,MAAQuB,EACbD,GAAa,GAEjB,MAAMG,EAAUJ,EAAMpB,MAAMuB,UACxBrB,KAAKF,QAAUwB,IACftB,KAAKF,MAAQwB,EACbH,GAAa,GAEjB,MAAMI,EAAUL,EAAMnB,MAAMsB,UAK5B,OAJIrB,KAAKD,QAAUwB,IACfvB,KAAKD,MAAQwB,EACbJ,GAAa,GAEVA,EAOX1B,SACI,OAAoB,MAAZO,KAAKJ,QAAmBN,EAASmB,KAK7ChB,cACI,OAAoB,MAAZO,KAAKJ,QAAmBN,EAASkB,WAKjD,OAAOhB","file":"../../generic/inode.js","sourcesContent":["define([\n    '../libs/buffers',\n    '../core/node_fs_stats'\n], function (buffers,node_fs_stats) {\n    'use strict';\n\n    const  { Stats, FileType } = node_fs_stats;\n    const { Buffer } = buffers;\n\n    /**\n     * Generic inode definition that can easily be serialized.\n     */\n    class Inode {\n        constructor(id, size, mode, atime, mtime, ctime) {\n            this.id = id;\n            this.size = size;\n            this.mode = mode;\n            this.atime = atime;\n            this.mtime = mtime;\n            this.ctime = ctime;\n        }\n        /**\n         * Converts the buffer into an Inode.\n         */\n        static fromBuffer(buffer) {\n            if (buffer === undefined) {\n                throw new Error(\"NO\");\n            }\n            return new Inode(buffer.toString('ascii', 30), buffer.readUInt32LE(0), buffer.readUInt16LE(4), buffer.readDoubleLE(6), buffer.readDoubleLE(14), buffer.readDoubleLE(22));\n        }\n        /**\n         * Handy function that converts the Inode to a Node Stats object.\n         */\n        toStats() {\n            return new Stats((this.mode & 0xF000) === FileType.DIRECTORY ? FileType.DIRECTORY : FileType.FILE, this.size, this.mode, this.atime, this.mtime, this.ctime);\n        }\n        /**\n         * Get the size of this Inode, in bytes.\n         */\n        getSize() {\n            // ASSUMPTION: ID is ASCII (1 byte per char).\n            return 30 + this.id.length;\n        }\n        /**\n         * Writes the inode into the start of the buffer.\n         */\n        toBuffer(buff = Buffer.alloc(this.getSize())) {\n            buff.writeUInt32LE(this.size, 0);\n            buff.writeUInt16LE(this.mode, 4);\n            buff.writeDoubleLE(this.atime, 6);\n            buff.writeDoubleLE(this.mtime, 14);\n            buff.writeDoubleLE(this.ctime, 22);\n            buff.write(this.id, 30, this.id.length, 'ascii');\n            return buff;\n        }\n        /**\n         * Updates the Inode using information from the stats object. Used by file\n         * systems at sync time, e.g.:\n         * - Program opens file and gets a File object.\n         * - Program mutates file. File object is responsible for maintaining\n         *   metadata changes locally -- typically in a Stats object.\n         * - Program closes file. File object's metadata changes are synced with the\n         *   file system.\n         * @return True if any changes have occurred.\n         */\n        update(stats) {\n            let hasChanged = false;\n            if (this.size !== stats.size) {\n                this.size = stats.size;\n                hasChanged = true;\n            }\n            if (this.mode !== stats.mode) {\n                this.mode = stats.mode;\n                hasChanged = true;\n            }\n            const atimeMs = stats.atime.getTime();\n            if (this.atime !== atimeMs) {\n                this.atime = atimeMs;\n                hasChanged = true;\n            }\n            const mtimeMs = stats.mtime.getTime();\n            if (this.mtime !== mtimeMs) {\n                this.mtime = mtimeMs;\n                hasChanged = true;\n            }\n            const ctimeMs = stats.ctime.getTime();\n            if (this.ctime !== ctimeMs) {\n                this.ctime = ctimeMs;\n                hasChanged = true;\n            }\n            return hasChanged;\n        }\n        // XXX: Copied from Stats. Should reconcile these two into something more\n        //      compact.\n        /**\n         * @return [Boolean] True if this item is a file.\n         */\n        isFile() {\n            return (this.mode & 0xF000) === FileType.FILE;\n        }\n        /**\n         * @return [Boolean] True if this item is a directory.\n         */\n        isDirectory() {\n            return (this.mode & 0xF000) === FileType.DIRECTORY;\n        }\n    }\n\n\n    return Inode;\n});"]}
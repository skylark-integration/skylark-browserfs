{"version":3,"sources":["core/node_fs_stats.js"],"names":["define","buffers","Buffer","FileType","Stats","[object Object]","itemType","size","mode","atimeMs","mtimeMs","ctimeMs","birthtimeMs","this","dev","ino","rdev","nlink","blksize","uid","gid","fileData","currentTime","Date","now","FILE","DIRECTORY","blocks","Math","ceil","buffer","readUInt32LE","atime","readDoubleLE","mtime","ctime","s","birthtime","alloc","writeUInt32LE","writeDoubleLE","getTime","SYMLINK"],"mappings":";;;;;;;AAAAA,QACI,mBACF,SAAUC,GACR,aACA,MAAMC,OAAEA,GAAWD,EAKnB,IAAIE,GACJ,SAAWA,GACPA,EAASA,EAAe,KAAI,OAAS,OACrCA,EAASA,EAAoB,UAAI,OAAS,YAC1CA,EAASA,EAAkB,QAAI,OAAS,UAH5C,CAIGA,IAAaA,aASVC,EAYFC,YAAYC,EAAUC,EAAMC,EAAMC,EAASC,EAASC,EAASC,GAOzDC,KAAKC,IAAM,EAEXD,KAAKE,IAAM,EAEXF,KAAKG,KAAO,EAEZH,KAAKI,MAAQ,EAEbJ,KAAKK,QAAU,KAGfL,KAAKM,IAAM,EAEXN,KAAKO,IAAM,EAEXP,KAAKQ,SAAW,KAChBR,KAAKN,KAAOA,EACZ,IAAIe,EAAc,EA2BlB,GA1ByB,iBAAd,IAEPb,EADAa,EAAcC,KAAKC,OAGE,iBAAd,IACFF,IACDA,EAAcC,KAAKC,OAEvBd,EAAUY,GAEW,iBAAd,IACFA,IACDA,EAAcC,KAAKC,OAEvBb,EAAUW,GAEe,iBAAlB,IACFA,IACDA,EAAcC,KAAKC,OAEvBZ,EAAcU,GAElBT,KAAKJ,QAAUA,EACfI,KAAKF,QAAUA,EACfE,KAAKH,QAAUA,EACfG,KAAKD,YAAcA,EACdJ,EAWDK,KAAKL,KAAOA,OAVZ,OAAQF,GACJ,KAAKH,EAASsB,KACVZ,KAAKL,KAAO,IACZ,MACJ,KAAKL,EAASuB,UACd,QACIb,KAAKL,KAAO,IAOxBK,KAAKc,OAASC,KAAKC,KAAKtB,EAAO,KAG3BM,KAAKL,KAAO,OACZK,KAAKL,MAAQF,GAGrBD,kBAAkByB,GACd,MAAMvB,EAAOuB,EAAOC,aAAa,GAAIvB,EAAOsB,EAAOC,aAAa,GAAIC,EAAQF,EAAOG,aAAa,GAAIC,EAAQJ,EAAOG,aAAa,IAAKE,EAAQL,EAAOG,aAAa,IACjK,OAAO,IAAI7B,EAAa,MAAPI,EAAeD,EAAa,KAAPC,EAAcwB,EAAOE,EAAOC,GAKtE9B,aAAa+B,GACT,OAAO,IAAIhC,EAAe,MAATgC,EAAE5B,KAAe4B,EAAE7B,KAAe,KAAT6B,EAAE5B,KAAc4B,EAAE3B,QAAS2B,EAAE1B,QAAS0B,EAAEzB,QAASyB,EAAExB,aAEjGoB,YACI,OAAO,IAAIT,KAAKV,KAAKJ,SAEzByB,YACI,OAAO,IAAIX,KAAKV,KAAKH,SAEzByB,YACI,OAAO,IAAIZ,KAAKV,KAAKF,SAEzB0B,gBACI,OAAO,IAAId,KAAKV,KAAKD,aAEzBP,WACI,MAAMyB,EAAS5B,EAAOoC,MAAM,IAM5B,OALAR,EAAOS,cAAc1B,KAAKN,KAAM,GAChCuB,EAAOS,cAAc1B,KAAKL,KAAM,GAChCsB,EAAOU,cAAc3B,KAAKmB,MAAMS,UAAW,GAC3CX,EAAOU,cAAc3B,KAAKqB,MAAMO,UAAW,IAC3CX,EAAOU,cAAc3B,KAAKsB,MAAMM,UAAW,IACpCX,EAKXzB,SACI,OAAoB,MAAZQ,KAAKL,QAAmBL,EAASsB,KAK7CpB,cACI,OAAoB,MAAZQ,KAAKL,QAAmBL,EAASuB,UAK7CrB,iBACI,OAAoB,MAAZQ,KAAKL,QAAmBL,EAASuC,QAM7CrC,MAAMG,GACFK,KAAKL,KAAoB,MAAZK,KAAKL,KAAiBA,EAGvCH,WACI,OAAO,EAEXA,gBACI,OAAO,EAEXA,oBACI,OAAO,EAEXA,SACI,OAAO,GAKf,OACIF,SAAAA,EACAC,MAAAA","file":"../../core/node_fs_stats.js","sourcesContent":["define([\n    '../libs/buffers'\n],function (buffers) {\n    'use strict';\n    const { Buffer } = buffers;\n\n    /**\n     * Indicates the type of the given file. Applied to 'mode'.\n     */\n    var FileType;\n    (function (FileType) {\n        FileType[FileType[\"FILE\"] = 32768] = \"FILE\";\n        FileType[FileType[\"DIRECTORY\"] = 16384] = \"DIRECTORY\";\n        FileType[FileType[\"SYMLINK\"] = 40960] = \"SYMLINK\";\n    })(FileType || (FileType = {}));\n\n    /**\n     * Emulation of Node's `fs.Stats` object.\n     *\n     * Attribute descriptions are from `man 2 stat'\n     * @see http://nodejs.org/api/fs.html#fs_class_fs_stats\n     * @see http://man7.org/linux/man-pages/man2/stat.2.html\n     */\n    class Stats {\n        /**\n         * Provides information about a particular entry in the file system.\n         * @param itemType Type of the item (FILE, DIRECTORY, SYMLINK, or SOCKET)\n         * @param size Size of the item in bytes. For directories/symlinks,\n         *   this is normally the size of the struct that represents the item.\n         * @param mode Unix-style file mode (e.g. 0o644)\n         * @param atimeMs time of last access, in milliseconds since epoch\n         * @param mtimeMs time of last modification, in milliseconds since epoch\n         * @param ctimeMs time of last time file status was changed, in milliseconds since epoch\n         * @param birthtimeMs time of file creation, in milliseconds since epoch\n         */\n        constructor(itemType, size, mode, atimeMs, mtimeMs, ctimeMs, birthtimeMs) {\n            /**\n             * UNSUPPORTED ATTRIBUTES\n             * I assume no one is going to need these details, although we could fake\n             * appropriate values if need be.\n             */\n            // ID of device containing file\n            this.dev = 0;\n            // inode number\n            this.ino = 0;\n            // device ID (if special file)\n            this.rdev = 0;\n            // number of hard links\n            this.nlink = 1;\n            // blocksize for file system I/O\n            this.blksize = 4096;\n            // @todo Maybe support these? atm, it's a one-user filesystem.\n            // user ID of owner\n            this.uid = 0;\n            // group ID of owner\n            this.gid = 0;\n            // XXX: Some file systems stash data on stats objects.\n            this.fileData = null;\n            this.size = size;\n            let currentTime = 0;\n            if (typeof (atimeMs) !== 'number') {\n                currentTime = Date.now();\n                atimeMs = currentTime;\n            }\n            if (typeof (mtimeMs) !== 'number') {\n                if (!currentTime) {\n                    currentTime = Date.now();\n                }\n                mtimeMs = currentTime;\n            }\n            if (typeof (ctimeMs) !== 'number') {\n                if (!currentTime) {\n                    currentTime = Date.now();\n                }\n                ctimeMs = currentTime;\n            }\n            if (typeof (birthtimeMs) !== 'number') {\n                if (!currentTime) {\n                    currentTime = Date.now();\n                }\n                birthtimeMs = currentTime;\n            }\n            this.atimeMs = atimeMs;\n            this.ctimeMs = ctimeMs;\n            this.mtimeMs = mtimeMs;\n            this.birthtimeMs = birthtimeMs;\n            if (!mode) {\n                switch (itemType) {\n                    case FileType.FILE:\n                        this.mode = 0x1a4;\n                        break;\n                    case FileType.DIRECTORY:\n                    default:\n                        this.mode = 0x1ff;\n                }\n            }\n            else {\n                this.mode = mode;\n            }\n            // number of 512B blocks allocated\n            this.blocks = Math.ceil(size / 512);\n            // Check if mode also includes top-most bits, which indicate the file's\n            // type.\n            if (this.mode < 0x1000) {\n                this.mode |= itemType;\n            }\n        }\n        static fromBuffer(buffer) {\n            const size = buffer.readUInt32LE(0), mode = buffer.readUInt32LE(4), atime = buffer.readDoubleLE(8), mtime = buffer.readDoubleLE(16), ctime = buffer.readDoubleLE(24);\n            return new Stats(mode & 0xF000, size, mode & 0xFFF, atime, mtime, ctime);\n        }\n        /**\n         * Clones the stats object.\n         */\n        static clone(s) {\n            return new Stats(s.mode & 0xF000, s.size, s.mode & 0xFFF, s.atimeMs, s.mtimeMs, s.ctimeMs, s.birthtimeMs);\n        }\n        get atime() {\n            return new Date(this.atimeMs);\n        }\n        get mtime() {\n            return new Date(this.mtimeMs);\n        }\n        get ctime() {\n            return new Date(this.ctimeMs);\n        }\n        get birthtime() {\n            return new Date(this.birthtimeMs);\n        }\n        toBuffer() {\n            const buffer = Buffer.alloc(32);\n            buffer.writeUInt32LE(this.size, 0);\n            buffer.writeUInt32LE(this.mode, 4);\n            buffer.writeDoubleLE(this.atime.getTime(), 8);\n            buffer.writeDoubleLE(this.mtime.getTime(), 16);\n            buffer.writeDoubleLE(this.ctime.getTime(), 24);\n            return buffer;\n        }\n        /**\n         * @return [Boolean] True if this item is a file.\n         */\n        isFile() {\n            return (this.mode & 0xF000) === FileType.FILE;\n        }\n        /**\n         * @return [Boolean] True if this item is a directory.\n         */\n        isDirectory() {\n            return (this.mode & 0xF000) === FileType.DIRECTORY;\n        }\n        /**\n         * @return [Boolean] True if this item is a symbolic link (only valid through lstat)\n         */\n        isSymbolicLink() {\n            return (this.mode & 0xF000) === FileType.SYMLINK;\n        }\n        /**\n         * Change the mode of the file. We use this helper function to prevent messing\n         * up the type of the file, which is encoded in mode.\n         */\n        chmod(mode) {\n            this.mode = (this.mode & 0xF000) | mode;\n        }\n        // We don't support the following types of files.\n        isSocket() {\n            return false;\n        }\n        isBlockDevice() {\n            return false;\n        }\n        isCharacterDevice() {\n            return false;\n        }\n        isFIFO() {\n            return false;\n        }\n    }\n\n\n    return {\n        FileType,\n        Stats\n    }\n});"]}
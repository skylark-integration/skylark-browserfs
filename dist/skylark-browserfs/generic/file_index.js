/**
 * skylark-browserfs - A version of browserfs that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["../core/node_fs_stats","../libs/path"],function(t,e){"use strict";const{Stats:s,FileType:i}=t;class n{constructor(){this._index={},this.addPath("/",new o)}static fromListing(t){const e=new n,d=new o;e._index["/"]=d;const a=[["",t,d]];for(;a.length>0;){let t;const n=a.pop(),d=n[0],h=n[1],l=n[2];for(const n in h)if(h.hasOwnProperty(n)){const u=h[n],c=`${d}/${n}`;u?(e._index[c]=t=new o,a.push([c,u,t])):t=new r(new s(i.FILE,-1,365)),l&&(l._ls[n]=t)}}return e}fileIterator(t){for(const e in this._index)if(this._index.hasOwnProperty(e)){const s=this._index[e],i=s.getListing();for(const e of i){const i=s.getItem(e);d(i)&&t(i.getData())}}}addPath(t,e){if(!e)throw new Error("Inode must be specified");if("/"!==t[0])throw new Error("Path must be absolute, got: "+t);if(this._index.hasOwnProperty(t))return this._index[t]===e;const s=this._split_path(t),i=s[0],n=s[1];let r=this._index[i];return!(void 0===r&&"/"!==t&&(r=new o,!this.addPath(i,r)))&&(!("/"!==t&&!r.addItem(n,e))&&(a(e)&&(this._index[t]=e),!0))}addPathFast(t,e){const s=t.lastIndexOf("/"),i=0===s?"/":t.substring(0,s),n=t.substring(s+1);let r=this._index[i];return void 0===r&&(r=new o,this.addPathFast(i,r)),!!r.addItem(n,e)&&(e.isDir()&&(this._index[t]=e),!0)}removePath(t){const e=this._split_path(t),s=e[0],i=e[1],n=this._index[s];if(void 0===n)return null;const r=n.remItem(i);if(null===r)return null;if(a(r)){const e=r.getListing();for(const s of e)this.removePath(t+"/"+s);"/"!==t&&delete this._index[t]}return r}ls(t){const e=this._index[t];return void 0===e?null:e.getListing()}getInode(t){const e=this._split_path(t),s=e[0],i=e[1],n=this._index[s];return void 0===n?null:s===t?n:n.getItem(i)}_split_path(t){const s=e.dirname(t);return[s,t.substr(s.length+("/"===s?0:1))]}}class r{constructor(t){this.data=t}isFile(){return!0}isDir(){return!1}getData(){return this.data}setData(t){this.data=t}}class o{constructor(t=null){this.data=t,this._ls={}}isFile(){return!1}isDir(){return!0}getData(){return this.data}getStats(){return new s(i.DIRECTORY,4096,365)}getListing(){return Object.keys(this._ls)}getItem(t){const e=this._ls[t];return e||null}addItem(t,e){return!(t in this._ls)&&(this._ls[t]=e,!0)}remItem(t){const e=this._ls[t];return void 0===e?null:(delete this._ls[t],e)}}function d(t){return!!t&&t.isFile()}function a(t){return!!t&&t.isDir()}return{FileIndex:n,FileInode:r,DirInode:o,isFileInode:d,isDirInode:a}});
//# sourceMappingURL=../sourcemaps/generic/file_index.js.map

/**
 * skylark-browserfs - A version of browserfs that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["../libs/buffers","../core/util","../core/api_error"],function(e,t,n){"use strict";const{isIE:r,emptyBuffer:s}=t,{ApiError:o,ErrorCode:a}=n,{Buffer:u}=e;function c(e,t,n){const r=new XMLHttpRequest;r.open("HEAD",t,e),r.onreadystatechange=function(e){if(4===r.readyState){if(200!==r.status)return n(new o(a.EIO,`XHR HEAD error: response returned code ${r.status}`));try{return n(null,parseInt(r.getResponseHeader("Content-Length")||"-1",10))}catch(e){return n(new o(a.EIO,"XHR HEAD error: Could not read content-length."))}}},r.send()}return{xhrIsAvailable:"undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest,asyncDownloadFile:function(e,t,n){const r=new XMLHttpRequest;r.open("GET",e,!0);let c=!0;switch(t){case"buffer":r.responseType="arraybuffer";break;case"json":try{r.responseType="json",c="json"===r.responseType}catch(e){c=!1}break;default:return n(new o(a.EINVAL,"Invalid download type: "+t))}r.onreadystatechange=function(e){if(4===r.readyState){if(200!==r.status)return n(new o(a.EIO,`XHR error: response returned code ${r.status}`));switch(t){case"buffer":return n(null,r.response?u.from(r.response):s());case"json":return n(null,c?r.response:JSON.parse(r.responseText))}}},r.send()},syncDownloadFile:r&&"undefined"!=typeof Blob?function(e,t){const n=new XMLHttpRequest;switch(n.open("GET",e,!1),t){case"buffer":n.responseType="arraybuffer";break;case"json":break;default:throw new o(a.EINVAL,"Invalid download type: "+t)}let r,s;if(n.onreadystatechange=function(e){if(4===n.readyState)if(200===n.status)switch(t){case"buffer":r=u.from(n.response);break;case"json":r=JSON.parse(n.response)}else s=new o(a.EIO,`XHR error: response returned code ${n.status}`)},n.send(),s)throw s;return r}:function(e,t){const n=new XMLHttpRequest;n.open("GET",e,!1);let r=null,s=null;if(n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(e){if(4===n.readyState){if(200!==n.status)return void(s=new o(a.EIO,`XHR error: response returned code ${n.status}`));switch(t){case"buffer":const e=n.responseText;r=u.alloc(e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return;case"json":return void(r=JSON.parse(n.responseText))}}},n.send(),s)throw s;return r},getFileSizeSync:function(e){let t=-1;return c(!1,e,function(e,n){if(e)throw e;t=n}),t},getFileSizeAsync:function(e,t){c(!0,e,t)}}});
//# sourceMappingURL=../sourcemaps/generic/xhr.js.map

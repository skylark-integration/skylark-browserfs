/**
 * skylark-browserfs - A version of browserfs that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
!function(t,e){var r=e.define,require=e.require,i="function"==typeof r&&r.amd,n=!i&&"undefined"!=typeof exports;if(!i&&!r){var s={};r=e.define=function(t,e,r){"function"==typeof r?(s[t]={factory:r,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var r=e.split("/"),i=t.split("/");r.pop();for(var n=0;n<i.length;n++)"."!=i[n]&&(".."==i[n]?r.pop():r.push(i[n]));return r.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):s[t]={factory:null,resolved:!0,exports:r}},require=e.require=function(t){if(!s.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=s[t];if(!module.resolved){var r=[];module.deps.forEach(function(t){r.push(require(t))}),module.exports=module.factory.apply(e,r)||null,module.resolved=!0}return module.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-browserfs/libs/process",[],function(){var t,e,r={};function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{e="function"==typeof clearTimeout?clearTimeout:n}catch(t){e=n}}();var o,a=[],c=!1,h=-1;function l(){c&&o&&(c=!1,o.length?a=o.concat(a):h=-1,a.length&&u())}function u(){if(!c){var t=s(l);c=!0;for(var r=a.length;r;){for(o=a,a=[];++h<r;)o&&o[h].run();h=-1,r=a.length}o=null,c=!1,function(t){if(e===clearTimeout)return clearTimeout(t);if((e===n||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{e(t)}catch(r){try{return e.call(null,t)}catch(r){return e.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function d(){}return r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];a.push(new f(t,e)),1!==a.length||c||s(u)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0},r}),t("skylark-browserfs/libs/base64",[],function(){"use strict";for(var exports={byteLength:function(t){var e=o(t),r=e[0],i=e[1];return 3*(r+i)/4-i},toByteArray:function(t){var i,n,s=o(t),a=s[0],c=s[1],h=new r(function(t,e,r){return 3*(e+r)/4-r}(0,a,c)),l=0,u=c>0?a-4:a;for(n=0;n<u;n+=4)i=e[t.charCodeAt(n)]<<18|e[t.charCodeAt(n+1)]<<12|e[t.charCodeAt(n+2)]<<6|e[t.charCodeAt(n+3)],h[l++]=i>>16&255,h[l++]=i>>8&255,h[l++]=255&i;2===c&&(i=e[t.charCodeAt(n)]<<2|e[t.charCodeAt(n+1)]>>4,h[l++]=255&i);1===c&&(i=e[t.charCodeAt(n)]<<10|e[t.charCodeAt(n+1)]<<4|e[t.charCodeAt(n+2)]>>2,h[l++]=i>>8&255,h[l++]=255&i);return h},fromByteArray:function(e){for(var r,i=e.length,n=i%3,s=[],o=0,c=i-n;o<c;o+=16383)s.push(a(e,o,o+16383>c?c:o+16383));1===n?(r=e[i-1],s.push(t[r>>2]+t[r<<4&63]+"==")):2===n&&(r=(e[i-2]<<8)+e[i-1],s.push(t[r>>10]+t[r>>4&63]+t[r<<2&63]+"="));return s.join("")}},t=[],e=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,s=i.length;n<s;++n)t[n]=i[n],e[i.charCodeAt(n)]=n;function o(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var i=r===e?0:4-r%4;return[r,i]}function a(e,r,i){for(var n,s,o=[],a=r;a<i;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(t[(s=n)>>18&63]+t[s>>12&63]+t[s>>6&63]+t[63&s]);return o.join("")}return e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63,exports}),t("skylark-browserfs/libs/ieee754",[],function(){"use strict";var exports={read:function(t,e,r,i,n){var s,o,a=8*n-i-1,c=(1<<a)-1,h=c>>1,l=-7,u=r?n-1:0,f=r?-1:1,d=t[e+u];for(u+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=256*s+t[e+u],u+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=i;l>0;o=256*o+t[e+u],u+=f,l-=8);if(0===s)s=1-h;else{if(s===c)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,i),s-=h}return(d?-1:1)*o*Math.pow(2,s-i)},write:function(t,e,r,i,n,s){var o,a,c,h=8*s-n-1,l=(1<<h)-1,u=l>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:s-1,p=i?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),(e+=o+u>=1?f/c:f*Math.pow(2,1-u))*c>=2&&(o++,c/=2),o+u>=l?(a=0,o=l):o+u>=1?(a=(e*c-1)*Math.pow(2,n),o+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;t[r+d]=255&a,d+=p,a/=256,n-=8);for(o=o<<n|a,h+=n;h>0;t[r+d]=255&o,d+=p,o/=256,h-=8);t[r+d-p]|=128*y}};return exports}),t("skylark-browserfs/libs/buffers",["./base64","./ieee754"],function(t,e){"use strict";var exports={};exports.Buffer=n,exports.SlowBuffer=function(t){+t!=t&&(t=0);return n.alloc(+t)},exports.INSPECT_MAX_BYTES=50;var r=2147483647;function i(t){if(t>r)throw new RangeError("Invalid typed array length");var e=new Uint8Array(t);return e.__proto__=n.prototype,e}function n(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return a(t)}return s(t,e,r)}function s(t,e,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return U(t)||t&&U(t.buffer)?function(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var i;i=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r);return i.__proto__=n.prototype,i}(t,e,r):"string"==typeof t?function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!n.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=0|l(t,e),s=i(r),o=s.write(t,e);o!==r&&(s=s.slice(0,o));return s}(t,e):function(t){if(n.isBuffer(t)){var e=0|h(t.length),r=i(e);return 0===r.length?r:(t.copy(r,0,0,e),r)}if(t){if(ArrayBuffer.isView(t)||"length"in t)return"number"!=typeof t.length||M(t.length)?i(0):c(t);if("Buffer"===t.type&&Array.isArray(t.data))return c(t.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(t)}function o(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('"size" argument must not be negative')}function a(t){return o(t),i(t<0?0:0|h(t))}function c(t){for(var e=t.length<0?0:0|h(t.length),r=i(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function h(t){if(t>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|t}function l(t,e){if(n.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||U(t))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return x(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return P(t).length;default:if(i)return x(t).length;e=(""+e).toLowerCase(),i=!0}}function u(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function f(t,e,r,i,s){if(0===t.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),M(r=+r)&&(r=s?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(s)return-1;r=t.length-1}else if(r<0){if(!s)return-1;r=0}if("string"==typeof e&&(e=n.from(e,i)),n.isBuffer(e))return 0===e.length?-1:d(t,e,r,i,s);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):d(t,[e],r,i,s);throw new TypeError("val must be string, number or Buffer")}function d(t,e,r,i,n){var s,o=1,a=t.length,c=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,r/=2}function h(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n){var l=-1;for(s=r;s<a;s++)if(h(t,s)===h(e,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===c)return l*o}else-1!==l&&(s-=s-l),l=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){for(var u=!0,f=0;f<c;f++)if(h(t,s+f)!==h(e,f)){u=!1;break}if(u)return s}return-1}function p(t,e,r,i){r=Number(r)||0;var n=t.length-r;i?(i=Number(i))>n&&(i=n):i=n;var s=e.length;i>s/2&&(i=s/2);for(var o=0;o<i;++o){var a=parseInt(e.substr(2*o,2),16);if(M(a))return o;t[r+o]=a}return o}function y(t,e,r,i){return C(x(e,t.length-r),t,r,i)}function g(t,e,r,i){return C(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,i)}function m(t,e,r,i){return g(t,e,r,i)}function w(t,e,r,i){return C(P(e),t,r,i)}function _(t,e,r,i){return C(function(t,e){for(var r,i,n,s=[],o=0;o<t.length&&!((e-=2)<0);++o)r=t.charCodeAt(o),i=r>>8,n=r%256,s.push(n),s.push(i);return s}(e,t.length-r),t,r,i)}function E(e,r,i){return 0===r&&i===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(r,i))}function S(t,e,r){r=Math.min(t.length,r);for(var i=[],n=e;n<r;){var s,o,a,c,h=t[n],l=null,u=h>239?4:h>223?3:h>191?2:1;if(n+u<=r)switch(u){case 1:h<128&&(l=h);break;case 2:128==(192&(s=t[n+1]))&&(c=(31&h)<<6|63&s)>127&&(l=c);break;case 3:s=t[n+1],o=t[n+2],128==(192&s)&&128==(192&o)&&(c=(15&h)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:s=t[n+1],o=t[n+2],a=t[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,u=1):l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l),n+=u}return function(t){var e=t.length;if(e<=b)return String.fromCharCode.apply(String,t);var r="",i=0;for(;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=b));return r}(i)}exports.kMaxLength=r,n.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}(),n.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(n.prototype,"parent",{get:function(){if(this instanceof n)return this.buffer}}),Object.defineProperty(n.prototype,"offset",{get:function(){if(this instanceof n)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&n[Symbol.species]===n&&Object.defineProperty(n,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),n.poolSize=8192,n.from=function(t,e,r){return s(t,e,r)},n.prototype.__proto__=Uint8Array.prototype,n.__proto__=Uint8Array,n.alloc=function(t,e,r){return function(t,e,r){if(o(t),t<=0)return i(t);if(void 0!==e)return"string"==typeof r?i(t).fill(e,r):i(t).fill(e);return i(t)}(t,e,r)},n.allocUnsafe=function(t){return a(t)},n.allocUnsafeSlow=function(t){return a(t)},n.isBuffer=function(t){return null!=t&&!0===t._isBuffer},n.compare=function(t,e){if(!n.isBuffer(t)||!n.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,i=e.length,s=0,o=Math.min(r,i);s<o;++s)if(t[s]!==e[s]){r=t[s],i=e[s];break}return r<i?-1:i<r?1:0},n.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},n.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return n.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var i=n.allocUnsafe(e),s=0;for(r=0;r<t.length;++r){var o=t[r];if(ArrayBuffer.isView(o)&&(o=n.from(o)),!n.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,s),s+=o.length}return i},n.byteLength=l,n.prototype._isBuffer=!0,n.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)u(this,e,e+1);return this},n.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)u(this,e,e+3),u(this,e+1,e+2);return this},n.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)u(this,e,e+7),u(this,e+1,e+6),u(this,e+2,e+5),u(this,e+3,e+4);return this},n.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?S(this,0,t):function(t,e,r){var i=!1;(void 0===e||e<0)&&(e=0);if(e>this.length)return"";(void 0===r||r>this.length)&&(r=this.length);if(r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";t||(t="utf8");for(;;)switch(t){case"hex":return k(this,e,r);case"utf8":case"utf-8":return S(this,e,r);case"ascii":return F(this,e,r);case"latin1":case"binary":return I(this,e,r);case"base64":return E(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}.apply(this,arguments)},n.prototype.toLocaleString=n.prototype.toString,n.prototype.equals=function(t){if(!n.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===n.compare(this,t)},n.prototype.inspect=function(){var t="",e=exports.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},n.prototype.compare=function(t,e,r,i,s){if(!n.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===s&&(s=this.length),e<0||r>t.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&e>=r)return 0;if(i>=s)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,i>>>=0,s>>>=0,this===t)return 0;for(var o=s-i,a=r-e,c=Math.min(o,a),h=this.slice(i,s),l=t.slice(e,r),u=0;u<c;++u)if(h[u]!==l[u]){o=h[u],a=l[u];break}return o<a?-1:a<o?1:0},n.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},n.prototype.indexOf=function(t,e,r){return f(this,t,e,r,!0)},n.prototype.lastIndexOf=function(t,e,r){return f(this,t,e,r,!1)},n.prototype.write=function(t,e,r,i){if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-e;if((void 0===r||r>n)&&(r=n),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return p(this,t,e,r);case"utf8":case"utf-8":return y(this,t,e,r);case"ascii":return g(this,t,e,r);case"latin1":case"binary":return m(this,t,e,r);case"base64":return w(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var b=4096;function F(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}function I(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}function k(t,e,r){var i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);for(var n="",s=e;s<r;++s)n+=D(t[s]);return n}function N(t,e,r){for(var i=t.slice(e,r),n="",s=0;s<i.length;s+=2)n+=String.fromCharCode(i[s]+256*i[s+1]);return n}function O(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function T(t,e,r,i,s,o){if(!n.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}function v(t,e,r,i,n,s){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function R(t,r,i,n,s){return r=+r,i>>>=0,s||v(t,r,i,4,3.4028234663852886e38,-3.4028234663852886e38),e.write(t,r,i,n,23,4),i+4}function L(t,r,i,n,s){return r=+r,i>>>=0,s||v(t,r,i,8,1.7976931348623157e308,-1.7976931348623157e308),e.write(t,r,i,n,52,8),i+8}n.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var i=this.subarray(t,e);return i.__proto__=n.prototype,i},n.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||O(t,e,this.length);for(var i=this[t],n=1,s=0;++s<e&&(n*=256);)i+=this[t+s]*n;return i},n.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||O(t,e,this.length);for(var i=this[t+--e],n=1;e>0&&(n*=256);)i+=this[t+--e]*n;return i},n.prototype.readUInt8=function(t,e){return t>>>=0,e||O(t,1,this.length),this[t]},n.prototype.readUInt16LE=function(t,e){return t>>>=0,e||O(t,2,this.length),this[t]|this[t+1]<<8},n.prototype.readUInt16BE=function(t,e){return t>>>=0,e||O(t,2,this.length),this[t]<<8|this[t+1]},n.prototype.readUInt32LE=function(t,e){return t>>>=0,e||O(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},n.prototype.readUInt32BE=function(t,e){return t>>>=0,e||O(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},n.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||O(t,e,this.length);for(var i=this[t],n=1,s=0;++s<e&&(n*=256);)i+=this[t+s]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*e)),i},n.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||O(t,e,this.length);for(var i=e,n=1,s=this[t+--i];i>0&&(n*=256);)s+=this[t+--i]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*e)),s},n.prototype.readInt8=function(t,e){return t>>>=0,e||O(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},n.prototype.readInt16LE=function(t,e){t>>>=0,e||O(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},n.prototype.readInt16BE=function(t,e){t>>>=0,e||O(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},n.prototype.readInt32LE=function(t,e){return t>>>=0,e||O(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},n.prototype.readInt32BE=function(t,e){return t>>>=0,e||O(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},n.prototype.readFloatLE=function(t,r){return t>>>=0,r||O(t,4,this.length),e.read(this,t,!0,23,4)},n.prototype.readFloatBE=function(t,r){return t>>>=0,r||O(t,4,this.length),e.read(this,t,!1,23,4)},n.prototype.readDoubleLE=function(t,r){return t>>>=0,r||O(t,8,this.length),e.read(this,t,!0,52,8)},n.prototype.readDoubleBE=function(t,r){return t>>>=0,r||O(t,8,this.length),e.read(this,t,!1,52,8)},n.prototype.writeUIntLE=function(t,e,r,i){if(t=+t,e>>>=0,r>>>=0,!i){var n=Math.pow(2,8*r)-1;T(this,t,e,r,n,0)}var s=1,o=0;for(this[e]=255&t;++o<r&&(s*=256);)this[e+o]=t/s&255;return e+r},n.prototype.writeUIntBE=function(t,e,r,i){if(t=+t,e>>>=0,r>>>=0,!i){var n=Math.pow(2,8*r)-1;T(this,t,e,r,n,0)}var s=r-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+r},n.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,1,255,0),this[e]=255&t,e+1},n.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},n.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},n.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},n.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},n.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e>>>=0,!i){var n=Math.pow(2,8*r-1);T(this,t,e,r,n-1,-n)}var s=0,o=1,a=0;for(this[e]=255&t;++s<r&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+r},n.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e>>>=0,!i){var n=Math.pow(2,8*r-1);T(this,t,e,r,n-1,-n)}var s=r-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+r},n.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},n.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},n.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},n.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},n.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},n.prototype.writeFloatLE=function(t,e,r){return R(this,t,e,!0,r)},n.prototype.writeFloatBE=function(t,e,r){return R(this,t,e,!1,r)},n.prototype.writeDoubleLE=function(t,e,r){return L(this,t,e,!0,r)},n.prototype.writeDoubleBE=function(t,e,r){return L(this,t,e,!1,r)},n.prototype.copy=function(t,e,r,i){if(!n.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);var s=i-r;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,r,i);else if(this===t&&r<e&&e<i)for(var o=s-1;o>=0;--o)t[o+e]=this[o+r];else Uint8Array.prototype.set.call(t,this.subarray(r,i),e);return s},n.prototype.fill=function(t,e,r,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!n.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){var s=t.charCodeAt(0);("utf8"===i&&s<128||"latin1"===i)&&(t=s)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=n.isBuffer(t)?t:new n(t,i),c=a.length;if(0===c)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<r-e;++o)this[o+e]=a[o%c]}return this};var A=/[^+/0-9A-Za-z-_]/g;function D(t){return t<16?"0"+t.toString(16):t.toString(16)}function x(t,e){var r;e=e||1/0;for(var i=t.length,n=null,s=[],o=0;o<i;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!n){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===i){(e-=3)>-1&&s.push(239,191,189);continue}n=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(e-=3)>-1&&s.push(239,191,189);if(n=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function P(e){return t.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(A,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(e))}function C(t,e,r,i){for(var n=0;n<i&&!(n+r>=e.length||n>=t.length);++n)e[n+r]=t[n];return n}function U(t){return t instanceof ArrayBuffer||null!=t&&null!=t.constructor&&"ArrayBuffer"===t.constructor.name&&"number"==typeof t.byteLength}function M(t){return t!=t}return exports}),t("skylark-browserfs/core/api_error",["../libs/buffers"],function(t){const{Buffer:e}=t;var r;!function(t){t[t.EPERM=1]="EPERM",t[t.ENOENT=2]="ENOENT",t[t.EIO=5]="EIO",t[t.EBADF=9]="EBADF",t[t.EACCES=13]="EACCES",t[t.EBUSY=16]="EBUSY",t[t.EEXIST=17]="EEXIST",t[t.ENOTDIR=20]="ENOTDIR",t[t.EISDIR=21]="EISDIR",t[t.EINVAL=22]="EINVAL",t[t.EFBIG=27]="EFBIG",t[t.ENOSPC=28]="ENOSPC",t[t.EROFS=30]="EROFS",t[t.ENOTEMPTY=39]="ENOTEMPTY",t[t.ENOTSUP=95]="ENOTSUP"}(r||(r={}));const i={};i[r.EPERM]="Operation not permitted.",i[r.ENOENT]="No such file or directory.",i[r.EIO]="Input/output error.",i[r.EBADF]="Bad file descriptor.",i[r.EACCES]="Permission denied.",i[r.EBUSY]="Resource busy or locked.",i[r.EEXIST]="File exists.",i[r.ENOTDIR]="File is not a directory.",i[r.EISDIR]="File is a directory.",i[r.EINVAL]="Invalid argument.",i[r.EFBIG]="File is too big.",i[r.ENOSPC]="No space left on disk.",i[r.EROFS]="Cannot modify a read-only file system.",i[r.ENOTEMPTY]="Directory is not empty.",i[r.ENOTSUP]="Operation is not supported.";class n extends Error{constructor(t,e=i[t],n){super(e),this.syscall="",this.errno=t,this.code=r[t],this.path=n,this.stack=(new Error).stack,this.message=`Error: ${this.code}: ${e}${this.path?`, '${this.path}'`:""}`}static fromJSON(t){const e=new n(0);return e.errno=t.errno,e.code=t.code,e.path=t.path,e.stack=t.stack,e.message=t.message,e}static fromBuffer(t,e=0){return n.fromJSON(JSON.parse(t.toString("utf8",e+4,e+4+t.readUInt32LE(e))))}static FileError(t,e){return new n(t,i[t],e)}static ENOENT(t){return this.FileError(r.ENOENT,t)}static EEXIST(t){return this.FileError(r.EEXIST,t)}static EISDIR(t){return this.FileError(r.EISDIR,t)}static ENOTDIR(t){return this.FileError(r.ENOTDIR,t)}static EPERM(t){return this.FileError(r.EPERM,t)}static ENOTEMPTY(t){return this.FileError(r.ENOTEMPTY,t)}toString(){return this.message}toJSON(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}}writeToBuffer(t=e.alloc(this.bufferSize()),r=0){const i=t.write(JSON.stringify(this.toJSON()),r+4);return t.writeUInt32LE(i,r),t}bufferSize(){return 4+e.byteLength(JSON.stringify(this.toJSON()))}}return{ApiError:n,ErrorCode:r,ErrorStrings:i}}),t("skylark-browserfs/core/file_flag",["./api_error"],function(t){"use strict";const{ErrorCode:e,ApiError:r}=t;var i;!function(t){t[t.NOP=0]="NOP",t[t.THROW_EXCEPTION=1]="THROW_EXCEPTION",t[t.TRUNCATE_FILE=2]="TRUNCATE_FILE",t[t.CREATE_FILE=3]="CREATE_FILE"}(i||(i={}));class n{constructor(t){if(this.flagStr=t,n.validFlagStrs.indexOf(t)<0)throw new r(e.EINVAL,"Invalid flag: "+t)}static getFileFlag(t){return n.flagCache.hasOwnProperty(t)?n.flagCache[t]:n.flagCache[t]=new n(t)}getFlagString(){return this.flagStr}isReadable(){return-1!==this.flagStr.indexOf("r")||-1!==this.flagStr.indexOf("+")}isWriteable(){return-1!==this.flagStr.indexOf("w")||-1!==this.flagStr.indexOf("a")||-1!==this.flagStr.indexOf("+")}isTruncating(){return-1!==this.flagStr.indexOf("w")}isAppendable(){return-1!==this.flagStr.indexOf("a")}isSynchronous(){return-1!==this.flagStr.indexOf("s")}isExclusive(){return-1!==this.flagStr.indexOf("x")}pathExistsAction(){return this.isExclusive()?i.THROW_EXCEPTION:this.isTruncating()?i.TRUNCATE_FILE:i.NOP}pathNotExistsAction(){return(this.isWriteable()||this.isAppendable())&&"r+"!==this.flagStr?i.CREATE_FILE:i.THROW_EXCEPTION}}return n.flagCache={},n.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"],{ActionType:i,FileFlag:n}}),t("skylark-browserfs/libs/path",[],function(){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var e=function(){function e(){}return e.normalize=function(t){""===t&&(t=".");for(var r=t.charAt(0)===e.sep,i=(t=e._removeDuplicateSeps(t)).split(e.sep),n=[],s=0;s<i.length;s++){var o=i[s];"."!==o&&(".."===o&&(r||!r&&n.length>0&&".."!==n[0])?n.pop():n.push(o))}if(!r&&n.length<2)switch(n.length){case 1:""===n[0]&&n.unshift(".");break;default:n.push(".")}return t=n.join(e.sep),r&&t.charAt(0)!==e.sep&&(t=e.sep+t),t},e.join=function(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];for(var i=[],n=0;n<t.length;n++){var s=t[n];if("string"!=typeof s)throw new TypeError("Invalid argument type to path.join: "+typeof s);""!==s&&i.push(s)}return e.normalize(i.join(e.sep))},e.resolve=function(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];for(var i=[],n=0;n<t.length;n++){var s=t[n];if("string"!=typeof s)throw new TypeError("Invalid argument type to path.join: "+typeof s);""!==s&&(s.charAt(0)===e.sep&&(i=[]),i.push(s))}var o=e.normalize(i.join(e.sep));if(o.length>1&&o.charAt(o.length-1)===e.sep)return o.substr(0,o.length-1);if(o.charAt(0)!==e.sep){"."!==o.charAt(0)||1!==o.length&&o.charAt(1)!==e.sep||(o=1===o.length?"":o.substr(2));var a=process.cwd();o=""!==o?this.normalize(a+("/"!==a?e.sep:"")+o):a}return o},e.relative=function(t,r){var i;t=e.resolve(t),r=e.resolve(r);var n=t.split(e.sep),s=r.split(e.sep);s.shift(),n.shift();var o=0,a=[];for(i=0;i<n.length;i++){var c=n[i];if(c!==s[i]){o=n.length-i;break}}a=s.slice(i),1===n.length&&""===n[0]&&(o=0),o>n.length&&(o=n.length);var h="";for(i=0;i<o;i++)h+="../";return(h+=a.join(e.sep)).length>1&&h.charAt(h.length-1)===e.sep&&(h=h.substr(0,h.length-1)),h},e.dirname=function(t){var r=(t=e._removeDuplicateSeps(t)).charAt(0)===e.sep,i=t.split(e.sep);return""===i.pop()&&i.length>0&&i.pop(),i.length>1||1===i.length&&!r?i.join(e.sep):r?e.sep:"."},e.basename=function(t,r){if(void 0===r&&(r=""),""===t)return t;var i=(t=e.normalize(t)).split(e.sep),n=i[i.length-1];if(""===n&&i.length>1)return i[i.length-2];if(r.length>0){var s=n.substr(n.length-r.length);if(s===r)return n.substr(0,n.length-r.length)}return n},e.extname=function(t){var r=(t=e.normalize(t)).split(e.sep);if(""===(t=r.pop())&&r.length>0&&(t=r.pop()),".."===t)return"";var i=t.lastIndexOf(".");return-1===i||0===i?"":t.substr(i)},e.isAbsolute=function(t){return t.length>0&&t.charAt(0)===e.sep},e._makeLong=function(t){return t},e.parse=function(e){var r,i,n=(r=e,(i=t.exec(r)).shift(),i);return{root:n[0],dir:n[0]+n[1].slice(0,-1),base:n[2],ext:n[3],name:n[2].slice(0,n[2].length-n[3].length)}},e.format=function(t){if(null===t||"object"!=typeof t)throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof t);var r=t.root||"";if("string"!=typeof r)throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof t.root);var i=t.dir?t.dir+e.sep:"",n=t.base||"";return i+n},e._removeDuplicateSeps=function(t){return t=t.replace(this._replaceRegex,this.sep)},e.sep="/",e._replaceRegex=new RegExp("//+","g"),e.delimiter=":",e.posix=e,e.win32=e,e}();return e}),t("skylark-browserfs/core/node_fs_stats",["../libs/buffers"],function(t){"use strict";const{Buffer:e}=t;var r;!function(t){t[t.FILE=32768]="FILE",t[t.DIRECTORY=16384]="DIRECTORY",t[t.SYMLINK=40960]="SYMLINK"}(r||(r={}));class i{constructor(t,e,i,n,s,o,a){this.dev=0,this.ino=0,this.rdev=0,this.nlink=1,this.blksize=4096,this.uid=0,this.gid=0,this.fileData=null,this.size=e;let c=0;if("number"!=typeof n&&(c=Date.now(),n=c),"number"!=typeof s&&(c||(c=Date.now()),s=c),"number"!=typeof o&&(c||(c=Date.now()),o=c),"number"!=typeof a&&(c||(c=Date.now()),a=c),this.atimeMs=n,this.ctimeMs=o,this.mtimeMs=s,this.birthtimeMs=a,i)this.mode=i;else switch(t){case r.FILE:this.mode=420;break;case r.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(e/512),this.mode<4096&&(this.mode|=t)}static fromBuffer(t){const e=t.readUInt32LE(0),r=t.readUInt32LE(4),n=t.readDoubleLE(8),s=t.readDoubleLE(16),o=t.readDoubleLE(24);return new i(61440&r,e,4095&r,n,s,o)}static clone(t){return new i(61440&t.mode,t.size,4095&t.mode,t.atimeMs,t.mtimeMs,t.ctimeMs,t.birthtimeMs)}get atime(){return new Date(this.atimeMs)}get mtime(){return new Date(this.mtimeMs)}get ctime(){return new Date(this.ctimeMs)}get birthtime(){return new Date(this.birthtimeMs)}toBuffer(){const t=e.alloc(32);return t.writeUInt32LE(this.size,0),t.writeUInt32LE(this.mode,4),t.writeDoubleLE(this.atime.getTime(),8),t.writeDoubleLE(this.mtime.getTime(),16),t.writeDoubleLE(this.ctime.getTime(),24),t}isFile(){return(61440&this.mode)===r.FILE}isDirectory(){return(61440&this.mode)===r.DIRECTORY}isSymbolicLink(){return(61440&this.mode)===r.SYMLINK}chmod(t){this.mode=61440&this.mode|t}isSocket(){return!1}isBlockDevice(){return!1}isCharacterDevice(){return!1}isFIFO(){return!1}}return{FileType:r,Stats:i}}),t("skylark-browserfs/core/global",[],function(){"use strict";const t="undefined"!=typeof window?window:"undefined"!=typeof self?self:global;return t}),t("skylark-browserfs/generic/setImmediate",["../core/global"],function(t){"use strict";let e;if("undefined"!=typeof setImmediate)e=setImmediate;else{const r=t,i=[],n="zero-timeout-message",s=function(){if(void 0!==r.importScripts||!r.postMessage)return!1;let t=!0;const e=r.onmessage;return r.onmessage=function(){t=!1},r.postMessage("","*"),r.onmessage=e,t};if(s()){e=function(t){i.push(t),r.postMessage(n,"*")};const t=function(t){if(t.source===self&&t.data===n&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,i.length>0)){const t=i.shift();return t()}};r.addEventListener?r.addEventListener("message",t,!0):r.attachEvent("onmessage",t)}else if(r.MessageChannel){const t=new r.MessageChannel;t.port1.onmessage=(t=>{if(i.length>0)return i.shift()()}),e=(e=>{i.push(e),t.port2.postMessage("")})}else e=function(t){return setTimeout(t,0)}}return e}),t("skylark-browserfs/core/FS",["../libs/buffers","./api_error","./file_flag","../libs/path","./node_fs_stats","../generic/setImmediate"],function(t,e,r,i,n,s){"use strict";const{ApiError:o,ErrorCode:a}=e,{FileFlag:c}=r,{Stats:h}=n,{Buffer:l}=t;let u=function(t,e){return t};function f(t,e){if("function"!=typeof t)throw new Error("Callback must be a function.");const r=u(t,e);switch(e){case 1:return function(t){s(function(){return r(t)})};case 2:return function(t,e){s(function(){return r(t,e)})};case 3:return function(t,e,i){s(function(){return r(t,e,i)})};default:throw new Error("Invalid invocation of wrapCb.")}}function d(t){if(t)return t;throw new o(a.EIO,"Initialize BrowserFS with a file system using BrowserFS.initialize(filesystem)")}function p(t,e){switch(typeof t){case"number":return t;case"string":const r=parseInt(t,8);return isNaN(r)?e:r;default:return e}}function y(t){if(t instanceof Date)return t;if("number"==typeof t)return new Date(1e3*t);throw new o(a.EINVAL,"Invalid time.")}function g(t){if(t.indexOf("\0")>=0)throw new o(a.EINVAL,"Path must be a string without null bytes.");if(""===t)throw new o(a.EINVAL,"Path must not be empty.");return i.resolve(t)}function m(t,e,r,i){switch(null===t?"null":typeof t){case"object":return{encoding:void 0!==t.encoding?t.encoding:e,flag:void 0!==t.flag?t.flag:r,mode:p(t.mode,i)};case"string":return{encoding:t,flag:r,mode:i};case"null":case"undefined":case"function":return{encoding:e,flag:r,mode:i};default:throw new TypeError(`"options" must be a string or an object, got ${typeof t} instead.`)}}function w(){}class _{constructor(){this.F_OK=0,this.R_OK=4,this.W_OK=2,this.X_OK=1,this.root=null,this.fdMap={},this.nextFd=100}initialize(t){if(!t.constructor.isAvailable())throw new o(a.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.");return this.root=t}_toUnixTimestamp(t){if("number"==typeof t)return t;if(t instanceof Date)return t.getTime()/1e3;throw new Error("Cannot parse time: "+t)}getRootFS(){return this.root?this.root:null}rename(t,e,r=w){const i=f(r,1);try{d(this.root).rename(g(t),g(e),i)}catch(t){i(t)}}renameSync(t,e){d(this.root).renameSync(g(t),g(e))}exists(t,e=w){const r=f(e,1);try{return d(this.root).exists(g(t),r)}catch(t){return r(!1)}}existsSync(t){try{return d(this.root).existsSync(g(t))}catch(t){return!1}}stat(t,e=w){const r=f(e,2);try{return d(this.root).stat(g(t),!1,r)}catch(t){return r(t)}}statSync(t){return d(this.root).statSync(g(t),!1)}lstat(t,e=w){const r=f(e,2);try{return d(this.root).stat(g(t),!0,r)}catch(t){return r(t)}}lstatSync(t){return d(this.root).statSync(g(t),!0)}truncate(t,e=0,r=w){let i=0;"function"==typeof e?r=e:"number"==typeof e&&(i=e);const n=f(r,1);try{if(i<0)throw new o(a.EINVAL);return d(this.root).truncate(g(t),i,n)}catch(t){return n(t)}}truncateSync(t,e=0){if(e<0)throw new o(a.EINVAL);return d(this.root).truncateSync(g(t),e)}unlink(t,e=w){const r=f(e,1);try{return d(this.root).unlink(g(t),r)}catch(t){return r(t)}}unlinkSync(t){return d(this.root).unlinkSync(g(t))}open(t,e,r,i=w){const n=p(r,420),s=f(i="function"==typeof r?r:i,2);try{d(this.root).open(g(t),c.getFileFlag(e),n,(t,e)=>{e?s(t,this.getFdForFile(e)):s(t)})}catch(t){s(t)}}openSync(t,e,r=420){return this.getFdForFile(d(this.root).openSync(g(t),c.getFileFlag(e),p(r,420)))}readFile(t,e={},r=w){const i=m(e,null,"r",null),n=f(r="function"==typeof e?e:r,2);try{const e=c.getFileFlag(i.flag);return e.isReadable()?d(this.root).readFile(g(t),i.encoding,e,n):n(new o(a.EINVAL,"Flag passed to readFile must allow for reading."))}catch(t){return n(t)}}readFileSync(t,e={}){const r=m(e,null,"r",null),i=c.getFileFlag(r.flag);if(!i.isReadable())throw new o(a.EINVAL,"Flag passed to readFile must allow for reading.");return d(this.root).readFileSync(g(t),r.encoding,i)}writeFile(t,e,r={},i=w){const n=m(r,"utf8","w",420),s=f(i="function"==typeof r?r:i,1);try{const r=c.getFileFlag(n.flag);return r.isWriteable()?d(this.root).writeFile(g(t),e,n.encoding,r,n.mode,s):s(new o(a.EINVAL,"Flag passed to writeFile must allow for writing."))}catch(t){return s(t)}}writeFileSync(t,e,r){const i=m(r,"utf8","w",420),n=c.getFileFlag(i.flag);if(!n.isWriteable())throw new o(a.EINVAL,"Flag passed to writeFile must allow for writing.");return d(this.root).writeFileSync(g(t),e,i.encoding,n,i.mode)}appendFile(t,e,r,i=w){const n=m(r,"utf8","a",420),s=f(i="function"==typeof r?r:i,1);try{const r=c.getFileFlag(n.flag);if(!r.isAppendable())return s(new o(a.EINVAL,"Flag passed to appendFile must allow for appending."));d(this.root).appendFile(g(t),e,n.encoding,r,n.mode,s)}catch(t){s(t)}}appendFileSync(t,e,r){const i=m(r,"utf8","a",420),n=c.getFileFlag(i.flag);if(!n.isAppendable())throw new o(a.EINVAL,"Flag passed to appendFile must allow for appending.");return d(this.root).appendFileSync(g(t),e,i.encoding,n,i.mode)}fstat(t,e=w){const r=f(e,2);try{const e=this.fd2file(t);e.stat(r)}catch(t){r(t)}}fstatSync(t){return this.fd2file(t).statSync()}close(t,e=w){const r=f(e,1);try{this.fd2file(t).close(e=>{e||this.closeFd(t),r(e)})}catch(t){r(t)}}closeSync(t){this.fd2file(t).closeSync(),this.closeFd(t)}ftruncate(t,e,r=w){const i="number"==typeof e?e:0,n=f(r="function"==typeof e?e:r,1);try{const e=this.fd2file(t);if(i<0)throw new o(a.EINVAL);e.truncate(i,n)}catch(t){n(t)}}ftruncateSync(t,e=0){const r=this.fd2file(t);if(e<0)throw new o(a.EINVAL);r.truncateSync(e)}fsync(t,e=w){const r=f(e,1);try{this.fd2file(t).sync(r)}catch(t){r(t)}}fsyncSync(t){this.fd2file(t).syncSync()}fdatasync(t,e=w){const r=f(e,1);try{this.fd2file(t).datasync(r)}catch(t){r(t)}}fdatasyncSync(t){this.fd2file(t).datasyncSync()}write(t,e,r,i,n,s=w){let c,h,u,d=null;if("string"==typeof e){let t="utf8";switch(typeof r){case"function":s=r;break;case"number":d=r,t="string"==typeof i?i:"utf8",s="function"==typeof n?n:s;break;default:return(s="function"==typeof i?i:"function"==typeof n?n:s)(new o(a.EINVAL,"Invalid arguments."))}c=l.from(e,t),h=0,u=c.length}else c=e,h=r,u=i,d="number"==typeof n?n:null,s="function"==typeof n?n:s;const p=f(s,3);try{const e=this.fd2file(t);void 0!==d&&null!==d||(d=e.getPos()),e.write(c,h,u,d,p)}catch(t){p(t)}}writeSync(t,e,r,i,n){let s,o,a,c=0;if("string"==typeof e){a="number"==typeof r?r:null;const t="string"==typeof i?i:"utf8";c=0,s=l.from(e,t),o=s.length}else s=e,c=r,o=i,a="number"==typeof n?n:null;const h=this.fd2file(t);return void 0!==a&&null!==a||(a=h.getPos()),h.writeSync(s,c,o,a)}read(t,e,r,i,n,s=w){let o,a,c,h,u;if("number"==typeof e){c=e,o=r;const t=i;s="function"==typeof n?n:s,a=0,h=l.alloc(c),u=f((e,r,i)=>{if(e)return s(e);s(e,i.toString(t),r)},3)}else h=e,a=r,c=i,o=n,u=f(s,3);try{const e=this.fd2file(t);void 0!==o&&null!==o||(o=e.getPos()),e.read(h,a,c,o,u)}catch(t){u(t)}}readSync(t,e,r,i,n){let s,o,a,c,h=!1,u="utf8";"number"==typeof e?(a=e,c=r,u=i,o=0,s=l.alloc(a),h=!0):(s=e,o=r,a=i,c=n);const f=this.fd2file(t);void 0!==c&&null!==c||(c=f.getPos());const d=f.readSync(s,o,a,c);return h?[s.toString(u),d]:d}fchown(t,e,r,i=w){const n=f(i,1);try{this.fd2file(t).chown(e,r,n)}catch(t){n(t)}}fchownSync(t,e,r){this.fd2file(t).chownSync(e,r)}fchmod(t,e,r){const i=f(r,1);try{const r="string"==typeof e?parseInt(e,8):e;this.fd2file(t).chmod(r,i)}catch(t){i(t)}}fchmodSync(t,e){const r="string"==typeof e?parseInt(e,8):e;this.fd2file(t).chmodSync(r)}futimes(t,e,r,i=w){const n=f(i,1);try{const i=this.fd2file(t);"number"==typeof e&&(e=new Date(1e3*e)),"number"==typeof r&&(r=new Date(1e3*r)),i.utimes(e,r,n)}catch(t){n(t)}}futimesSync(t,e,r){this.fd2file(t).utimesSync(y(e),y(r))}rmdir(t,e=w){const r=f(e,1);try{t=g(t),d(this.root).rmdir(t,r)}catch(t){r(t)}}rmdirSync(t){return t=g(t),d(this.root).rmdirSync(t)}mkdir(t,e,r=w){"function"==typeof e&&(r=e,e=511);const i=f(r,1);try{t=g(t),d(this.root).mkdir(t,e,i)}catch(t){i(t)}}mkdirSync(t,e){d(this.root).mkdirSync(g(t),p(e,511))}readdir(t,e=w){const r=f(e,2);try{t=g(t),d(this.root).readdir(t,r)}catch(t){r(t)}}readdirSync(t){return t=g(t),d(this.root).readdirSync(t)}link(t,e,r=w){const i=f(r,1);try{t=g(t),e=g(e),d(this.root).link(t,e,i)}catch(t){i(t)}}linkSync(t,e){return t=g(t),e=g(e),d(this.root).linkSync(t,e)}symlink(t,e,r,i=w){const n="string"==typeof r?r:"file",s=f(i="function"==typeof r?r:i,1);try{if("file"!==n&&"dir"!==n)return s(new o(a.EINVAL,"Invalid type: "+n));t=g(t),e=g(e),d(this.root).symlink(t,e,n,s)}catch(t){s(t)}}symlinkSync(t,e,r){if(r){if("file"!==r&&"dir"!==r)throw new o(a.EINVAL,"Invalid type: "+r)}else r="file";return t=g(t),e=g(e),d(this.root).symlinkSync(t,e,r)}readlink(t,e=w){const r=f(e,2);try{t=g(t),d(this.root).readlink(t,r)}catch(t){r(t)}}readlinkSync(t){return t=g(t),d(this.root).readlinkSync(t)}chown(t,e,r,i=w){const n=f(i,1);try{t=g(t),d(this.root).chown(t,!1,e,r,n)}catch(t){n(t)}}chownSync(t,e,r){t=g(t),d(this.root).chownSync(t,!1,e,r)}lchown(t,e,r,i=w){const n=f(i,1);try{t=g(t),d(this.root).chown(t,!0,e,r,n)}catch(t){n(t)}}lchownSync(t,e,r){t=g(t),d(this.root).chownSync(t,!0,e,r)}chmod(t,e,r=w){const i=f(r,1);try{const r=p(e,-1);if(r<0)throw new o(a.EINVAL,"Invalid mode.");d(this.root).chmod(g(t),!1,r,i)}catch(t){i(t)}}chmodSync(t,e){const r=p(e,-1);if(r<0)throw new o(a.EINVAL,"Invalid mode.");t=g(t),d(this.root).chmodSync(t,!1,r)}lchmod(t,e,r=w){const i=f(r,1);try{const r=p(e,-1);if(r<0)throw new o(a.EINVAL,"Invalid mode.");d(this.root).chmod(g(t),!0,r,i)}catch(t){i(t)}}lchmodSync(t,e){const r=p(e,-1);if(r<1)throw new o(a.EINVAL,"Invalid mode.");d(this.root).chmodSync(g(t),!0,r)}utimes(t,e,r,i=w){const n=f(i,1);try{d(this.root).utimes(g(t),y(e),y(r),n)}catch(t){n(t)}}utimesSync(t,e,r){d(this.root).utimesSync(g(t),y(e),y(r))}realpath(t,e,r=w){const i="object"==typeof e?e:{},n=f("function"==typeof e?e:w,2);try{t=g(t),d(this.root).realpath(t,i,n)}catch(t){n(t)}}realpathSync(t,e={}){return t=g(t),d(this.root).realpathSync(t,e)}watchFile(t,e,r=w){throw new o(a.ENOTSUP)}unwatchFile(t,e=w){throw new o(a.ENOTSUP)}watch(t,e,r=w){throw new o(a.ENOTSUP)}access(t,e,r=w){throw new o(a.ENOTSUP)}accessSync(t,e){throw new o(a.ENOTSUP)}createReadStream(t,e){throw new o(a.ENOTSUP)}createWriteStream(t,e){throw new o(a.ENOTSUP)}wrapCallbacks(t){u=t}getFdForFile(t){const e=this.nextFd++;return this.fdMap[e]=t,e}fd2file(t){const e=this.fdMap[t];if(e)return e;throw new o(a.EBADF,"Invalid file descriptor.")}closeFd(t){delete this.fdMap[t]}}return _.Stats=h,_}),t("skylark-browserfs/core/node_fs",["./FS"],function(t){"use strict";let e=new t;const r={},i=t.prototype,n=Object.getOwnPropertyNames(i);return n.forEach(t=>{"function"==typeof e[t]?r[t]=function(){return e[t].apply(e,arguments)}:r[t]=e[t]}),r.changeFSModule=function(t){e=t},r.getFSModule=function(){return e},r.FS=t,r.Stats=t.Stats,r}),t("skylark-browserfs/core/levenshtein",[],function(){"use strict";function t(t,e,r,i,n){return t<e||r<e?t>r?r+1:t+1:i===n?e:e+1}return function(e,r){if(e===r)return 0;if(e.length>r.length){const t=e;e=r,r=t}let i=e.length,n=r.length;for(;i>0&&e.charCodeAt(i-1)===r.charCodeAt(n-1);)i--,n--;let s=0;for(;s<i&&e.charCodeAt(s)===r.charCodeAt(s);)s++;if(n-=s,0==(i-=s)||1===n)return n;const o=new Array(i<<1);for(let t=0;t<i;)o[i+t]=e.charCodeAt(s+t),o[t]=++t;let a,c,h,l,u;for(a=0;a+3<n;){const e=r.charCodeAt(s+(c=a)),n=r.charCodeAt(s+(h=a+1)),f=r.charCodeAt(s+(l=a+2)),d=r.charCodeAt(s+(u=a+3));let p=a+=4;for(let r=0;r<i;){const s=o[i+r],a=o[r];c=t(a,c,h,e,s),h=t(c,h,l,n,s),l=t(h,l,u,f,s),p=t(l,u,p,d,s),o[r++]=p,u=l,l=h,h=c,c=a}}let f=0;for(;a<n;){const t=r.charCodeAt(s+(c=a));f=++a;for(let e=0;e<i;e++){const r=o[e];o[e]=f=r<c||f<c?r>f?f+1:r+1:t===o[i+e]?c:c+1,c=r}}return f}}),t("skylark-browserfs/core/util",["../libs/buffers","./api_error","./levenshtein","../libs/path"],function(t,e,r,i){"use strict";const{ErrorCode:n,ApiError:s}=e,{Buffer:o}=t;const a="undefined"!=typeof navigator&&!(!/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&-1===navigator.userAgent.indexOf("Trident")),c="undefined"==typeof window;function h(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function l(t){return t instanceof o?t:0===t.byteOffset&&t.byteLength===t.buffer.byteLength?u(t.buffer):o.from(t.buffer,t.byteOffset,t.byteLength)}function u(t){return o.from(t)}let f=null;function d(){return f||(f=o.alloc(0))}return{deprecationMessage:function(t,e,r){t&&console.warn(`[${e}] Direct file system constructor usage is deprecated for this file system, and will be removed in the next major version. Please use the '${e}.Create(${JSON.stringify(r)}, callback)' method instead. See https://github.com/jvilk/BrowserFS/issues/176 for more details.`)},isIE:a,isWebWorker:c,fail:function(){throw new Error("BFS has reached an impossible code path; please file a bug.")},mkdirpSync:function t(e,r,n){n.existsSync(e)||(t(i.dirname(e),r,n),n.mkdirSync(e,r))},buffer2ArrayBuffer:function(t){const e=h(t),r=e.byteOffset,i=e.byteLength;return 0===r&&i===e.buffer.byteLength?e.buffer:e.buffer.slice(r,r+i)},buffer2Uint8array:h,arrayish2Buffer:function(t){return t instanceof o?t:t instanceof Uint8Array?l(t):o.from(t)},uint8Array2Buffer:l,arrayBuffer2Buffer:u,copyingSlice:function(t,e=0,r=t.length){if(e<0||r<0||r>t.length||e>r)throw new TypeError(`Invalid slice bounds on buffer of length ${t.length}: [${e}, ${r}]`);if(0===t.length)return d();{const i=h(t),n=t[0],s=(n+1)%255;return t[0]=s,i[0]===s?(i[0]=n,l(i.slice(e,r))):(t[0]=n,l(i.subarray(e,r)))}},emptyBuffer:d,bufferValidator:function(t,e){o.isBuffer(t)?e():e(new s(n.EINVAL,"option must be a Buffer."))},checkOptions:function(t,e,i){const o=t.Options,a=t.Name;let c=0,h=!1,l=!1;function u(t){h||(t&&(h=!0,i(t)),0===--c&&l&&i())}for(const t in o)if(o.hasOwnProperty(t)){const l=o[t],f=e[t];if(void 0===f||null===f){if(!l.optional){const c=Object.keys(e).filter(t=>!(t in o)).map(e=>({str:e,distance:r(t,e)})).filter(t=>t.distance<5).sort((t,e)=>t.distance-e.distance);if(h)return;return h=!0,i(new s(n.EINVAL,`[${a}] Required option '${t}' not provided.${c.length>0?` You provided unrecognized option '${c[0].str}'; perhaps you meant to type '${t}'.`:""}\nOption description: ${l.description}`))}}else{let e=!1;if(!(e=Array.isArray(l.type)?-1!==l.type.indexOf(typeof f):typeof f===l.type)){if(h)return;return h=!0,i(new s(n.EINVAL,`[${a}] Value provided for option ${t} is not the proper type. Expected ${Array.isArray(l.type)?`one of {${l.type.join(", ")}}`:l.type}, but received ${typeof f}\nOption description: ${l.description}`))}l.validator&&(c++,l.validator(f,u))}}l=!0,0!==c||h||i()}}}),t("skylark-browserfs/generic/emscripten_fs",["../core/node_fs","../core/util"],function(t,e){"use strict";const{uint8Array2Buffer:r}=e;class i{constructor(t){this.fs=t,this.nodefs=t.getNodeFS(),this.FS=t.getFS(),this.PATH=t.getPATH(),this.ERRNO_CODES=t.getERRNO_CODES()}open(t){const e=this.fs.realPath(t.node),r=this.FS;try{r.isFile(t.node.mode)&&(t.nfd=this.nodefs.openSync(e,this.fs.flagsToPermissionString(t.flags)))}catch(t){if(!t.code)throw t;throw new r.ErrnoError(this.ERRNO_CODES[t.code])}}close(t){const e=this.FS;try{e.isFile(t.node.mode)&&t.nfd&&this.nodefs.closeSync(t.nfd)}catch(t){if(!t.code)throw t;throw new e.ErrnoError(this.ERRNO_CODES[t.code])}}read(t,e,i,n,s){try{return this.nodefs.readSync(t.nfd,r(e),i,n,s)}catch(t){throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}write(t,e,i,n,s){try{return this.nodefs.writeSync(t.nfd,r(e),i,n,s)}catch(t){throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}llseek(t,e,r){let i=e;if(1===r)i+=t.position;else if(2===r&&this.FS.isFile(t.node.mode))try{const e=this.nodefs.fstatSync(t.nfd);i+=e.size}catch(t){throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}if(i<0)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return t.position=i,i}}class n{constructor(t){this.fs=t,this.nodefs=t.getNodeFS(),this.FS=t.getFS(),this.PATH=t.getPATH(),this.ERRNO_CODES=t.getERRNO_CODES()}getattr(t){const e=this.fs.realPath(t);let r;try{r=this.nodefs.lstatSync(e)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}return{dev:r.dev,ino:r.ino,mode:r.mode,nlink:r.nlink,uid:r.uid,gid:r.gid,rdev:r.rdev,size:r.size,atime:r.atime,mtime:r.mtime,ctime:r.ctime,blksize:r.blksize,blocks:r.blocks}}setattr(t,e){const r=this.fs.realPath(t);try{if(void 0!==e.mode&&(this.nodefs.chmodSync(r,e.mode),t.mode=e.mode),void 0!==e.timestamp){const t=new Date(e.timestamp);this.nodefs.utimesSync(r,t,t)}}catch(t){if(!t.code)throw t;if("ENOTSUP"!==t.code)throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}if(void 0!==e.size)try{this.nodefs.truncateSync(r,e.size)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}lookup(t,e){const r=this.PATH.join2(this.fs.realPath(t),e),i=this.fs.getMode(r);return this.fs.createNode(t,e,i)}mknod(t,e,r,i){const n=this.fs.createNode(t,e,r,i),s=this.fs.realPath(n);try{this.FS.isDir(n.mode)?this.nodefs.mkdirSync(s,n.mode):this.nodefs.writeFileSync(s,"",{mode:n.mode})}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}return n}rename(t,e,r){const i=this.fs.realPath(t),n=this.PATH.join2(this.fs.realPath(e),r);try{this.nodefs.renameSync(i,n),t.name=r,t.parent=e}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}unlink(t,e){const r=this.PATH.join2(this.fs.realPath(t),e);try{this.nodefs.unlinkSync(r)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}rmdir(t,e){const r=this.PATH.join2(this.fs.realPath(t),e);try{this.nodefs.rmdirSync(r)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}readdir(t){const e=this.fs.realPath(t);try{const t=this.nodefs.readdirSync(e);return t.push(".",".."),t}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}symlink(t,e,r){const i=this.PATH.join2(this.fs.realPath(t),e);try{this.nodefs.symlinkSync(r,i)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}readlink(t){const e=this.fs.realPath(t);try{return this.nodefs.readlinkSync(e)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}}}return class{constructor(e=self.FS,r=self.PATH,s=self.ERRNO_CODES,o=t){this.flagsToPermissionStringMap={0:"r",1:"r+",2:"r+",64:"r",65:"r+",66:"r+",129:"rx+",193:"rx+",514:"w+",577:"w",578:"w+",705:"wx",706:"wx+",1024:"a",1025:"a",1026:"a+",1089:"a",1090:"a+",1153:"ax",1154:"ax+",1217:"ax",1218:"ax+",4096:"rs",4098:"rs+"},this.nodefs=o,this.FS=e,this.PATH=r,this.ERRNO_CODES=s,this.node_ops=new n(this),this.stream_ops=new i(this)}mount(t){return this.createNode(null,"/",this.getMode(t.opts.root),0)}createNode(t,e,r,i){const n=this.FS;if(!n.isDir(r)&&!n.isFile(r)&&!n.isLink(r))throw new n.ErrnoError(this.ERRNO_CODES.EINVAL);const s=n.createNode(t,e,r);return s.node_ops=this.node_ops,s.stream_ops=this.stream_ops,s}getMode(t){let e;try{e=this.nodefs.lstatSync(t)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}return e.mode}realPath(t){const e=[];for(;t.parent!==t;)e.push(t.name),t=t.parent;return e.push(t.mount.opts.root),e.reverse(),this.PATH.join.apply(null,e)}flagsToPermissionString(t){let e="string"==typeof t?parseInt(t,10):t;return(e&=8191)in this.flagsToPermissionStringMap?this.flagsToPermissionStringMap[e]:t}getNodeFS(){return this.nodefs}getFS(){return this.FS}getPATH(){return this.PATH}getERRNO_CODES(){return this.ERRNO_CODES}}}),t("skylark-browserfs/core/file_system",["../libs/buffers","./api_error","./file_flag","../libs/path","./util"],function(t,e,r,i,n){"use strict";const{ApiError:s,ErrorCode:o}=e,{FileFlag:a,ActionType:c}=r,{fail:h}=n;class l{supportsLinks(){return!1}diskSpace(t,e){e(0,0)}openFile(t,e,r){throw new s(o.ENOTSUP)}createFile(t,e,r,i){throw new s(o.ENOTSUP)}open(t,e,r,n){this.stat(t,!1,(a,l)=>{if(a)switch(e.pathNotExistsAction()){case c.CREATE_FILE:return this.stat(i.dirname(t),!1,(o,a)=>{o?n(o):a&&!a.isDirectory()?n(s.ENOTDIR(i.dirname(t))):this.createFile(t,e,r,n)});case c.THROW_EXCEPTION:return n(s.ENOENT(t));default:return n(new s(o.EINVAL,"Invalid FileFlag object."))}else{if(l&&l.isDirectory())return n(s.EISDIR(t));switch(e.pathExistsAction()){case c.THROW_EXCEPTION:return n(s.EEXIST(t));case c.TRUNCATE_FILE:return this.openFile(t,e,(t,e)=>{t?n(t):e?e.truncate(0,()=>{e.sync(()=>{n(null,e)})}):h()});case c.NOP:return this.openFile(t,e,n);default:return n(new s(o.EINVAL,"Invalid FileFlag object."))}}})}rename(t,e,r){r(new s(o.ENOTSUP))}renameSync(t,e){throw new s(o.ENOTSUP)}stat(t,e,r){r(new s(o.ENOTSUP))}statSync(t,e){throw new s(o.ENOTSUP)}openFileSync(t,e,r){throw new s(o.ENOTSUP)}createFileSync(t,e,r){throw new s(o.ENOTSUP)}openSync(t,e,r){let n;try{n=this.statSync(t,!1)}catch(n){switch(e.pathNotExistsAction()){case c.CREATE_FILE:const n=this.statSync(i.dirname(t),!1);if(!n.isDirectory())throw s.ENOTDIR(i.dirname(t));return this.createFileSync(t,e,r);case c.THROW_EXCEPTION:throw s.ENOENT(t);default:throw new s(o.EINVAL,"Invalid FileFlag object.")}}if(n.isDirectory())throw s.EISDIR(t);switch(e.pathExistsAction()){case c.THROW_EXCEPTION:throw s.EEXIST(t);case c.TRUNCATE_FILE:return this.unlinkSync(t),this.createFileSync(t,e,n.mode);case c.NOP:return this.openFileSync(t,e,r);default:throw new s(o.EINVAL,"Invalid FileFlag object.")}}unlink(t,e){e(new s(o.ENOTSUP))}unlinkSync(t){throw new s(o.ENOTSUP)}rmdir(t,e){e(new s(o.ENOTSUP))}rmdirSync(t){throw new s(o.ENOTSUP)}mkdir(t,e,r){r(new s(o.ENOTSUP))}mkdirSync(t,e){throw new s(o.ENOTSUP)}readdir(t,e){e(new s(o.ENOTSUP))}readdirSync(t){throw new s(o.ENOTSUP)}exists(t,e){this.stat(t,null,function(t){e(!t)})}existsSync(t){try{return this.statSync(t,!0),!0}catch(t){return!1}}realpath(t,e,r){if(this.supportsLinks()){const e=t.split(i.sep);for(let t=0;t<e.length;t++){const r=e.slice(0,t+1);e[t]=i.join.apply(null,r)}}else this.exists(t,function(e){e?r(null,t):r(s.ENOENT(t))})}realpathSync(t,e){if(this.supportsLinks()){const e=t.split(i.sep);for(let t=0;t<e.length;t++){const r=e.slice(0,t+1);e[t]=i.join.apply(i,r)}return e.join(i.sep)}if(this.existsSync(t))return t;throw s.ENOENT(t)}truncate(t,e,r){this.open(t,a.getFileFlag("r+"),420,function(t,i){if(t)return r(t);i.truncate(e,function(t){i.close(function(e){r(t||e)})})})}truncateSync(t,e){const r=this.openSync(t,a.getFileFlag("r+"),420);try{r.truncateSync(e)}catch(t){throw t}finally{r.closeSync()}}readFile(t,e,r,i){const n=i;this.open(t,r,420,(t,r)=>{if(t)return i(t);i=function(t,e){r.close(function(r){return t||(t=r),n(t,e)})},r.stat((t,n)=>{if(t)return i(t);const s=Buffer.alloc(n.size);r.read(s,0,n.size,0,t=>{if(t)return i(t);if(null===e)return i(t,s);try{i(null,s.toString(e))}catch(t){i(t)}})})})}readFileSync(t,e,r){const i=this.openSync(t,r,420);try{const t=i.statSync(),r=Buffer.alloc(t.size);return i.readSync(r,0,t.size,0),i.closeSync(),null===e?r:r.toString(e)}finally{i.closeSync()}}writeFile(t,e,r,i,n,s){const o=s;this.open(t,i,420,function(t,i){if(t)return s(t);s=function(t){i.close(function(e){o(t||e)})};try{"string"==typeof e&&(e=Buffer.from(e,r))}catch(t){return s(t)}i.write(e,0,e.length,0,s)})}writeFileSync(t,e,r,i,n){const s=this.openSync(t,i,n);try{"string"==typeof e&&(e=Buffer.from(e,r)),s.writeSync(e,0,e.length,0)}finally{s.closeSync()}}appendFile(t,e,r,i,n,s){const o=s;this.open(t,i,n,function(t,i){if(t)return s(t);s=function(t){i.close(function(e){o(t||e)})},"string"==typeof e&&(e=Buffer.from(e,r)),i.write(e,0,e.length,null,s)})}appendFileSync(t,e,r,i,n){const s=this.openSync(t,i,n);try{"string"==typeof e&&(e=Buffer.from(e,r)),s.writeSync(e,0,e.length,null)}finally{s.closeSync()}}chmod(t,e,r,i){i(new s(o.ENOTSUP))}chmodSync(t,e,r){throw new s(o.ENOTSUP)}chown(t,e,r,i,n){n(new s(o.ENOTSUP))}chownSync(t,e,r,i){throw new s(o.ENOTSUP)}utimes(t,e,r,i){i(new s(o.ENOTSUP))}utimesSync(t,e,r){throw new s(o.ENOTSUP)}link(t,e,r){r(new s(o.ENOTSUP))}linkSync(t,e){throw new s(o.ENOTSUP)}symlink(t,e,r,i){i(new s(o.ENOTSUP))}symlinkSync(t,e,r){throw new s(o.ENOTSUP)}readlink(t,e){e(new s(o.ENOTSUP))}readlinkSync(t){throw new s(o.ENOTSUP)}}return{BaseFileSystem:l,SynchronousFileSystem:class extends l{supportsSynch(){return!0}rename(t,e,r){try{this.renameSync(t,e),r()}catch(t){r(t)}}stat(t,e,r){try{r(null,this.statSync(t,e))}catch(t){r(t)}}open(t,e,r,i){try{i(null,this.openSync(t,e,r))}catch(t){i(t)}}unlink(t,e){try{this.unlinkSync(t),e()}catch(t){e(t)}}rmdir(t,e){try{this.rmdirSync(t),e()}catch(t){e(t)}}mkdir(t,e,r){try{this.mkdirSync(t,e),r()}catch(t){r(t)}}readdir(t,e){try{e(null,this.readdirSync(t))}catch(t){e(t)}}chmod(t,e,r,i){try{this.chmodSync(t,e,r),i()}catch(t){i(t)}}chown(t,e,r,i,n){try{this.chownSync(t,e,r,i),n()}catch(t){n(t)}}utimes(t,e,r,i){try{this.utimesSync(t,e,r),i()}catch(t){i(t)}}link(t,e,r){try{this.linkSync(t,e),r()}catch(t){r(t)}}symlink(t,e,r,i){try{this.symlinkSync(t,e,r),i()}catch(t){i(t)}}readlink(t,e){try{e(null,this.readlinkSync(t))}catch(t){e(t)}}}}}),t("skylark-browserfs/core/file",["./api_error"],function(t){"use strict";const{ApiError:e,ErrorCode:r}=t;return{BaseFile:class{sync(t){t(new e(r.ENOTSUP))}syncSync(){throw new e(r.ENOTSUP)}datasync(t){this.sync(t)}datasyncSync(){return this.syncSync()}chown(t,i,n){n(new e(r.ENOTSUP))}chownSync(t,i){throw new e(r.ENOTSUP)}chmod(t,i){i(new e(r.ENOTSUP))}chmodSync(t){throw new e(r.ENOTSUP)}utimes(t,i,n){n(new e(r.ENOTSUP))}utimesSync(t,i){throw new e(r.ENOTSUP)}}}}),t("skylark-browserfs/generic/preload_file",["../libs/buffers","../core/file","../core/node_fs_stats","../core/api_error","../core/node_fs","../core/util"],function(t,e,r,i,n,s){"use strict";const{BaseFile:o}=e,{ApiError:a,ErrorCode:c}=i,{emptyBuffer:h}=s,{Buffer:l}=t;class u extends o{constructor(t,e,r,i,n){if(super(),this._pos=0,this._dirty=!1,this._fs=t,this._path=e,this._flag=r,this._stat=i,this._buffer=n||h(),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw new Error(`Invalid buffer: Buffer is ${this._buffer.length} long, yet Stats object specifies that file is ${this._stat.size} long.`)}getBuffer(){return this._buffer}getStats(){return this._stat}getFlag(){return this._flag}getPath(){return this._path}getPos(){return this._flag.isAppendable()?this._stat.size:this._pos}advancePos(t){return this._pos+=t}setPos(t){return this._pos=t}sync(t){try{this.syncSync(),t()}catch(e){t(e)}}syncSync(){throw new a(c.ENOTSUP)}close(t){try{this.closeSync(),t()}catch(e){t(e)}}closeSync(){throw new a(c.ENOTSUP)}stat(t){try{t(null,r.clone(this._stat))}catch(e){t(e)}}statSync(){return r.clone(this._stat)}truncate(t,e){try{this.truncateSync(t),this._flag.isSynchronous()&&!n.getRootFS().supportsSynch()&&this.sync(e),e()}catch(t){return e(t)}}truncateSync(t){if(this._dirty=!0,!this._flag.isWriteable())throw new a(c.EPERM,"File not opened with a writeable mode.");if(this._stat.mtimeMs=Date.now(),t>this._buffer.length){const e=l.alloc(t-this._buffer.length,0);return this.writeSync(e,0,e.length,this._buffer.length),void(this._flag.isSynchronous()&&n.getRootFS().supportsSynch()&&this.syncSync())}this._stat.size=t;const e=l.alloc(t);this._buffer.copy(e,0,0,t),this._buffer=e,this._flag.isSynchronous()&&n.getRootFS().supportsSynch()&&this.syncSync()}write(t,e,r,i,n){try{n(null,this.writeSync(t,e,r,i),t)}catch(t){n(t)}}writeSync(t,e,r,i){if(this._dirty=!0,void 0!==i&&null!==i||(i=this.getPos()),!this._flag.isWriteable())throw new a(c.EPERM,"File not opened with a writeable mode.");const n=i+r;if(n>this._stat.size&&(this._stat.size=n,n>this._buffer.length)){const t=l.alloc(n);this._buffer.copy(t),this._buffer=t}const s=t.copy(this._buffer,i,e,e+r);return this._stat.mtimeMs=Date.now(),this._flag.isSynchronous()?(this.syncSync(),s):(this.setPos(i+s),s)}read(t,e,r,i,n){try{n(null,this.readSync(t,e,r,i),t)}catch(t){n(t)}}readSync(t,e,r,i){if(!this._flag.isReadable())throw new a(c.EPERM,"File not opened with a readable mode.");void 0!==i&&null!==i||(i=this.getPos());const n=i+r;n>this._stat.size&&(r=this._stat.size-i);const s=this._buffer.copy(t,e,i,i+r);return this._stat.atimeMs=Date.now(),this._pos=i+r,s}chmod(t,e){try{this.chmodSync(t),e()}catch(t){e(t)}}chmodSync(t){if(!this._fs.supportsProps())throw new a(c.ENOTSUP);this._dirty=!0,this._stat.chmod(t),this.syncSync()}isDirty(){return this._dirty}resetDirty(){this._dirty=!1}}return{PreloadFile:u,NoSyncFile:class extends u{constructor(t,e,r,i,n){super(t,e,r,i,n)}sync(t){t()}syncSync(){}close(t){t()}closeSync(){}}}}),t("skylark-browserfs/backend/AsyncMirror",["../core/file_system","../core/api_error","../core/file_flag","../generic/preload_file","../libs/path"],function(t,e,r,i,n){"use strict";const{SynchronousFileSystem:s}=t,{ApiError:o,ErrorCode:a}=e,{FileFlag:c}=r,{PreloadFile:h}=i;class l extends h{constructor(t,e,r,i,n){super(t,e,r,i,n)}syncSync(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())}closeSync(){this.syncSync()}}class u extends s{constructor(t,e){super(),this._queue=[],this._queueRunning=!1,this._isInitialized=!1,this._initializeCallbacks=[],this._sync=t,this._async=e}static Create(t,e){try{const r=new u(t.sync,t.async);r._initialize(t=>{t?e(t):e(null,r)})}catch(t){e(t)}}static isAvailable(){return!0}getName(){return u.Name}_syncSync(t){this._sync.writeFileSync(t.getPath(),t.getBuffer(),null,c.getFileFlag("w"),t.getStats().mode),this.enqueueOp({apiMethod:"writeFile",arguments:[t.getPath(),t.getBuffer(),null,t.getFlag(),t.getStats().mode]})}isReadOnly(){return!1}supportsSynch(){return!0}supportsLinks(){return!1}supportsProps(){return this._sync.supportsProps()&&this._async.supportsProps()}renameSync(t,e){this._sync.renameSync(t,e),this.enqueueOp({apiMethod:"rename",arguments:[t,e]})}statSync(t,e){return this._sync.statSync(t,e)}openSync(t,e,r){const i=this._sync.openSync(t,e,r);return i.closeSync(),new l(this,t,e,this._sync.statSync(t,!1),this._sync.readFileSync(t,null,c.getFileFlag("r")))}unlinkSync(t){this._sync.unlinkSync(t),this.enqueueOp({apiMethod:"unlink",arguments:[t]})}rmdirSync(t){this._sync.rmdirSync(t),this.enqueueOp({apiMethod:"rmdir",arguments:[t]})}mkdirSync(t,e){this._sync.mkdirSync(t,e),this.enqueueOp({apiMethod:"mkdir",arguments:[t,e]})}readdirSync(t){return this._sync.readdirSync(t)}existsSync(t){return this._sync.existsSync(t)}chmodSync(t,e,r){this._sync.chmodSync(t,e,r),this.enqueueOp({apiMethod:"chmod",arguments:[t,e,r]})}chownSync(t,e,r,i){this._sync.chownSync(t,e,r,i),this.enqueueOp({apiMethod:"chown",arguments:[t,e,r,i]})}utimesSync(t,e,r){this._sync.utimesSync(t,e,r),this.enqueueOp({apiMethod:"utimes",arguments:[t,e,r]})}_initialize(t){const e=this._initializeCallbacks,r=t=>{this._isInitialized=!t,this._initializeCallbacks=[],e.forEach(e=>e(t))};if(this._isInitialized)t();else if(1===e.push(t)){const t=(t,e,r)=>{"/"!==t&&this._sync.mkdirSync(t,e),this._async.readdir(t,(e,s)=>{let o=0;e?r(e):function e(a){a?r(a):o<s.length?(i(n.join(t,s[o]),e),o++):r()}()})},e=(t,e,r)=>{this._async.readFile(t,null,c.getFileFlag("r"),(i,n)=>{if(i)r(i);else try{this._sync.writeFileSync(t,n,null,c.getFileFlag("w"),e)}catch(t){i=t}finally{r(i)}})},i=(r,i)=>{this._async.stat(r,!1,(n,s)=>{n?i(n):s.isDirectory()?t(r,s.mode,i):e(r,s.mode,i)})};t("/",0,r)}}enqueueOp(t){if(this._queue.push(t),!this._queueRunning){this._queueRunning=!0;const t=e=>{if(e)throw new Error(`WARNING: File system has desynchronized. Received following error: ${e}\n$`);if(this._queue.length>0){const e=this._queue.shift(),r=e.arguments;r.push(t),this._async[e.apiMethod].apply(this._async,r)}else this._queueRunning=!1};t()}}}return u.Name="AsyncMirror",u.Options={sync:{type:"object",description:"The synchronous file system to mirror the asynchronous file system to.",validator:(t,e)=>{t&&"function"==typeof t.supportsSynch&&t.supportsSynch()?e():e(new o(a.EINVAL,"'sync' option must be a file system that supports synchronous operations"))}},async:{type:"object",description:"The asynchronous file system to mirror."}},u}),t("skylark-browserfs/backend/Dropbox",["../libs/buffers","../generic/preload_file","../core/file_system","../core/node_fs_stats","../core/api_error","../core/util","../generic/setImmediate","../libs/path"],function(t,e,r,i,n,s,o,a){"use strict";const{BaseFileSystem:c}=r,{Stats:h,FileType:l}=i,{ApiError:u,ErrorCode:f}=n,{arrayBuffer2Buffer:d,buffer2ArrayBuffer:p}=s,{dirname:y}=a,{PreloadFile:g}=e,{Buffer:m}=t;function w(t){return"/"===t?"":t}function _(t){const e=t.error;if(e[".tag"])return e;if(e.error){const t=e.error;return t[".tag"]?t:t.reason&&t.reason[".tag"]?t.reason:t}if("string"==typeof e)try{const r=JSON.parse(e);if(r.error&&r.error.reason&&r.error.reason[".tag"])return r.error.reason}catch(t){}return e}function E(t){if(t.user_message)return t.user_message.text;if(t.error_summary)return t.error_summary;if("string"==typeof t.error)return t.error;if("object"==typeof t.error)return E(t.error);throw new Error(`Dropbox's servers gave us a garbage error message: ${JSON.stringify(t)}`)}function S(t,e,r){switch(t[".tag"]){case"malformed_path":return new u(f.EBADF,r,e);case"not_found":return u.ENOENT(e);case"not_file":return u.EISDIR(e);case"not_folder":return u.ENOTDIR(e);case"restricted_content":return u.EPERM(e);case"other":default:return new u(f.EIO,r,e)}}function b(t,e,r){switch(t[".tag"]){case"malformed_path":case"disallowed_name":return new u(f.EBADF,r,e);case"conflict":case"no_write_permission":case"team_folder":return u.EPERM(e);case"insufficient_space":return new u(f.ENOSPC,r);case"other":default:return new u(f.EIO,r,e)}}function F(t,e,r){const i={path:w(e)};t.filesDeleteV2(i).then(()=>{r()}).catch(i=>{const n=_(i);switch(n[".tag"]){case"path_lookup":r(S(n.path_lookup,e,E(i)));break;case"path_write":r(b(n.path_write,e,E(i)));break;case"too_many_write_operations":setTimeout(()=>F(t,e,r),500+300*Math.random());break;case"other":default:r(new u(f.EIO,E(i),e))}})}class I extends g{constructor(t,e,r,i,n){super(t,e,r,i,n)}sync(t){this._fs._syncFile(this.getPath(),this.getBuffer(),t)}close(t){this.sync(t)}}class k extends c{constructor(t){super(),this._client=t}static Create(t,e){e(null,new k(t.client))}static isAvailable(){return"undefined"!=typeof Dropbox}getName(){return k.Name}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!1}empty(t){this.readdir("/",(e,r)=>{if(r){const e=i=>{0===r.length?t():F(this._client,r.shift(),e)};e()}else t(e)})}rename(t,e,r){this.stat(e,!1,(i,n)=>{const s=()=>{const i={from_path:w(t),to_path:w(e)};this._client.filesMoveV2(i).then(()=>r()).catch(function(i){const n=_(i);switch(n[".tag"]){case"from_lookup":r(S(n.from_lookup,t,E(i)));break;case"from_write":r(b(n.from_write,t,E(i)));break;case"to":r(b(n.to,e,E(i)));break;case"cant_copy_shared_folder":case"cant_nest_shared_folder":r(new u(f.EPERM,E(i),t));break;case"cant_move_folder_into_itself":case"duplicated_or_nested_paths":r(new u(f.EBADF,E(i),t));break;case"too_many_files":r(new u(f.ENOSPC,E(i),t));break;case"other":default:r(new u(f.EIO,E(i),t))}})};i?s():t===e?i?r(u.ENOENT(e)):r():n&&n.isDirectory()?r(u.EISDIR(e)):this.unlink(e,t=>{t?r(t):s()})})}stat(t,e,r){if("/"===t)return void o(function(){r(null,new h(l.DIRECTORY,4096))});const i={path:w(t)};this._client.filesGetMetadata(i).then(e=>{switch(e[".tag"]){case"file":const i=e;r(null,new h(l.FILE,i.size));break;case"folder":r(null,new h(l.DIRECTORY,4096));break;case"deleted":r(u.ENOENT(t))}}).catch(e=>{const i=_(e);switch(i[".tag"]){case"path":r(S(i.path,t,E(e)));break;default:r(new u(f.EIO,E(e),t))}})}openFile(t,e,r){const i={path:w(t)};this._client.filesDownload(i).then(i=>{const n=i.fileBlob,s=new FileReader;s.onload=(()=>{const i=s.result;r(null,new I(this,t,e,new h(l.FILE,i.byteLength),d(i)))}),s.readAsArrayBuffer(n)}).catch(e=>{const i=_(e);switch(i[".tag"]){case"path":const n=i;r(S(n.path,t,E(e)));break;case"other":default:r(new u(f.EIO,E(e),t))}})}createFile(t,e,r,i){const n=m.alloc(0),s=new Blob([p(n)],{type:"octet/stream"}),o={contents:s,path:w(t)};this._client.filesUpload(o).then(r=>{i(null,new I(this,t,e,new h(l.FILE,0),n))}).catch(n=>{const s=_(n);switch(s[".tag"]){case"path":const o=s;i(b(o.path.reason,t,E(n)));break;case"too_many_write_operations":setTimeout(()=>this.createFile(t,e,r,i),500+300*Math.random());break;case"other":default:i(new u(f.EIO,E(n),t))}})}unlink(t,e){this.stat(t,!1,(r,i)=>{i?i.isDirectory()?e(u.EISDIR(t)):F(this._client,t,e):e(r)})}rmdir(t,e){this.readdir(t,(r,i)=>{i?i.length>0?e(u.ENOTEMPTY(t)):F(this._client,t,e):e(r)})}mkdir(t,e,r){const i=y(t);this.stat(i,!1,(n,s)=>{if(n)r(n);else if(s&&!s.isDirectory())r(u.ENOTDIR(i));else{const i={path:w(t)};this._client.filesCreateFolderV2(i).then(()=>r()).catch(i=>{const n=_(i);"too_many_write_operations"===n[".tag"]?setTimeout(()=>this.mkdir(t,e,r),500+300*Math.random()):r(b(_(i).path,t,E(i)))})}})}readdir(t,e){const r={path:w(t)};this._client.filesListFolder(r).then(r=>{!function t(e,r,i,n,s){const o=i.entries.map(t=>t.path_display).filter(t=>!!t);const a=n.concat(o);if(i.has_more){const n={cursor:i.cursor};e.filesListFolderContinue(n).then(i=>{t(e,r,i,a,s)}).catch(t=>{N(t,r,s)})}else s(null,a)}(this._client,t,r,[],e)}).catch(r=>{N(r,t,e)})}_syncFile(t,e,r){const i=new Blob([p(e)],{type:"octet/stream"}),n={contents:i,path:w(t),mode:{".tag":"overwrite"}};this._client.filesUpload(n).then(()=>{r()}).catch(i=>{const n=_(i);switch(n[".tag"]){case"path":const s=n;r(b(s.path.reason,t,E(i)));break;case"too_many_write_operations":setTimeout(()=>this._syncFile(t,e,r),500+300*Math.random());break;case"other":default:r(new u(f.EIO,E(i),t))}})}}function N(t,e,r){const i=_(t);switch(i[".tag"]){case"path":const n=i;r(S(n.path,e,E(t)));break;case"other":default:r(new u(f.EIO,E(t),e))}}return k.Name="DropboxV2",k.Options={client:{type:"object",description:"An *authenticated* Dropbox client. Must be from the 2.5.x JS SDK."}},k.DropboxFile=I,k}),t("skylark-browserfs/backend/Emscripten",["../libs/buffers","../core/file_system","../core/node_fs_stats","../core/file","../core/util","../core/api_error"],function(t,e,r,i,n,s){"use strict";const{SynchronousFileSystem:o}=e,{Stats:a,FileType:c}=r,{BaseFile:h}=i,{uint8Array2Buffer:l,buffer2Uint8array:u}=n,{ApiError:f,ErrorCode:d,ErrorStrings:p}=s,{Buffer:y}=t;function g(t,e=""){const r=t.errno;let i=t.node;const n=[];for(;i&&(n.unshift(i.name),i!==i.parent);)i=i.parent;return new f(r,p[r],n.length>0?"/"+n.join("/"):e)}class m extends h{constructor(t,e,r,i){super(),this._fs=t,this._FS=e,this._path=r,this._stream=i}getPos(){}close(t){let e=null;try{this.closeSync()}catch(t){e=t}finally{t(e)}}closeSync(){try{this._FS.close(this._stream)}catch(t){throw g(t,this._path)}}stat(t){try{t(null,this.statSync())}catch(e){t(e)}}statSync(){try{return this._fs.statSync(this._path,!1)}catch(t){throw g(t,this._path)}}truncate(t,e){let r=null;try{this.truncateSync(t)}catch(t){r=t}finally{e(r)}}truncateSync(t){try{this._FS.ftruncate(this._stream.fd,t)}catch(t){throw g(t,this._path)}}write(t,e,r,i,n){try{n(null,this.writeSync(t,e,r,i),t)}catch(t){n(t)}}writeSync(t,e,r,i){try{const n=u(t),s=null===i?void 0:i;return this._FS.write(this._stream,n,e,r,s)}catch(t){throw g(t,this._path)}}read(t,e,r,i,n){try{n(null,this.readSync(t,e,r,i),t)}catch(t){n(t)}}readSync(t,e,r,i){try{const n=u(t),s=null===i?void 0:i;return this._FS.read(this._stream,n,e,r,s)}catch(t){throw g(t,this._path)}}sync(t){t()}syncSync(){}chown(t,e,r){let i=null;try{this.chownSync(t,e)}catch(t){i=t}finally{r(i)}}chownSync(t,e){try{this._FS.fchown(this._stream.fd,t,e)}catch(t){throw g(t,this._path)}}chmod(t,e){let r=null;try{this.chmodSync(t)}catch(t){r=t}finally{e(r)}}chmodSync(t){try{this._FS.fchmod(this._stream.fd,t)}catch(t){throw g(t,this._path)}}utimes(t,e,r){let i=null;try{this.utimesSync(t,e)}catch(t){i=t}finally{r(i)}}utimesSync(t,e){this._fs.utimesSync(this._path,t,e)}}class w extends o{constructor(t){super(),this._FS=t}static Create(t,e){e(null,new w(t.FS))}static isAvailable(){return!0}getName(){return this._FS.DB_NAME()}isReadOnly(){return!1}supportsLinks(){return!0}supportsProps(){return!0}supportsSynch(){return!0}renameSync(t,e){try{this._FS.rename(t,e)}catch(r){throw r.errno===d.ENOENT?g(r,this.existsSync(t)?e:t):g(r)}}statSync(t,e){try{const r=e?this._FS.lstat(t):this._FS.stat(t),i=this.modeToFileType(r.mode);return new a(i,r.size,r.mode,r.atime.getTime(),r.mtime.getTime(),r.ctime.getTime())}catch(e){throw g(e,t)}}openSync(t,e,r){try{const i=this._FS.open(t,e.getFlagString(),r);if(this._FS.isDir(i.node.mode))throw this._FS.close(i),f.EISDIR(t);return new m(this,this._FS,t,i)}catch(e){throw g(e,t)}}unlinkSync(t){try{this._FS.unlink(t)}catch(e){throw g(e,t)}}rmdirSync(t){try{this._FS.rmdir(t)}catch(e){throw g(e,t)}}mkdirSync(t,e){try{this._FS.mkdir(t,e)}catch(e){throw g(e,t)}}readdirSync(t){try{return this._FS.readdir(t).filter(t=>"."!==t&&".."!==t)}catch(e){throw g(e,t)}}truncateSync(t,e){try{this._FS.truncate(t,e)}catch(e){throw g(e,t)}}readFileSync(t,e,r){try{const i=this._FS.readFile(t,{flags:r.getFlagString()}),n=l(i);return e?n.toString(e):n}catch(e){throw g(e,t)}}writeFileSync(t,e,r,i,n){try{r&&(e=y.from(e,r));const s=u(e);this._FS.writeFile(t,s,{flags:i.getFlagString(),encoding:"binary"}),this._FS.chmod(t,n)}catch(e){throw g(e,t)}}chmodSync(t,e,r){try{e?this._FS.lchmod(t,r):this._FS.chmod(t,r)}catch(e){throw g(e,t)}}chownSync(t,e,r,i){try{e?this._FS.lchown(t,r,i):this._FS.chown(t,r,i)}catch(e){throw g(e,t)}}symlinkSync(t,e,r){try{this._FS.symlink(t,e)}catch(t){throw g(t)}}readlinkSync(t){try{return this._FS.readlink(t)}catch(e){throw g(e,t)}}utimesSync(t,e,r){try{this._FS.utime(t,e.getTime(),r.getTime())}catch(e){throw g(e,t)}}modeToFileType(t){if(this._FS.isDir(t))return c.DIRECTORY;if(this._FS.isFile(t))return c.FILE;if(this._FS.isLink(t))return c.SYMLINK;throw f.EPERM(`Invalid mode: ${t}`)}}return w.Name="EmscriptenFileSystem",w.Options={FS:{type:"object",description:"The Emscripten file system to use (the `FS` variable)"}},w.EmscriptenFile=m,w}),t("skylark-browserfs/backend/FolderAdapter",["../core/file_system","../libs/path","../core/api_error"],function(t,e,r){"use strict";const{BaseFileSystem:i}=t,{ApiError:n}=r;class s extends i{constructor(t,e){super(),this._folder=t,this._wrapped=e}static Create(t,e){const r=new s(t.folder,t.wrapped);r._initialize(function(t){t?e(t):e(null,r)})}static isAvailable(){return!0}getName(){return this._wrapped.getName()}isReadOnly(){return this._wrapped.isReadOnly()}supportsProps(){return this._wrapped.supportsProps()}supportsSynch(){return this._wrapped.supportsSynch()}supportsLinks(){return!1}_initialize(t){this._wrapped.exists(this._folder,e=>{e?t():this._wrapped.isReadOnly()?t(n.ENOENT(this._folder)):this._wrapped.mkdir(this._folder,511,t)})}}function o(t,r){if(null!==r&&"object"==typeof r){const i=r;let n=i.path;n&&(n="/"+e.relative(t,n),i.message=i.message.replace(i.path,n),i.path=n)}return r}function a(t,r,i){return"Sync"!==t.slice(t.length-4)?function(){var n,s;return arguments.length>0&&(r&&(arguments[0]=e.join(this._folder,arguments[0])),i&&(arguments[1]=e.join(this._folder,arguments[1])),arguments[arguments.length-1]=(n=this._folder,"function"==typeof(s=arguments[arguments.length-1])?function(t){arguments.length>0&&(arguments[0]=o(n,t)),s.apply(null,arguments)}:s)),this._wrapped[t].apply(this._wrapped,arguments)}:function(){try{return r&&(arguments[0]=e.join(this._folder,arguments[0])),i&&(arguments[1]=e.join(this._folder,arguments[1])),this._wrapped[t].apply(this._wrapped,arguments)}catch(t){throw o(this._folder,t)}}}return s.Name="FolderAdapter",s.Options={folder:{type:"string",description:"The folder to use as the root directory"},wrapped:{type:"object",description:"The file system to wrap"}},["diskSpace","stat","statSync","open","openSync","unlink","unlinkSync","rmdir","rmdirSync","mkdir","mkdirSync","readdir","readdirSync","exists","existsSync","realpath","realpathSync","truncate","truncateSync","readFile","readFileSync","writeFile","writeFileSync","appendFile","appendFileSync","chmod","chmodSync","chown","chownSync","utimes","utimesSync","readlink","readlinkSync"].forEach(t=>{s.prototype[t]=a(t,!0,!1)}),["rename","renameSync","link","linkSync","symlink","symlinkSync"].forEach(t=>{s.prototype[t]=a(t,!0,!0)}),s}),t("skylark-browserfs/backend/HTML5FS",["skylark-langx-async","../generic/preload_file","../core/file_system","../core/api_error","../core/file_flag","../core/node_fs_stats","../libs/path","../core/global","../core/util"],function(t,e,r,i,n,s,o,a,c){"use strict";const{BaseFileSystem:h}=r,{ApiError:l,ErrorCode:u}=i,{ActionType:f}=n,{Stats:d,FileType:p}=s,y=t.each,{buffer2ArrayBuffer:g,arrayBuffer2Buffer:m}=c,{PreloadFile:w}=e;const _=a.webkitRequestFileSystem||a.requestFileSystem||null;function E(t,e,r){switch(t.name){case"PathExistsError":return l.EEXIST(e);case"QuotaExceededError":return l.FileError(u.ENOSPC,e);case"NotFoundError":return l.ENOENT(e);case"SecurityError":return l.FileError(u.EACCES,e);case"InvalidModificationError":return l.FileError(u.EPERM,e);case"TypeMismatchError":return l.FileError(r?u.ENOTDIR:u.EISDIR,e);case"EncodingError":case"InvalidStateError":case"NoModificationAllowedError":default:return l.FileError(u.EINVAL,e)}}class S extends w{constructor(t,e,r,i,n,s){super(t,r,i,n,s),this._entry=e}sync(t){if(!this.isDirty())return t();this._entry.createWriter(e=>{const r=this.getBuffer(),i=new Blob([g(r)]),n=i.size;e.onwriteend=(r=>{e.onwriteend=null,e.onerror=null,e.truncate(n),this.resetDirty(),t()}),e.onerror=(e=>{t(E(e,this.getPath(),!1))}),e.write(i)})}close(t){this.sync(t)}}class b extends h{constructor(t=5,e=a.PERSISTENT){super(),this.size=1048576*t,this.type=e}static Create(t,e){const r=new b(t.size,t.type);r._allocate(t=>t?e(t):e(null,r))}static isAvailable(){return!!_}getName(){return b.Name}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!1}empty(t){this._readdir("/",(e,r)=>{if(e)t(e);else{const i=r=>{e?t(e):t()},n=(t,e)=>{const r=()=>{e()},i=r=>{e(E(r,t.fullPath,!t.isDirectory))};t.isDirectory?t.removeRecursively(r,i):t.remove(r,i)};y(r,n,i)}})}rename(t,e,r){let i=2,n=0;const s=this.fs.root;let a=t;const c=t=>{--i<=0&&r(E(t,a,!1))},h=i=>2==++n?r(new l(u.EINVAL,"Something was identified as both a file and a directory. This should never happen.")):t===e?r():(a=o.dirname(e),void s.getDirectory(a,{},n=>{a=o.basename(e),i.moveTo(n,a,t=>{r()},n=>{i.isDirectory?(a=e,this.unlink(e,i=>{i?c(n):this.rename(t,e,r)})):c(n)})},c));s.getFile(t,{},h,c),s.getDirectory(t,{},h,c)}stat(t,e,r){const i={create:!1},n=t=>{const e=new d(p.DIRECTORY,4096);r(null,e)},s=e=>{r(E(e,t,!1))};this.fs.root.getFile(t,i,t=>{t.file(t=>{const e=new d(p.FILE,t.size);r(null,e)},s)},()=>{this.fs.root.getDirectory(t,i,n,s)})}open(t,e,r,i){const n=r=>{"InvalidModificationError"===r.name&&e.isExclusive()?i(l.EEXIST(t)):i(E(r,t,!1))};this.fs.root.getFile(t,{create:e.pathNotExistsAction()===f.CREATE_FILE,exclusive:e.isExclusive()},r=>{r.file(s=>{const o=new FileReader;o.onloadend=(n=>{const a=this._makeFile(t,r,e,s,o.result);i(null,a)}),o.onerror=(t=>{n(o.error)}),o.readAsArrayBuffer(s)},n)},n)}unlink(t,e){this._remove(t,e,!0)}rmdir(t,e){this.readdir(t,(r,i)=>{r?e(r):i.length>0?e(l.ENOTEMPTY(t)):this._remove(t,e,!1)})}mkdir(t,e,r){this.fs.root.getDirectory(t,{create:!0,exclusive:!0},t=>{r()},e=>{r(E(e,t,!0))})}readdir(t,e){this._readdir(t,(t,r)=>{if(!r)return e(t);{const t=[];for(const e of r)t.push(e.name);e(null,t)}})}_makeFile(t,e,r,i,n=new ArrayBuffer(0)){const s=new d(p.FILE,i.size),o=m(n);return new S(this,e,t,r,s,o)}_readdir(t,e){const r=r=>{e(E(r,t,!0))};var i;this.fs.root.getDirectory(t,{create:!1},t=>{const n=t.createReader();let s=[];const o=()=>{n.readEntries(t=>{t.length?(s=s.concat((i=t,Array.prototype.slice.call(i||[],0))),o()):e(null,s)},r)};o()},r)}_allocate(t){const e=e=>{this.fs=e,t()},r=e=>{t(E(e,"/",!0))};this.type===a.PERSISTENT?function(t,e,r,i){if(void 0!==navigator.webkitPersistentStorage)switch(t){case a.PERSISTENT:navigator.webkitPersistentStorage.requestQuota(e,r,i);break;case a.TEMPORARY:navigator.webkitTemporaryStorage.requestQuota(e,r,i);break;default:i(new TypeError(`Invalid storage type: ${t}`))}else a.webkitStorageInfo.requestQuota(t,e,r,i)}(this.type,this.size,t=>{_(this.type,t,e,r)},r):_(this.type,this.size,e,r)}_remove(t,e,r){const i=i=>{i.remove(()=>{e()},i=>{e(E(i,t,!r))})},n=i=>{e(E(i,t,!r))},s={create:!1};r?this.fs.root.getFile(t,s,i,n):this.fs.root.getDirectory(t,s,i,n)}}return b.Name="HTML5FS",b.Options={size:{type:"number",optional:!0,description:"Storage quota to request, in megabytes. Allocated value may be less. Defaults to 5."},type:{type:"number",optional:!0,description:"window.PERSISTENT or window.TEMPORARY. Defaults to PERSISTENT."}},b.HTML5FSFile=S,b}),t("skylark-browserfs/generic/inode",["../libs/buffers","../core/node_fs_stats"],function(t,e){"use strict";const{Stats:r,FileType:i}=e,{Buffer:n}=t;class s{constructor(t,e,r,i,n,s){this.id=t,this.size=e,this.mode=r,this.atime=i,this.mtime=n,this.ctime=s}static fromBuffer(t){if(void 0===t)throw new Error("NO");return new s(t.toString("ascii",30),t.readUInt32LE(0),t.readUInt16LE(4),t.readDoubleLE(6),t.readDoubleLE(14),t.readDoubleLE(22))}toStats(){return new r((61440&this.mode)===i.DIRECTORY?i.DIRECTORY:i.FILE,this.size,this.mode,this.atime,this.mtime,this.ctime)}getSize(){return 30+this.id.length}toBuffer(t=n.alloc(this.getSize())){return t.writeUInt32LE(this.size,0),t.writeUInt16LE(this.mode,4),t.writeDoubleLE(this.atime,6),t.writeDoubleLE(this.mtime,14),t.writeDoubleLE(this.ctime,22),t.write(this.id,30,this.id.length,"ascii"),t}update(t){let e=!1;this.size!==t.size&&(this.size=t.size,e=!0),this.mode!==t.mode&&(this.mode=t.mode,e=!0);const r=t.atime.getTime();this.atime!==r&&(this.atime=r,e=!0);const i=t.mtime.getTime();this.mtime!==i&&(this.mtime=i,e=!0);const n=t.ctime.getTime();return this.ctime!==n&&(this.ctime=n,e=!0),e}isFile(){return(61440&this.mode)===i.FILE}isDirectory(){return(61440&this.mode)===i.DIRECTORY}}return s}),t("skylark-browserfs/generic/key_value_filesystem",["../libs/buffers","../core/file_system","../core/api_error","../core/node_fs_stats","../libs/path","../generic/inode","../generic/preload_file","../core/util"],function(t,e,r,i,n,s,o,a){"use strict";const{BaseFileSystem:c,SynchronousFileSystem:h}=e,{ApiError:l,ErrorCode:u}=r,{FileType:f}=i,{emptyBuffer:d}=a,{PreloadFile:p}=o,{Buffer:y}=t,g="/";let m=null;function w(){return m||(m=y.from("{}"))}function _(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0,r="x"===t?e:3&e|8;return r.toString(16)})}function E(t,e){return!t||(e(t),!1)}function S(t,e,r){return!t||(e.abort(()=>{r(t)}),!1)}class b{constructor(t,e){this.key=t,this.value=e,this.prev=null,this.next=null}}class F{constructor(t){this.limit=t,this.size=0,this.map={},this.head=null,this.tail=null}set(t,e){const r=new b(t,e);this.map[t]?(this.map[t].value=r.value,this.remove(r.key)):this.size>=this.limit&&(delete this.map[this.tail.key],this.size--,this.tail=this.tail.prev,this.tail.next=null),this.setHead(r)}get(t){if(this.map[t]){const e=this.map[t].value,r=new b(t,e);return this.remove(t),this.setHead(r),e}return null}remove(t){const e=this.map[t];e&&(null!==e.prev?e.prev.next=e.next:this.head=e.next,null!==e.next?e.next.prev=e.prev:this.tail=e.prev,delete this.map[t],this.size--)}removeAll(){this.size=0,this.map={},this.head=null,this.tail=null}setHead(t){t.next=this.head,t.prev=null,null!==this.head&&(this.head.prev=t),this.head=t,null===this.tail&&(this.tail=t),this.size++,this.map[t.key]=t}}class I extends p{constructor(t,e,r,i,n){super(t,e,r,i,n)}syncSync(){this.isDirty()&&(this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())}closeSync(){this.syncSync()}}class k extends p{constructor(t,e,r,i,n){super(t,e,r,i,n)}sync(t){this.isDirty()?this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),e=>{e||this.resetDirty(),t(e)}):t()}close(t){this.sync(t)}}return{SimpleSyncRWTransaction:class{constructor(t){this.store=t,this.originalData={},this.modifiedKeys=[]}get(t){const e=this.store.get(t);return this.stashOldValue(t,e),e}put(t,e,r){return this.markModified(t),this.store.put(t,e,r)}del(t){this.markModified(t),this.store.del(t)}commit(){}abort(){for(const t of this.modifiedKeys){const e=this.originalData[t];e?this.store.put(t,e,!0):this.store.del(t)}}stashOldValue(t,e){this.originalData.hasOwnProperty(t)||(this.originalData[t]=e)}markModified(t){-1===this.modifiedKeys.indexOf(t)&&(this.modifiedKeys.push(t),this.originalData.hasOwnProperty(t)||(this.originalData[t]=this.store.get(t)))}},SyncKeyValueFile:I,SyncKeyValueFileSystem:class extends h{static isAvailable(){return!0}constructor(t){super(),this.store=t.store,this.makeRootDirectory()}getName(){return this.store.name()}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!0}empty(){this.store.clear(),this.makeRootDirectory()}renameSync(t,e){const r=this.store.beginTransaction("readwrite"),i=n.dirname(t),s=n.basename(t),o=n.dirname(e),a=n.basename(e),c=this.findINode(r,i),h=this.getDirListing(r,i,c);if(!h[s])throw l.ENOENT(t);const f=h[s];if(delete h[s],0===(o+"/").indexOf(t+"/"))throw new l(u.EBUSY,i);let d,p;if(o===i?(d=c,p=h):(d=this.findINode(r,o),p=this.getDirListing(r,o,d)),p[a]){const t=this.getINode(r,e,p[a]);if(!t.isFile())throw l.EPERM(e);try{r.del(t.id),r.del(p[a])}catch(t){throw r.abort(),t}}p[a]=f;try{r.put(c.id,y.from(JSON.stringify(h)),!0),r.put(d.id,y.from(JSON.stringify(p)),!0)}catch(t){throw r.abort(),t}r.commit()}statSync(t,e){return this.findINode(this.store.beginTransaction("readonly"),t).toStats()}createFileSync(t,e,r){const i=this.store.beginTransaction("readwrite"),n=d(),s=this.commitNewFile(i,t,f.FILE,r,n);return new I(this,t,e,s.toStats(),n)}openFileSync(t,e){const r=this.store.beginTransaction("readonly"),i=this.findINode(r,t),n=r.get(i.id);if(void 0===n)throw l.ENOENT(t);return new I(this,t,e,i.toStats(),n)}unlinkSync(t){this.removeEntry(t,!1)}rmdirSync(t){if(this.readdirSync(t).length>0)throw l.ENOTEMPTY(t);this.removeEntry(t,!0)}mkdirSync(t,e){const r=this.store.beginTransaction("readwrite"),i=y.from("{}");this.commitNewFile(r,t,f.DIRECTORY,e,i)}readdirSync(t){const e=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(e,t,this.findINode(e,t)))}_syncSync(t,e,r){const i=this.store.beginTransaction("readwrite"),s=this._findINode(i,n.dirname(t),n.basename(t)),o=this.getINode(i,t,s),a=o.update(r);try{i.put(o.id,e,!0),a&&i.put(s,o.toBuffer(),!0)}catch(t){throw i.abort(),t}i.commit()}makeRootDirectory(){const t=this.store.beginTransaction("readwrite");if(void 0===t.get(g)){const e=(new Date).getTime(),r=new s(_(),4096,511|f.DIRECTORY,e,e,e);t.put(r.id,w(),!1),t.put(g,r.toBuffer(),!1),t.commit()}}_findINode(t,e,r){const i=i=>{const s=this.getDirListing(t,e,i);if(s[r])return s[r];throw l.ENOENT(n.resolve(e,r))};return"/"===e?""===r?g:i(this.getINode(t,e,g)):i(this.getINode(t,e+n.sep+r,this._findINode(t,n.dirname(e),n.basename(e))))}findINode(t,e){return this.getINode(t,e,this._findINode(t,n.dirname(e),n.basename(e)))}getINode(t,e,r){const i=t.get(r);if(void 0===i)throw l.ENOENT(e);return s.fromBuffer(i)}getDirListing(t,e,r){if(!r.isDirectory())throw l.ENOTDIR(e);const i=t.get(r.id);if(void 0===i)throw l.ENOENT(e);return JSON.parse(i.toString())}addNewNode(t,e){let r;for(;;)try{return r=_(),t.put(r,e,!1),r}catch(t){}throw new l(u.EIO,"Unable to commit data to key-value store.")}commitNewFile(t,e,r,i,o){const a=n.dirname(e),c=n.basename(e),h=this.findINode(t,a),u=this.getDirListing(t,a,h),f=(new Date).getTime();if("/"===e)throw l.EEXIST(e);if(u[c])throw l.EEXIST(e);let d;try{const e=this.addNewNode(t,o);d=new s(e,o.length,i|r,f,f,f);const n=this.addNewNode(t,d.toBuffer());u[c]=n,t.put(h.id,y.from(JSON.stringify(u)),!0)}catch(e){throw t.abort(),e}return t.commit(),d}removeEntry(t,e){const r=this.store.beginTransaction("readwrite"),i=n.dirname(t),s=this.findINode(r,i),o=this.getDirListing(r,i,s),a=n.basename(t);if(!o[a])throw l.ENOENT(t);const c=o[a];delete o[a];const h=this.getINode(r,t,c);if(!e&&h.isDirectory())throw l.EISDIR(t);if(e&&!h.isDirectory())throw l.ENOTDIR(t);try{r.del(h.id),r.del(c),r.put(s.id,y.from(JSON.stringify(o)),!0)}catch(t){throw r.abort(),t}r.commit()}},AsyncKeyValueFile:k,AsyncKeyValueFileSystem:class extends c{constructor(t){super(),this._cache=null,t>0&&(this._cache=new F(t))}static isAvailable(){return!0}init(t,e){this.store=t,this.makeRootDirectory(e)}getName(){return this.store.name()}isReadOnly(){return!1}supportsSymlinks(){return!1}supportsProps(){return!1}supportsSynch(){return!1}empty(t){this._cache&&this._cache.removeAll(),this.store.clear(e=>{E(e,t)&&this.makeRootDirectory(t)})}rename(t,e,r){if(this._cache){const t=this._cache;this._cache=null,t.removeAll();const e=r;r=(r=>{this._cache=t,e(r)})}const i=this.store.beginTransaction("readwrite"),s=n.dirname(t),o=n.basename(t),a=n.dirname(e),c=n.basename(e),h={},f={};let d=!1;if(0===(a+"/").indexOf(t+"/"))return r(new l(u.EBUSY,s));const p=()=>{if(d||!f.hasOwnProperty(s)||!f.hasOwnProperty(a))return;const n=f[s],u=h[s],p=f[a],g=h[a];if(n[o]){const t=n[o];delete n[o];const h=()=>{p[c]=t,i.put(u.id,y.from(JSON.stringify(n)),!0,t=>{S(t,i,r)&&(s===a?i.commit(r):i.put(g.id,y.from(JSON.stringify(p)),!0,t=>{S(t,i,r)&&i.commit(r)}))})};p[c]?this.getINode(i,e,p[c],(t,n)=>{S(t,i,r)&&(n.isFile()?i.del(n.id,t=>{S(t,i,r)&&i.del(p[c],t=>{S(t,i,r)&&h()})}):i.abort(t=>{r(l.EPERM(e))}))}):h()}else r(l.ENOENT(t))},g=t=>{this.findINodeAndDirListing(i,t,(e,n,s)=>{e?d||(d=!0,i.abort(()=>{r(e)})):(h[t]=n,f[t]=s,p())})};g(s),s!==a&&g(a)}stat(t,e,r){const i=this.store.beginTransaction("readonly");this.findINode(i,t,(t,e)=>{E(t,r)&&r(null,e.toStats())})}createFile(t,e,r,i){const n=this.store.beginTransaction("readwrite"),s=d();this.commitNewFile(n,t,f.FILE,r,s,(r,n)=>{E(r,i)&&i(null,new k(this,t,e,n.toStats(),s))})}openFile(t,e,r){const i=this.store.beginTransaction("readonly");this.findINode(i,t,(n,s)=>{E(n,r)&&i.get(s.id,(i,n)=>{E(i,r)&&(void 0===n?r(l.ENOENT(t)):r(null,new k(this,t,e,s.toStats(),n)))})})}unlink(t,e){this.removeEntry(t,!1,e)}rmdir(t,e){this.readdir(t,(r,i)=>{r?e(r):i.length>0?e(l.ENOTEMPTY(t)):this.removeEntry(t,!0,e)})}mkdir(t,e,r){const i=this.store.beginTransaction("readwrite"),n=y.from("{}");this.commitNewFile(i,t,f.DIRECTORY,e,n,r)}readdir(t,e){const r=this.store.beginTransaction("readonly");this.findINode(r,t,(i,n)=>{E(i,e)&&this.getDirListing(r,t,n,(t,r)=>{E(t,e)&&e(null,Object.keys(r))})})}_sync(t,e,r,i){const s=this.store.beginTransaction("readwrite");this._findINode(s,n.dirname(t),n.basename(t),(n,o)=>{S(n,s,i)&&this.getINode(s,t,o,(t,n)=>{if(S(t,s,i)){const t=n.update(r);s.put(n.id,e,!0,e=>{S(e,s,i)&&(t?s.put(o,n.toBuffer(),!0,t=>{S(t,s,i)&&s.commit(i)}):s.commit(i))})}})})}makeRootDirectory(t){const e=this.store.beginTransaction("readwrite");e.get(g,(r,i)=>{if(r||void 0===i){const r=(new Date).getTime(),i=new s(_(),4096,511|f.DIRECTORY,r,r,r);e.put(i.id,w(),!1,r=>{S(r,e,t)&&e.put(g,i.toBuffer(),!1,r=>{r?e.abort(()=>{t(r)}):e.commit(t)})})}else e.commit(t)})}_findINode(t,e,r,i){if(this._cache){const t=this._cache.get(n.join(e,r));if(t)return i(null,t)}const s=(t,s,o)=>{if(t)i(t);else if(o[r]){const t=o[r];this._cache&&this._cache.set(n.join(e,r),t),i(null,t)}else i(l.ENOENT(n.resolve(e,r)))};"/"===e?""===r?(this._cache&&this._cache.set(n.join(e,r),g),i(null,g)):this.getINode(t,e,g,(r,n)=>{E(r,i)&&this.getDirListing(t,e,n,(t,e)=>{s(t,n,e)})}):this.findINodeAndDirListing(t,e,s)}findINode(t,e,r){this._findINode(t,n.dirname(e),n.basename(e),(i,n)=>{E(i,r)&&this.getINode(t,e,n,r)})}getINode(t,e,r,i){t.get(r,(t,r)=>{E(t,i)&&(void 0===r?i(l.ENOENT(e)):i(null,s.fromBuffer(r)))})}getDirListing(t,e,r,i){r.isDirectory()?t.get(r.id,(t,r)=>{if(E(t,i))try{i(null,JSON.parse(r.toString()))}catch(t){i(l.ENOENT(e))}}):i(l.ENOTDIR(e))}findINodeAndDirListing(t,e,r){this.findINode(t,e,(i,n)=>{E(i,r)&&this.getDirListing(t,e,n,(t,e)=>{E(t,r)&&r(null,n,e)})})}addNewNode(t,e,r){let i,n=0;const s=()=>{5==++n?r(new l(u.EIO,"Unable to commit data to key-value store.")):(i=_(),t.put(i,e,!1,(t,e)=>{t||!e?s():r(null,i)}))};s()}commitNewFile(t,e,r,i,o,a){const c=n.dirname(e),h=n.basename(e),u=(new Date).getTime();if("/"===e)return a(l.EEXIST(e));this.findINodeAndDirListing(t,c,(n,c,f)=>{S(n,t,a)&&(f[h]?t.abort(()=>{a(l.EEXIST(e))}):this.addNewNode(t,o,(e,n)=>{if(S(e,t,a)){const e=new s(n,o.length,i|r,u,u,u);this.addNewNode(t,e.toBuffer(),(r,i)=>{S(r,t,a)&&(f[h]=i,t.put(c.id,y.from(JSON.stringify(f)),!0,r=>{S(r,t,a)&&t.commit(r=>{S(r,t,a)&&a(null,e)})}))})}}))})}removeEntry(t,e,r){this._cache&&this._cache.remove(t);const i=this.store.beginTransaction("readwrite"),s=n.dirname(t),o=n.basename(t);this.findINodeAndDirListing(i,s,(n,s,a)=>{if(S(n,i,r))if(a[o]){const n=a[o];delete a[o],this.getINode(i,t,n,(o,c)=>{S(o,i,r)&&(!e&&c.isDirectory()?i.abort(()=>{r(l.EISDIR(t))}):e&&!c.isDirectory()?i.abort(()=>{r(l.ENOTDIR(t))}):i.del(c.id,t=>{S(t,i,r)&&i.del(n,t=>{S(t,i,r)&&i.put(s.id,y.from(JSON.stringify(a)),!0,t=>{S(t,i,r)&&i.commit(r)})})}))})}else i.abort(()=>{r(l.ENOENT(t))})})}}}}),t("skylark-browserfs/backend/InMemory",["../generic/key_value_filesystem"],function(t){"use strict";const{SimpleSyncRWTransaction:e,SyncKeyValueFileSystem:r}=t;class i{constructor(){this.store={}}name(){return n.Name}clear(){this.store={}}beginTransaction(t){return new e(this)}get(t){return this.store[t]}put(t,e,r){return!(!r&&this.store.hasOwnProperty(t))&&(this.store[t]=e,!0)}del(t){delete this.store[t]}}class n extends r{constructor(){super({store:new i})}static Create(t,e){e(null,new n)}}return n.Name="InMemory",n.Options={},n.InMemoryStore=i,n}),t("skylark-browserfs/backend/IndexedDB",["../generic/key_value_filesystem","../core/api_error","../core/global","../core/util"],function(t,e,r,i){"use strict";const{AsyncKeyValueFileSystem:n}=t,{ApiError:s,ErrorCode:o}=e,{arrayBuffer2Buffer:a,buffer2ArrayBuffer:c}=i,h=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB;function l(t,e=t.toString()){switch(t.name){case"NotFoundError":return new s(o.ENOENT,e);case"QuotaExceededError":return new s(o.ENOSPC,e);default:return new s(o.EIO,e)}}function u(t,e=o.EIO,r=null){return function(i){i.preventDefault(),t(new s(e,null!==r?r:void 0))}}class f{constructor(t,e){this.tx=t,this.store=e}get(t,e){try{const r=this.store.get(t);r.onerror=u(e),r.onsuccess=(t=>{const r=t.target.result;e(null,void 0===r?r:a(r))})}catch(t){e(l(t))}}}class d extends f{constructor(t,e){super(t,e)}put(t,e,r,i){try{const n=c(e);let s;(s=r?this.store.put(n,t):this.store.add(n,t)).onerror=u(i),s.onsuccess=(t=>{i(null,!0)})}catch(t){i(l(t))}}del(t,e){try{const r=this.store.delete(t);r.onerror=u(e),r.onsuccess=(t=>{e()})}catch(t){e(l(t))}}commit(t){setTimeout(t,0)}abort(t){let e=null;try{this.tx.abort()}catch(t){e=l(t)}finally{t(e)}}}class p{constructor(t,e){this.db=t,this.storeName=e}static Create(t,e){const r=h.open(t,1);r.onupgradeneeded=(e=>{const r=e.target.result;r.objectStoreNames.contains(t)&&r.deleteObjectStore(t),r.createObjectStore(t)}),r.onsuccess=(r=>{e(null,new p(r.target.result,t))}),r.onerror=u(e,o.EACCES)}name(){return y.Name+" - "+this.storeName}clear(t){try{const e=this.db.transaction(this.storeName,"readwrite"),r=e.objectStore(this.storeName),i=r.clear();i.onsuccess=(e=>{setTimeout(t,0)}),i.onerror=u(t)}catch(e){t(l(e))}}beginTransaction(t="readonly"){const e=this.db.transaction(this.storeName,t),r=e.objectStore(this.storeName);if("readwrite"===t)return new d(e,r);if("readonly"===t)return new f(e,r);throw new s(o.EINVAL,"Invalid transaction type.")}}class y extends n{constructor(t){super(t)}static Create(t={},e){p.Create(t.storeName?t.storeName:"browserfs",(r,i)=>{if(i){const r=new y("number"==typeof t.cacheSize?t.cacheSize:100);r.init(i,t=>{t?e(t):e(null,r)})}else e(r)})}static isAvailable(){try{return void 0!==h&&null!==h.open("__browserfs_test__")}catch(t){return!1}}}return y.Name="IndexedDB",y.Options={storeName:{type:"string",optional:!0,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."},cacheSize:{type:"number",optional:!0,description:"The size of the inode cache. Defaults to 100. A size of 0 or below disables caching."}},y.IndexedDBROTransaction=f,y.IndexedDBRWTransaction=d,y.IndexedDBStore=p,y}),t("skylark-browserfs/backend/LocalStorage",["../libs/buffers","../generic/key_value_filesystem","../core/api_error","../core/global"],function(t,e,r,i){"use strict";const{SyncKeyValueFileSystem:n,SimpleSyncRWTransaction:s}=e,{ApiError:o,ErrorCode:a}=r,{Buffer:c}=t;let h,l=!1;try{i.localStorage.setItem("__test__",String.fromCharCode(55296)),l=i.localStorage.getItem("__test__")===String.fromCharCode(55296)}catch(t){l=!1}h=l?"binary_string":"binary_string_ie",c.isEncoding(h)||(h="base64");class u{name(){return f.Name}clear(){i.localStorage.clear()}beginTransaction(t){return new s(this)}get(t){try{const e=i.localStorage.getItem(t);if(null!==e)return c.from(e,h)}catch(t){}}put(t,e,r){try{return!(!r&&null!==i.localStorage.getItem(t))&&(i.localStorage.setItem(t,e.toString(h)),!0)}catch(t){throw new o(a.ENOSPC,"LocalStorage is full.")}}del(t){try{i.localStorage.removeItem(t)}catch(e){throw new o(a.EIO,"Unable to delete key "+t+": "+e)}}}class f extends n{constructor(){super({store:new u})}static Create(t,e){e(null,new f)}static isAvailable(){return void 0!==i.localStorage}}return f.Name="LocalStorage",f.Options={},f.LocalStorageStore=u,f}),t("skylark-browserfs/backend/MountableFileSystem",["../core/file_system","./InMemory","../core/api_error","../core/node_fs","../libs/path","../core/util"],function(t,e,r,i,n,s){"use strict";const{BaseFileSystem:o}=t,{InMemoryFileSystem:a}=e,{ApiError:c,ErrorCode:h}=r,{mkdirpSync:l}=s;class u extends o{constructor(t){super(),this.mountList=[],this.mntMap={},this.rootFs=t}static Create(t,e){a.Create({},(r,i)=>{if(i){const n=new u(i);try{Object.keys(t).forEach(e=>{n.mount(e,t[e])})}catch(r){return e(r)}e(null,n)}else e(r)})}static isAvailable(){return!0}mount(t,e){if("/"!==t[0]&&(t=`/${t}`),t=n.resolve(t),this.mntMap[t])throw new c(h.EINVAL,"Mount point "+t+" is already taken.");l(t,511,this.rootFs),this.mntMap[t]=e,this.mountList.push(t),this.mountList=this.mountList.sort((t,e)=>e.length-t.length)}umount(t){if("/"!==t[0]&&(t=`/${t}`),t=n.resolve(t),!this.mntMap[t])throw new c(h.EINVAL,"Mount point "+t+" is already unmounted.");for(delete this.mntMap[t],this.mountList.splice(this.mountList.indexOf(t),1);"/"!==t&&0===this.rootFs.readdirSync(t).length;)this.rootFs.rmdirSync(t),t=n.dirname(t)}_getFs(t){const e=this.mountList,r=e.length;for(let i=0;i<r;i++){const r=e[i];if(r.length<=t.length&&0===t.indexOf(r))return""===(t=t.substr(r.length>1?r.length:0))&&(t="/"),{fs:this.mntMap[r],path:t,mountPoint:r}}return{fs:this.rootFs,path:t,mountPoint:"/"}}getName(){return u.Name}diskSpace(t,e){e(0,0)}isReadOnly(){return!1}supportsLinks(){return!1}supportsProps(){return!1}supportsSynch(){return!0}standardizeError(t,e,r){const i=t.message.indexOf(e);return-1!==i&&(t.message=t.message.substr(0,i)+r+t.message.substr(i+e.length),t.path=r),t}rename(t,e,r){const n=this._getFs(t),s=this._getFs(e);return n.fs===s.fs?n.fs.rename(n.path,s.path,i=>{i&&this.standardizeError(this.standardizeError(i,n.path,t),s.path,e),r(i)}):i.readFile(t,function(n,s){if(n)return r(n);i.writeFile(e,s,function(e){if(e)return r(e);i.unlink(t,r)})})}renameSync(t,e){const r=this._getFs(t),n=this._getFs(e);if(r.fs===n.fs)try{return r.fs.renameSync(r.path,n.path)}catch(i){throw this.standardizeError(this.standardizeError(i,r.path,t),n.path,e),i}const s=i.readFileSync(t);return i.writeFileSync(e,s),i.unlinkSync(t)}readdirSync(t){const e=this._getFs(t);let r=null;if(e.fs!==this.rootFs)try{r=this.rootFs.readdirSync(t)}catch(t){}try{const i=e.fs.readdirSync(e.path);return null===r?i:i.concat(r.filter(t=>-1===i.indexOf(t)))}catch(i){if(null===r)throw this.standardizeError(i,e.path,t);return r}}readdir(t,e){const r=this._getFs(t);r.fs.readdir(r.path,(i,n)=>{if(r.fs!==this.rootFs)try{const s=this.rootFs.readdirSync(t);n=n?n.concat(s.filter(t=>-1===n.indexOf(t))):s}catch(n){if(i)return e(this.standardizeError(i,r.path,t))}else if(i)return e(this.standardizeError(i,r.path,t));e(null,n)})}realpathSync(t,e){const r=this._getFs(t);try{const e=r.fs.realpathSync(r.path,{});return n.resolve(n.join(r.mountPoint,e))}catch(e){throw this.standardizeError(e,r.path,t)}}realpath(t,e,r){const i=this._getFs(t);i.fs.realpath(i.path,{},(e,s)=>{e?r(this.standardizeError(e,i.path,t)):r(null,n.resolve(n.join(i.mountPoint,s)))})}rmdirSync(t){const e=this._getFs(t);if(this._containsMountPt(t))throw c.ENOTEMPTY(t);try{e.fs.rmdirSync(e.path)}catch(r){throw this.standardizeError(r,e.path,t)}}rmdir(t,e){const r=this._getFs(t);this._containsMountPt(t)?e(c.ENOTEMPTY(t)):r.fs.rmdir(r.path,i=>{e(i?this.standardizeError(i,r.path,t):null)})}_containsMountPt(t){const e=this.mountList,r=e.length;for(let i=0;i<r;i++){const r=e[i];if(r.length>=t.length&&r.slice(0,t.length)===t)return!0}return!1}}function f(t,e,r){return e?function(...e){const r=e[0],i=this._getFs(r);e[0]=i.path;try{return i.fs[t].apply(i.fs,e)}catch(t){throw this.standardizeError(t,i.path,r),t}}:function(...e){const r=e[0],i=this._getFs(r);if(e[0]=i.path,"function"==typeof e[e.length-1]){const t=e[e.length-1];e[e.length-1]=((...e)=>{e.length>0&&e[0]instanceof c&&this.standardizeError(e[0],i.path,r),t.apply(null,e)})}return i.fs[t].apply(i.fs,e)}}u.Name="MountableFileSystem",u.Options={};const d=[["exists","unlink","readlink"],["stat","mkdir","truncate"],["open","readFile","chmod","utimes"],["chown"],["writeFile","appendFile"]];for(let t=0;t<d.length;t++){const e=d[t];for(const r of e)u.prototype[r]=f(r,!1,t+1),u.prototype[r+"Sync"]=f(r+"Sync",!0,t+1)}return u}),t("skylark-browserfs/generic/mutex",["../generic/setImmediate"],function(t){"use strict";return class{constructor(){this._locked=!1,this._waiters=[]}lock(t){this._locked?this._waiters.push(t):(this._locked=!0,t())}unlock(){if(!this._locked)throw new Error("unlock of a non-locked mutex");const e=this._waiters.shift();e?t(e):this._locked=!1}tryLock(){return!this._locked&&(this._locked=!0,!0)}isLocked(){return this._locked}}}),t("skylark-browserfs/generic/locked_fs",["./mutex"],function(t){"use strict";return class{constructor(e){this._fs=e,this._mu=new t}getName(){return"LockedFS<"+this._fs.getName()+">"}getFSUnlocked(){return this._fs}diskSpace(t,e){this._fs.diskSpace(t,e)}isReadOnly(){return this._fs.isReadOnly()}supportsLinks(){return this._fs.supportsLinks()}supportsProps(){return this._fs.supportsProps()}supportsSynch(){return this._fs.supportsSynch()}rename(t,e,r){this._mu.lock(()=>{this._fs.rename(t,e,t=>{this._mu.unlock(),r(t)})})}renameSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.renameSync(t,e)}stat(t,e,r){this._mu.lock(()=>{this._fs.stat(t,e,(t,e)=>{this._mu.unlock(),r(t,e)})})}statSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.statSync(t,e)}open(t,e,r,i){this._mu.lock(()=>{this._fs.open(t,e,r,(t,e)=>{this._mu.unlock(),i(t,e)})})}openSync(t,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.openSync(t,e,r)}unlink(t,e){this._mu.lock(()=>{this._fs.unlink(t,t=>{this._mu.unlock(),e(t)})})}unlinkSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.unlinkSync(t)}rmdir(t,e){this._mu.lock(()=>{this._fs.rmdir(t,t=>{this._mu.unlock(),e(t)})})}rmdirSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.rmdirSync(t)}mkdir(t,e,r){this._mu.lock(()=>{this._fs.mkdir(t,e,t=>{this._mu.unlock(),r(t)})})}mkdirSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.mkdirSync(t,e)}readdir(t,e){this._mu.lock(()=>{this._fs.readdir(t,(t,r)=>{this._mu.unlock(),e(t,r)})})}readdirSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readdirSync(t)}exists(t,e){this._mu.lock(()=>{this._fs.exists(t,t=>{this._mu.unlock(),e(t)})})}existsSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.existsSync(t)}realpath(t,e,r){this._mu.lock(()=>{this._fs.realpath(t,e,(t,e)=>{this._mu.unlock(),r(t,e)})})}realpathSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.realpathSync(t,e)}truncate(t,e,r){this._mu.lock(()=>{this._fs.truncate(t,e,t=>{this._mu.unlock(),r(t)})})}truncateSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.truncateSync(t,e)}readFile(t,e,r,i){this._mu.lock(()=>{this._fs.readFile(t,e,r,(t,e)=>{this._mu.unlock(),i(t,e)})})}readFileSync(t,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readFileSync(t,e,r)}writeFile(t,e,r,i,n,s){this._mu.lock(()=>{this._fs.writeFile(t,e,r,i,n,t=>{this._mu.unlock(),s(t)})})}writeFileSync(t,e,r,i,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.writeFileSync(t,e,r,i,n)}appendFile(t,e,r,i,n,s){this._mu.lock(()=>{this._fs.appendFile(t,e,r,i,n,t=>{this._mu.unlock(),s(t)})})}appendFileSync(t,e,r,i,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.appendFileSync(t,e,r,i,n)}chmod(t,e,r,i){this._mu.lock(()=>{this._fs.chmod(t,e,r,t=>{this._mu.unlock(),i(t)})})}chmodSync(t,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chmodSync(t,e,r)}chown(t,e,r,i,n){this._mu.lock(()=>{this._fs.chown(t,e,r,i,t=>{this._mu.unlock(),n(t)})})}chownSync(t,e,r,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chownSync(t,e,r,i)}utimes(t,e,r,i){this._mu.lock(()=>{this._fs.utimes(t,e,r,t=>{this._mu.unlock(),i(t)})})}utimesSync(t,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.utimesSync(t,e,r)}link(t,e,r){this._mu.lock(()=>{this._fs.link(t,e,t=>{this._mu.unlock(),r(t)})})}linkSync(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.linkSync(t,e)}symlink(t,e,r,i){this._mu.lock(()=>{this._fs.symlink(t,e,r,t=>{this._mu.unlock(),i(t)})})}symlinkSync(t,e,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.symlinkSync(t,e,r)}readlink(t,e){this._mu.lock(()=>{this._fs.readlink(t,(t,r)=>{this._mu.unlock(),e(t,r)})})}readlinkSync(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readlinkSync(t)}}}),t("skylark-browserfs/backend/OverlayFS",["../core/file_system","../core/api_error","../core/file_flag","../core/node_fs_stats","../generic/preload_file","../generic/locked_fs","../libs/path"],function(t,e,r,i,n,s,o){"use strict";const{BaseFileSystem:a}=t,{ApiError:c,ErrorCode:h}=e,{FileFlag:l,ActionType:u}=r,{Stats:f}=i,{PreloadFile:d}=n,p="/.deletedFiles.log";function y(t){return 146|t}function g(t){return l.getFileFlag(t)}class m extends d{constructor(t,e,r,i,n){super(t,e,r,i,n)}sync(t){this.isDirty()?this._fs._syncAsync(this,e=>{this.resetDirty(),t(e)}):t(null)}syncSync(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())}close(t){this.sync(t)}closeSync(){this.syncSync()}}class w extends a{constructor(t,e){if(super(),this._isInitialized=!1,this._initializeCallbacks=[],this._deletedFiles={},this._deleteLog="",this._deleteLogUpdatePending=!1,this._deleteLogUpdateNeeded=!1,this._deleteLogError=null,this._writable=t,this._readable=e,this._writable.isReadOnly())throw new c(h.EINVAL,"Writable file system must be writable.")}static isAvailable(){return!0}getOverlayedFileSystems(){return{readable:this._readable,writable:this._writable}}_syncAsync(t,e){this.createParentDirectoriesAsync(t.getPath(),r=>{if(r)return e(r);this._writable.writeFile(t.getPath(),t.getBuffer(),null,g("w"),t.getStats().mode,e)})}_syncSync(t){this.createParentDirectories(t.getPath()),this._writable.writeFileSync(t.getPath(),t.getBuffer(),null,g("w"),t.getStats().mode)}getName(){return _.Name}_initialize(t){const e=this._initializeCallbacks,r=t=>{this._isInitialized=!t,this._initializeCallbacks=[],e.forEach(e=>e(t))};if(this._isInitialized)return t();e.push(t),1===e.length&&this._writable.readFile(p,"utf8",g("r"),(t,e)=>{if(t){if(t.errno!==h.ENOENT)return r(t)}else this._deleteLog=e;this._reparseDeletionLog(),r()})}isReadOnly(){return!1}supportsSynch(){return this._readable.supportsSynch()&&this._writable.supportsSynch()}supportsLinks(){return!1}supportsProps(){return this._readable.supportsProps()&&this._writable.supportsProps()}getDeletionLog(){return this._deleteLog}restoreDeletionLog(t){this._deleteLog=t,this._reparseDeletionLog(),this.updateLog("")}rename(t,e,r){if(this.checkInitAsync(r)&&!this.checkPathAsync(t,r)&&!this.checkPathAsync(e,r))return t===p||e===p?r(c.EPERM("Cannot rename deletion log.")):t===e?r():void this.stat(t,!1,(i,n)=>i?r(i):this.stat(e,!1,(i,s)=>{const a=this;function l(i){const n=i.shift();if(!n)return r();const s=o.resolve(t,n),c=o.resolve(e,n);a.rename(s,c,t=>{if(t)return r(t);l(i)})}let u=511;if(n.isDirectory()){if(i)return i.errno!==h.ENOENT?r(i):this._writable.exists(t,i=>{if(i)return this._writable.rename(t,e,r);this._writable.mkdir(e,u,e=>{if(e)return r(e);this._readable.readdir(t,(t,e)=>{if(t)return r();l(e)})})});if(u=s.mode,!s.isDirectory())return r(c.ENOTDIR(e));this.readdir(e,(i,n)=>{if(n&&n.length)return r(c.ENOTEMPTY(e));this._readable.readdir(t,(t,e)=>{if(t)return r();l(e)})})}if(s&&s.isDirectory())return r(c.EISDIR(e));this.readFile(t,null,g("r"),(i,s)=>i?r(i):this.writeFile(e,s,null,g("w"),n.mode,e=>e?r(e):this.unlink(t,r)))}))}renameSync(t,e){if(this.checkInitialized(),this.checkPath(t),this.checkPath(e),t===p||e===p)throw c.EPERM("Cannot rename deletion log.");const r=this.statSync(t,!1);if(r.isDirectory()){if(t===e)return;let r=511;if(this.existsSync(e)){const t=this.statSync(e,!1);if(r=t.mode,!t.isDirectory())throw c.ENOTDIR(e);if(this.readdirSync(e).length>0)throw c.ENOTEMPTY(e)}this._writable.existsSync(t)?this._writable.renameSync(t,e):this._writable.existsSync(e)||this._writable.mkdirSync(e,r),this._readable.existsSync(t)&&this._readable.readdirSync(t).forEach(r=>{this.renameSync(o.resolve(t,r),o.resolve(e,r))})}else{if(this.existsSync(e)&&this.statSync(e,!1).isDirectory())throw c.EISDIR(e);this.writeFileSync(e,this.readFileSync(t,null,g("r")),null,g("w"),r.mode)}t!==e&&this.existsSync(t)&&this.unlinkSync(t)}stat(t,e,r){this.checkInitAsync(r)&&this._writable.stat(t,e,(i,n)=>{i&&i.errno===h.ENOENT?(this._deletedFiles[t]&&r(c.ENOENT(t)),this._readable.stat(t,e,(t,e)=>{e&&((e=f.clone(e)).mode=y(e.mode)),r(t,e)})):r(i,n)})}statSync(t,e){this.checkInitialized();try{return this._writable.statSync(t,e)}catch(r){if(this._deletedFiles[t])throw c.ENOENT(t);const i=f.clone(this._readable.statSync(t,e));return i.mode=y(i.mode),i}}open(t,e,r,i){this.checkInitAsync(i)&&!this.checkPathAsync(t,i)&&this.stat(t,!1,(n,s)=>{if(s)switch(e.pathExistsAction()){case u.TRUNCATE_FILE:return this.createParentDirectoriesAsync(t,n=>{if(n)return i(n);this._writable.open(t,e,r,i)});case u.NOP:return this._writable.exists(t,n=>{n?this._writable.open(t,e,r,i):((s=f.clone(s)).mode=r,this._readable.readFile(t,null,g("r"),(r,n)=>{if(r)return i(r);-1===s.size&&(s.size=n.length);const o=new m(this,t,e,s,n);i(null,o)}))});default:return i(c.EEXIST(t))}else switch(e.pathNotExistsAction()){case u.CREATE_FILE:return this.createParentDirectoriesAsync(t,n=>n?i(n):this._writable.open(t,e,r,i));default:return i(c.ENOENT(t))}})}openSync(t,e,r){if(this.checkInitialized(),this.checkPath(t),t===p)throw c.EPERM("Cannot open deletion log.");if(this.existsSync(t))switch(e.pathExistsAction()){case u.TRUNCATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,r);case u.NOP:if(this._writable.existsSync(t))return this._writable.openSync(t,e,r);{const i=this._readable.readFileSync(t,null,g("r")),n=f.clone(this._readable.statSync(t,!1));return n.mode=r,new m(this,t,e,n,i)}default:throw c.EEXIST(t)}else switch(e.pathNotExistsAction()){case u.CREATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,r);default:throw c.ENOENT(t)}}unlink(t,e){this.checkInitAsync(e)&&!this.checkPathAsync(t,e)&&this.exists(t,r=>{if(!r)return e(c.ENOENT(t));this._writable.exists(t,r=>{if(r)return this._writable.unlink(t,r=>{if(r)return e(r);this.exists(t,r=>{r&&this.deletePath(t),e(null)})});this.deletePath(t),e(null)})})}unlinkSync(t){if(this.checkInitialized(),this.checkPath(t),!this.existsSync(t))throw c.ENOENT(t);this._writable.existsSync(t)&&this._writable.unlinkSync(t),this.existsSync(t)&&this.deletePath(t)}rmdir(t,e){if(!this.checkInitAsync(e))return;const r=()=>{this.readdir(t,(r,i)=>r?e(r):i.length?e(c.ENOTEMPTY(t)):(this.deletePath(t),void e(null)))};this.exists(t,i=>{if(!i)return e(c.ENOENT(t));this._writable.exists(t,i=>{i?this._writable.rmdir(t,i=>{if(i)return e(i);this._readable.exists(t,t=>{t?r():e()})}):r()})})}rmdirSync(t){if(this.checkInitialized(),!this.existsSync(t))throw c.ENOENT(t);if(this._writable.existsSync(t)&&this._writable.rmdirSync(t),this.existsSync(t)){if(this.readdirSync(t).length>0)throw c.ENOTEMPTY(t);this.deletePath(t)}}mkdir(t,e,r){this.checkInitAsync(r)&&this.exists(t,i=>{if(i)return r(c.EEXIST(t));this.createParentDirectoriesAsync(t,i=>{if(i)return r(i);this._writable.mkdir(t,e,r)})})}mkdirSync(t,e){if(this.checkInitialized(),this.existsSync(t))throw c.EEXIST(t);this.createParentDirectories(t),this._writable.mkdirSync(t,e)}readdir(t,e){this.checkInitAsync(e)&&this.stat(t,!1,(r,i)=>r?e(r):i.isDirectory()?void this._writable.readdir(t,(r,i)=>{if(r&&"ENOENT"!==r.code)return e(r);!r&&i||(i=[]),this._readable.readdir(t,(r,n)=>{!r&&n||(n=[]);const s={},o=i.concat(n.filter(e=>!this._deletedFiles[`${t}/${e}`])).filter(t=>{const e=!s[t];return s[t]=!0,e});e(null,o)})}):e(c.ENOTDIR(t)))}readdirSync(t){this.checkInitialized();const e=this.statSync(t,!1);if(!e.isDirectory())throw c.ENOTDIR(t);let r=[];try{r=r.concat(this._writable.readdirSync(t))}catch(t){}try{r=r.concat(this._readable.readdirSync(t).filter(e=>!this._deletedFiles[`${t}/${e}`]))}catch(t){}const i={};return r.filter(t=>{const e=!i[t];return i[t]=!0,e})}exists(t,e){this.checkInitialized(),this._writable.exists(t,r=>{if(r)return e(!0);this._readable.exists(t,r=>{e(r&&!0!==this._deletedFiles[t])})})}existsSync(t){return this.checkInitialized(),this._writable.existsSync(t)||this._readable.existsSync(t)&&!0!==this._deletedFiles[t]}chmod(t,e,r,i){this.checkInitAsync(i)&&this.operateOnWritableAsync(t,n=>{if(n)return i(n);this._writable.chmod(t,e,r,i)})}chmodSync(t,e,r){this.checkInitialized(),this.operateOnWritable(t,()=>{this._writable.chmodSync(t,e,r)})}chown(t,e,r,i,n){this.checkInitAsync(n)&&this.operateOnWritableAsync(t,s=>{if(s)return n(s);this._writable.chown(t,e,r,i,n)})}chownSync(t,e,r,i){this.checkInitialized(),this.operateOnWritable(t,()=>{this._writable.chownSync(t,e,r,i)})}utimes(t,e,r,i){this.checkInitAsync(i)&&this.operateOnWritableAsync(t,n=>{if(n)return i(n);this._writable.utimes(t,e,r,i)})}utimesSync(t,e,r){this.checkInitialized(),this.operateOnWritable(t,()=>{this._writable.utimesSync(t,e,r)})}deletePath(t){this._deletedFiles[t]=!0,this.updateLog(`d${t}\n`)}updateLog(t){this._deleteLog+=t,this._deleteLogUpdatePending?this._deleteLogUpdateNeeded=!0:(this._deleteLogUpdatePending=!0,this._writable.writeFile(p,this._deleteLog,"utf8",l.getFileFlag("w"),420,t=>{this._deleteLogUpdatePending=!1,t?this._deleteLogError=t:this._deleteLogUpdateNeeded&&(this._deleteLogUpdateNeeded=!1,this.updateLog(""))}))}_reparseDeletionLog(){this._deletedFiles={},this._deleteLog.split("\n").forEach(t=>{this._deletedFiles[t.slice(1)]="d"===t.slice(0,1)})}checkInitialized(){if(!this._isInitialized)throw new c(h.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.");if(null!==this._deleteLogError){const t=this._deleteLogError;throw this._deleteLogError=null,t}}checkInitAsync(t){if(!this._isInitialized)return t(new c(h.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")),!1;if(null!==this._deleteLogError){const e=this._deleteLogError;return this._deleteLogError=null,t(e),!1}return!0}checkPath(t){if(t===p)throw c.EPERM(t)}checkPathAsync(t,e){return t===p&&(e(c.EPERM(t)),!0)}createParentDirectoriesAsync(t,e){let r=o.dirname(t);const i=[],n=this;this._writable.stat(r,!1,function t(s,a){s?"/"===r?e(new c(h.EBUSY,"Invariant failed: root does not exist!")):(i.push(r),r=o.dirname(r),n._writable.stat(r,!1,t)):function t(){if(!i.length)return e();const r=i.pop();n._readable.stat(r,!1,(i,s)=>{if(!s)return e();n._writable.mkdir(r,s.mode,r=>{if(r)return e(r);t()})})}()})}createParentDirectories(t){let e=o.dirname(t),r=[];for(;!this._writable.existsSync(e);)r.push(e),e=o.dirname(e);(r=r.reverse()).forEach(t=>{this._writable.mkdirSync(t,this.statSync(t,!1).mode)})}operateOnWritable(t,e){if(!this.existsSync(t))throw c.ENOENT(t);this._writable.existsSync(t)||this.copyToWritable(t),e()}operateOnWritableAsync(t,e){this.exists(t,r=>{if(!r)return e(c.ENOENT(t));this._writable.exists(t,r=>{if(!r)return this.copyToWritableAsync(t,e);e()})})}copyToWritable(t){const e=this.statSync(t,!1);e.isDirectory()?this._writable.mkdirSync(t,e.mode):this.writeFileSync(t,this._readable.readFileSync(t,null,g("r")),null,g("w"),this.statSync(t,!1).mode)}copyToWritableAsync(t,e){this.stat(t,!1,(r,i)=>r?e(r):i.isDirectory()?this._writable.mkdir(t,i.mode,e):void this._readable.readFile(t,null,g("r"),(r,n)=>{if(r)return e(r);this.writeFile(t,n,null,g("w"),i.mode,e)}))}}class _ extends s{constructor(t,e){super(new w(t,e))}static Create(t,e){try{const r=new _(t.writable,t.readable);r._initialize(t=>{e(t,r)})}catch(t){e(t)}}static isAvailable(){return w.isAvailable()}getOverlayedFileSystems(){return super.getFSUnlocked().getOverlayedFileSystems()}unwrap(){return super.getFSUnlocked()}_initialize(t){super.getFSUnlocked()._initialize(t)}}return _.Name="OverlayFS",_.Options={writable:{type:"object",description:"The file system to write modified files to."},readable:{type:"object",description:"The file system that initially populates this file system."}},_}),t("skylark-browserfs/backend/WorkerFS",["../libs/buffers","../core/file_system","../core/api_error","../core/file_flag","../core/util","../core/file","../core/node_fs_stats","../generic/preload_file","../core/global","../core/node_fs"],function(t,e,r,i,n,s,o,a,c,h){"use strict";const{BaseFileSystem:l}=e,{ApiError:u,ErrorCode:f}=r,{FileFlag:d}=i,{buffer2ArrayBuffer:p,arrayBuffer2Buffer:y,emptyBuffer:g}=n,{BaseFile:m}=s,{Stats:w}=o,{PreloadFile:_}=a,{Buffer:E}=t;var S;!function(t){t[t.CB=0]="CB",t[t.FD=1]="FD",t[t.API_ERROR=2]="API_ERROR",t[t.STATS=3]="STATS",t[t.PROBE=4]="PROBE",t[t.FILEFLAG=5]="FILEFLAG",t[t.BUFFER=6]="BUFFER",t[t.ERROR=7]="ERROR"}(S||(S={}));class b{constructor(){this._callbacks={},this._nextId=0}toRemoteArg(t){const e=this._nextId++;return this._callbacks[e]=t,{type:S.CB,id:e}}toLocalArg(t){const e=this._callbacks[t];return delete this._callbacks[t],e}}class F{constructor(){this._fileDescriptors={},this._nextId=0}toRemoteArg(t,e,r,i){const n=this._nextId++;let s,o;this._fileDescriptors[n]=t,t.stat((a,c)=>{a?i(a):(o=A(c.toBuffer()),r.isReadable()?t.read(E.alloc(c.size),0,c.size,0,(t,a,c)=>{t?i(t):(s=A(c),i(null,{type:S.FD,id:n,data:s,stat:o,path:e,flag:r.getFlagString()}))}):i(null,{type:S.FD,id:n,data:new ArrayBuffer(0),stat:o,path:e,flag:r.getFlagString()}))})}applyFdAPIRequest(t,e){const r=t.args[0];this._applyFdChanges(r,(i,n)=>{i?e(i):n[t.method](i=>{"close"===t.method&&delete this._fileDescriptors[r.id],e(i)})})}_applyFdChanges(t,e){const r=this._fileDescriptors[t.id],i=D(t.data),n=w.fromBuffer(D(t.stat)),s=d.getFileFlag(t.flag);s.isWriteable()?r.write(i,0,i.length,s.isAppendable()?r.getPos():0,t=>{function o(){r.stat((t,i)=>{t?e(t):i.mode!==n.mode?r.chmod(n.mode,t=>{e(t,r)}):e(t,r)})}t?e(t):s.isAppendable()?o():r.truncate(i.length,()=>{o()})}):e(null,r)}}function I(t){return{type:S.API_ERROR,errorData:A(t.writeToBuffer())}}function k(t){return u.fromBuffer(D(t.errorData))}function N(t){return{type:S.ERROR,name:t.name,message:t.message,stack:t.stack}}function O(t){let e=c[t.name];"function"!=typeof e&&(e=Error);const r=new e(t.message);return r.stack=t.stack,r}function T(t){return{type:S.STATS,statsData:A(t.toBuffer())}}function v(t){return w.fromBuffer(D(t.statsData))}function R(t){return{type:S.FILEFLAG,flagStr:t.getFlagString()}}function L(t){return d.getFileFlag(t.flagStr)}function A(t){return p(t)}function D(t){return y(t)}function x(t){return{type:S.BUFFER,data:A(t)}}function P(t){return D(t.data)}class C extends _{constructor(t,e,r,i,n,s){super(t,e,r,i,s),this._remoteFdId=n}getRemoteFdId(){return this._remoteFdId}toRemoteArg(){return{type:S.FD,id:this._remoteFdId,data:A(this.getBuffer()),stat:A(this.getStats().toBuffer()),path:this.getPath(),flag:this.getFlag().getFlagString()}}sync(t){this._syncClose("sync",t)}close(t){this._syncClose("close",t)}_syncClose(t,e){this.isDirty()?this._fs.syncClose(t,this,t=>{t||this.resetDirty(),e(t)}):e()}}class U extends l{constructor(t){var e;super(),this._callbackConverter=new b,this._isInitialized=!1,this._isReadOnly=!1,this._supportLinks=!1,this._supportProps=!1,this._worker=t,this._worker.addEventListener("message",t=>{const r=t.data;if((e=r)&&"object"==typeof e&&e.hasOwnProperty("browserfsMessage")&&e.browserfsMessage){let t;const e=r.args,i=new Array(e.length);for(t=0;t<i.length;t++)i[t]=this._argRemote2Local(e[t]);this._callbackConverter.toLocalArg(r.cbId).apply(null,i)}})}static Create(t,e){const r=new U(t.worker);r._initialize(()=>{e(null,r)})}static isAvailable(){return"undefined"!=typeof importScripts||"undefined"!=typeof Worker}static attachRemoteListener(t){const e=new F;function r(t,r,i){switch(typeof t){case"object":t instanceof w?i(null,T(t)):t instanceof u?i(null,I(t)):t instanceof m?i(null,e.toRemoteArg(t,r[0],r[1],i)):t instanceof d?i(null,R(t)):t instanceof E?i(null,x(t)):t instanceof Error?i(null,N(t)):i(null,t);break;default:i(null,t)}}function i(e,i){if(!e)return e;switch(typeof e){case"object":if("number"!=typeof e.type)return e;{const n=e;switch(n.type){case S.CB:const s=e.id;return function(){let e;const n=new Array(arguments.length);let o,a=arguments.length;function c(e){a>0&&(a=-1,o={browserfsMessage:!0,cbId:s,args:[I(e)]},t.postMessage(o))}for(e=0;e<arguments.length;e++)((e,h)=>{r(h,i,(r,i)=>{n[e]=i,r?c(r):0==--a&&(o={browserfsMessage:!0,cbId:s,args:n},t.postMessage(o))})})(e,arguments[e]);0===arguments.length&&(o={browserfsMessage:!0,cbId:s,args:n},t.postMessage(o))};case S.API_ERROR:return k(n);case S.STATS:return v(n);case S.FILEFLAG:return L(n);case S.BUFFER:return P(n);case S.ERROR:return O(n);default:return e}}default:return e}}var n;t.addEventListener("message",r=>{const s=r.data;if((n=s)&&"object"==typeof n&&n.hasOwnProperty("browserfsMessage")&&n.browserfsMessage){const r=s.args,n=new Array(r.length);switch(s.method){case"close":case"sync":(()=>{const i=r[1];e.applyFdAPIRequest(s,e=>{const r={browserfsMessage:!0,cbId:i.id,args:e?[I(e)]:[]};t.postMessage(r)})})();break;case"probe":(()=>{const e=h.getRootFS(),i=r[1],n={type:S.PROBE,isReadOnly:e.isReadOnly(),supportsLinks:e.supportsLinks(),supportsProps:e.supportsProps()},s={browserfsMessage:!0,cbId:i.id,args:[n]};t.postMessage(s)})();break;default:for(let t=0;t<r.length;t++)n[t]=i(r[t],n);const o=h.getRootFS();o[s.method].apply(o,n)}}})}getName(){return U.Name}isReadOnly(){return this._isReadOnly}supportsSynch(){return!1}supportsLinks(){return this._supportLinks}supportsProps(){return this._supportProps}rename(t,e,r){this._rpc("rename",arguments)}stat(t,e,r){this._rpc("stat",arguments)}open(t,e,r,i){this._rpc("open",arguments)}unlink(t,e){this._rpc("unlink",arguments)}rmdir(t,e){this._rpc("rmdir",arguments)}mkdir(t,e,r){this._rpc("mkdir",arguments)}readdir(t,e){this._rpc("readdir",arguments)}exists(t,e){this._rpc("exists",arguments)}realpath(t,e,r){this._rpc("realpath",arguments)}truncate(t,e,r){this._rpc("truncate",arguments)}readFile(t,e,r,i){this._rpc("readFile",arguments)}writeFile(t,e,r,i,n,s){this._rpc("writeFile",arguments)}appendFile(t,e,r,i,n,s){this._rpc("appendFile",arguments)}chmod(t,e,r,i){this._rpc("chmod",arguments)}chown(t,e,r,i,n){this._rpc("chown",arguments)}utimes(t,e,r,i){this._rpc("utimes",arguments)}link(t,e,r){this._rpc("link",arguments)}symlink(t,e,r,i){this._rpc("symlink",arguments)}readlink(t,e){this._rpc("readlink",arguments)}syncClose(t,e,r){this._worker.postMessage({browserfsMessage:!0,method:t,args:[e.toRemoteArg(),this._callbackConverter.toRemoteArg(r)]})}_initialize(t){if(this._isInitialized)t();else{const e={browserfsMessage:!0,method:"probe",args:[this._argLocal2Remote(g()),this._callbackConverter.toRemoteArg(e=>{this._isInitialized=!0,this._isReadOnly=e.isReadOnly,this._supportLinks=e.supportsLinks,this._supportProps=e.supportsProps,t()})]};this._worker.postMessage(e)}}_argRemote2Local(t){if(!t)return t;switch(typeof t){case"object":if("number"!=typeof t.type)return t;{const e=t;switch(e.type){case S.API_ERROR:return k(e);case S.FD:const r=e;return new C(this,r.path,d.getFileFlag(r.flag),w.fromBuffer(D(r.stat)),r.id,D(r.data));case S.STATS:return v(e);case S.FILEFLAG:return L(e);case S.BUFFER:return P(e);case S.ERROR:return O(e);default:return t}}default:return t}}_rpc(t,e){const r=new Array(e.length);for(let t=0;t<e.length;t++)r[t]=this._argLocal2Remote(e[t]);const i={browserfsMessage:!0,method:t,args:r};this._worker.postMessage(i)}_argLocal2Remote(t){if(!t)return t;switch(typeof t){case"object":return t instanceof w?T(t):t instanceof u?I(t):t instanceof C?t.toRemoteArg():t instanceof d?R(t):t instanceof E?x(t):t instanceof Error?N(t):"Unknown argument";case"function":return this._callbackConverter.toRemoteArg(t);default:return t}}}return U.Name="WorkerFS",U.Options={worker:{type:"object",description:"The target worker that you want to connect to, or the current worker if in a worker context.",validator:function(t,e){t.postMessage?e():e(new u(f.EINVAL,"option must be a Web Worker instance."))}}},U}),t("skylark-browserfs/generic/xhr",["../libs/buffers","../core/util","../core/api_error"],function(t,e,r){"use strict";const{isIE:i,emptyBuffer:n}=e,{ApiError:s,ErrorCode:o}=r,{Buffer:a}=t,c="undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest;function h(t,e,r){const i=new XMLHttpRequest;i.open("HEAD",e,t),i.onreadystatechange=function(t){if(4===i.readyState){if(200!==i.status)return r(new s(o.EIO,`XHR HEAD error: response returned code ${i.status}`));try{return r(null,parseInt(i.getResponseHeader("Content-Length")||"-1",10))}catch(t){return r(new s(o.EIO,"XHR HEAD error: Could not read content-length."))}}},i.send()}let l=function(t,e,r){const i=new XMLHttpRequest;i.open("GET",t,!0);let c=!0;switch(e){case"buffer":i.responseType="arraybuffer";break;case"json":try{i.responseType="json",c="json"===i.responseType}catch(t){c=!1}break;default:return r(new s(o.EINVAL,"Invalid download type: "+e))}i.onreadystatechange=function(t){if(4===i.readyState){if(200!==i.status)return r(new s(o.EIO,`XHR error: response returned code ${i.status}`));switch(e){case"buffer":return r(null,i.response?a.from(i.response):n());case"json":return r(null,c?i.response:JSON.parse(i.responseText))}}},i.send()},u=i&&"undefined"!=typeof Blob?function(t,e){const r=new XMLHttpRequest;switch(r.open("GET",t,!1),e){case"buffer":r.responseType="arraybuffer";break;case"json":break;default:throw new s(o.EINVAL,"Invalid download type: "+e)}let i,n;if(r.onreadystatechange=function(t){if(4===r.readyState)if(200===r.status)switch(e){case"buffer":i=a.from(r.response);break;case"json":i=JSON.parse(r.response)}else n=new s(o.EIO,`XHR error: response returned code ${r.status}`)},r.send(),n)throw n;return i}:function(t,e){const r=new XMLHttpRequest;r.open("GET",t,!1);let i=null,n=null;if(r.overrideMimeType("text/plain; charset=x-user-defined"),r.onreadystatechange=function(t){if(4===r.readyState){if(200!==r.status)return void(n=new s(o.EIO,`XHR error: response returned code ${r.status}`));switch(e){case"buffer":const t=r.responseText;i=a.alloc(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return;case"json":return void(i=JSON.parse(r.responseText))}}},r.send(),n)throw n;return i};return{xhrIsAvailable:c,asyncDownloadFile:l,syncDownloadFile:u,getFileSizeSync:function(t){let e=-1;return h(!1,t,function(t,r){if(t)throw t;e=r}),e},getFileSizeAsync:function(t,e){h(!0,t,e)}}}),t("skylark-browserfs/generic/fetch",["../libs/buffers","../core/api_error"],function(t,e){"use strict";const{ApiError:r,ErrorCode:i}=e,n="undefined"!=typeof fetch&&null!==fetch,{Buffer:s}=t;return{fetchIsAvailable:n,fetchFileAsync:function(t,e,n){let o;try{o=fetch(t)}catch(t){return n(new r(i.EINVAL,t.message))}o.then(t=>{if(!t.ok)return n(new r(i.EIO,`fetch error: response returned code ${t.status}`));switch(e){case"buffer":t.arrayBuffer().then(t=>n(null,s.from(t))).catch(t=>n(new r(i.EIO,t.message)));break;case"json":t.json().then(t=>n(null,t)).catch(t=>n(new r(i.EIO,t.message)));break;default:n(new r(i.EINVAL,"Invalid download type: "+e))}}).catch(t=>n(new r(i.EIO,t.message)))},fetchFileSizeAsync:function(t,e){fetch(t,{method:"HEAD"}).then(t=>t.ok?e(null,parseInt(t.headers.get("Content-Length")||"-1",10)):e(new r(i.EIO,`fetch HEAD error: response returned code ${t.status}`))).catch(t=>e(new r(i.EIO,t.message)))}}}),t("skylark-browserfs/generic/file_index",["../core/node_fs_stats","../libs/path"],function(t,e){"use strict";const{Stats:r,FileType:i}=t;class n{constructor(){this._index={},this.addPath("/",new o)}static fromListing(t){const e=new n,a=new o;e._index["/"]=a;const c=[["",t,a]];for(;c.length>0;){let t;const n=c.pop(),a=n[0],h=n[1],l=n[2];for(const n in h)if(h.hasOwnProperty(n)){const u=h[n],f=`${a}/${n}`;u?(e._index[f]=t=new o,c.push([f,u,t])):t=new s(new r(i.FILE,-1,365)),l&&(l._ls[n]=t)}}return e}fileIterator(t){for(const e in this._index)if(this._index.hasOwnProperty(e)){const r=this._index[e],i=r.getListing();for(const e of i){const i=r.getItem(e);a(i)&&t(i.getData())}}}addPath(t,e){if(!e)throw new Error("Inode must be specified");if("/"!==t[0])throw new Error("Path must be absolute, got: "+t);if(this._index.hasOwnProperty(t))return this._index[t]===e;const r=this._split_path(t),i=r[0],n=r[1];let s=this._index[i];return!(void 0===s&&"/"!==t&&(s=new o,!this.addPath(i,s)))&&(!("/"!==t&&!s.addItem(n,e))&&(c(e)&&(this._index[t]=e),!0))}addPathFast(t,e){const r=t.lastIndexOf("/"),i=0===r?"/":t.substring(0,r),n=t.substring(r+1);let s=this._index[i];return void 0===s&&(s=new o,this.addPathFast(i,s)),!!s.addItem(n,e)&&(e.isDir()&&(this._index[t]=e),!0)}removePath(t){const e=this._split_path(t),r=e[0],i=e[1],n=this._index[r];if(void 0===n)return null;const s=n.remItem(i);if(null===s)return null;if(c(s)){const e=s.getListing();for(const r of e)this.removePath(t+"/"+r);"/"!==t&&delete this._index[t]}return s}ls(t){const e=this._index[t];return void 0===e?null:e.getListing()}getInode(t){const e=this._split_path(t),r=e[0],i=e[1],n=this._index[r];return void 0===n?null:r===t?n:n.getItem(i)}_split_path(t){const r=e.dirname(t),i=t.substr(r.length+("/"===r?0:1));return[r,i]}}class s{constructor(t){this.data=t}isFile(){return!0}isDir(){return!1}getData(){return this.data}setData(t){this.data=t}}class o{constructor(t=null){this.data=t,this._ls={}}isFile(){return!1}isDir(){return!0}getData(){return this.data}getStats(){return new r(i.DIRECTORY,4096,365)}getListing(){return Object.keys(this._ls)}getItem(t){const e=this._ls[t];return e||null}addItem(t,e){return!(t in this._ls)&&(this._ls[t]=e,!0)}remItem(t){const e=this._ls[t];return void 0===e?null:(delete this._ls[t],e)}}function a(t){return!!t&&t.isFile()}function c(t){return!!t&&t.isDir()}return{FileIndex:n,FileInode:s,DirInode:o,isFileInode:a,isDirInode:c}}),t("skylark-browserfs/backend/HTTPRequest",["../core/file_system","../core/api_error","../core/file_flag","../core/util","../core/node_fs_stats","../generic/preload_file","../generic/xhr","../generic/fetch","../generic/file_index"],function(t,e,r,i,n,s,o,a,c){"use strict";const{BaseFileSystem:h}=t,{ApiError:l,ErrorCode:u}=e,{ActionType:f}=r,{copyingSlice:d}=i,{Stats:p}=n,{NoSyncFile:y}=s,{xhrIsAvailable:g,asyncDownloadFile:m,syncDownloadFile:w,getFileSizeAsync:_,getFileSizeSync:E}=o,{fetchIsAvailable:S,fetchFileAsync:b,fetchFileSizeAsync:F}=a,{FileIndex:I,isFileInode:k,isDirInode:N}=c;function O(){throw new l(u.ENOTSUP,"Synchronous HTTP download methods are not available in this environment.")}class T extends h{constructor(t,e="",r=!1){super(),e.length>0&&"/"!==e.charAt(e.length-1)&&(e+="/"),this.prefixUrl=e,this._index=I.fromListing(t),!S||r&&g?(this._requestFileAsyncInternal=m,this._requestFileSizeAsyncInternal=_):(this._requestFileAsyncInternal=b,this._requestFileSizeAsyncInternal=F),g?(this._requestFileSyncInternal=w,this._requestFileSizeSyncInternal=E):(this._requestFileSyncInternal=O,this._requestFileSizeSyncInternal=O)}static Create(t,e){void 0===t.index&&(t.index="index.json"),"string"==typeof t.index?m(t.index,"json",(r,i)=>{r?e(r):e(null,new T(i,t.baseUrl))}):e(null,new T(t.index,t.baseUrl))}static isAvailable(){return g||S}empty(){this._index.fileIterator(function(t){t.fileData=null})}getName(){return T.Name}diskSpace(t,e){e(0,0)}isReadOnly(){return!0}supportsLinks(){return!1}supportsProps(){return!1}supportsSynch(){return g}preloadFile(t,e){const r=this._index.getInode(t);if(!k(r))throw l.EISDIR(t);{if(null===r)throw l.ENOENT(t);const i=r.getData();i.size=e.length,i.fileData=e}}stat(t,e,r){const i=this._index.getInode(t);if(null===i)return r(l.ENOENT(t));let n;k(i)?(n=i.getData()).size<0?this._requestFileSizeAsync(t,function(t,e){if(t)return r(t);n.size=e,r(null,p.clone(n))}):r(null,p.clone(n)):N(i)?(n=i.getStats(),r(null,n)):r(l.FileError(u.EINVAL,t))}statSync(t,e){const r=this._index.getInode(t);if(null===r)throw l.ENOENT(t);let i;if(k(r))(i=r.getData()).size<0&&(i.size=this._requestFileSizeSync(t));else{if(!N(r))throw l.FileError(u.EINVAL,t);i=r.getStats()}return i}open(t,e,r,i){if(e.isWriteable())return i(new l(u.EPERM,t));const n=this,s=this._index.getInode(t);if(null===s)return i(l.ENOENT(t));if(!k(s))return i(l.EISDIR(t));{const r=s.getData();switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:return i(l.EEXIST(t));case f.NOP:if(r.fileData)return i(null,new y(n,t,e,p.clone(r),r.fileData));this._requestFileAsync(t,"buffer",function(s,o){return s?i(s):(r.size=o.length,r.fileData=o,i(null,new y(n,t,e,p.clone(r),o)))});break;default:return i(new l(u.EINVAL,"Invalid FileMode object."))}}}openSync(t,e,r){if(e.isWriteable())throw new l(u.EPERM,t);const i=this._index.getInode(t);if(null===i)throw l.ENOENT(t);if(!k(i))throw l.EISDIR(t);{const r=i.getData();switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:throw l.EEXIST(t);case f.NOP:if(r.fileData)return new y(this,t,e,p.clone(r),r.fileData);const i=this._requestFileSync(t,"buffer");return r.size=i.length,r.fileData=i,new y(this,t,e,p.clone(r),i);default:throw new l(u.EINVAL,"Invalid FileMode object.")}}}readdir(t,e){try{e(null,this.readdirSync(t))}catch(t){e(t)}}readdirSync(t){const e=this._index.getInode(t);if(null===e)throw l.ENOENT(t);if(N(e))return e.getListing();throw l.ENOTDIR(t)}readFile(t,e,r,i){const n=i;this.open(t,r,420,function(t,r){if(t)return i(t);i=function(t,e){r.close(function(r){return t||(t=r),n(t,e)})};const s=r,o=s.getBuffer();null===e?i(t,d(o)):function(t,e,r){try{r(null,t.toString(e))}catch(t){r(t)}}(o,e,i)})}readFileSync(t,e,r){const i=this.openSync(t,r,420);try{const t=i,r=t.getBuffer();return null===e?d(r):r.toString(e)}finally{i.closeSync()}}_getHTTPPath(t){return"/"===t.charAt(0)&&(t=t.slice(1)),this.prefixUrl+t}_requestFileAsync(t,e,r){this._requestFileAsyncInternal(this._getHTTPPath(t),e,r)}_requestFileSync(t,e){return this._requestFileSyncInternal(this._getHTTPPath(t),e)}_requestFileSizeAsync(t,e){this._requestFileSizeAsyncInternal(this._getHTTPPath(t),e)}_requestFileSizeSync(t){return this._requestFileSizeSyncInternal(this._getHTTPPath(t))}}return T.Name="HTTPRequest",T.Options={index:{type:["string","object"],optional:!0,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_http_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:!0,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."},preferXHR:{type:"boolean",optional:!0,description:"Whether to prefer XmlHttpRequest or fetch for async operations if both are available. Default: false"}},T}),t("skylark-browserfs/generic/extended_ascii",[],function(){"use strict";class t{static str2byte(e,r){const i=e.length>r.length?r.length:e.length;for(let n=0;n<i;n++){let i=e.charCodeAt(n);if(i>127){const r=t.extendedChars.indexOf(e.charAt(n));r>-1&&(i=r+128)}r[i]=n}return i}static byte2str(e){const r=new Array(e.length);for(let i=0;i<e.length;i++){const n=e[i];r[i]=n>127?t.extendedChars[n-128]:String.fromCharCode(n)}return r.join("")}static byteLength(t){return t.length}}return t.extendedChars=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "],t}),t("skylark-browserfs/backend/ZipFS",["../core/api_error","../core/node_fs_stats","../core/file_system","../core/file_flag","../generic/preload_file","../core/util","../generic/extended_ascii","../generic/setImmediate","../generic/file_index"],function(t,e,r,i,n,s,o,a,c){"use strict";const{ApiError:h,ErrorCode:l}=t,{Stats:u,FileType:f}=e,{SynchronousFileSystem:d}=r,{ActionType:p}=i,{NoSyncFile:y}=n,{arrayish2Buffer:g,copyingSlice:m,bufferValidator:w}=s;let _;try{_=require("pako/lib/inflate").inflateRaw}catch(t){console.warn(t)}const{FileIndex:E,DirInode:S,FileInode:b,isDirInode:F,isFileInode:I}="../generic/file_index",k={};var N,O;function T(t,e){const r=31&e,i=(e>>5&15)-1,n=1980+(e>>9),s=31&t,o=t>>5&63,a=t>>11;return new Date(n,i,r,a,o,s)}function v(t,e,r,i){return 0===i?"":e?t.toString("utf8",r,r+i):o.byte2str(t.slice(r,r+i))}!function(t){t[t.MSDOS=0]="MSDOS",t[t.AMIGA=1]="AMIGA",t[t.OPENVMS=2]="OPENVMS",t[t.UNIX=3]="UNIX",t[t.VM_CMS=4]="VM_CMS",t[t.ATARI_ST=5]="ATARI_ST",t[t.OS2_HPFS=6]="OS2_HPFS",t[t.MAC=7]="MAC",t[t.Z_SYSTEM=8]="Z_SYSTEM",t[t.CP_M=9]="CP_M",t[t.NTFS=10]="NTFS",t[t.MVS=11]="MVS",t[t.VSE=12]="VSE",t[t.ACORN_RISC=13]="ACORN_RISC",t[t.VFAT=14]="VFAT",t[t.ALT_MVS=15]="ALT_MVS",t[t.BEOS=16]="BEOS",t[t.TANDEM=17]="TANDEM",t[t.OS_400=18]="OS_400",t[t.OSX=19]="OSX"}(N||(N={})),function(t){t[t.STORED=0]="STORED",t[t.SHRUNK=1]="SHRUNK",t[t.REDUCED_1=2]="REDUCED_1",t[t.REDUCED_2=3]="REDUCED_2",t[t.REDUCED_3=4]="REDUCED_3",t[t.REDUCED_4=5]="REDUCED_4",t[t.IMPLODE=6]="IMPLODE",t[t.DEFLATE=8]="DEFLATE",t[t.DEFLATE64=9]="DEFLATE64",t[t.TERSE_OLD=10]="TERSE_OLD",t[t.BZIP2=12]="BZIP2",t[t.LZMA=14]="LZMA",t[t.TERSE_NEW=18]="TERSE_NEW",t[t.LZ77=19]="LZ77",t[t.WAVPACK=97]="WAVPACK",t[t.PPMD=98]="PPMD"}(O||(O={}));class R{constructor(t){if(this.data=t,67324752!==t.readUInt32LE(0))throw new h(l.EINVAL,"Invalid Zip file: Local file header has invalid signature: "+this.data.readUInt32LE(0))}versionNeeded(){return this.data.readUInt16LE(4)}flags(){return this.data.readUInt16LE(6)}compressionMethod(){return this.data.readUInt16LE(8)}lastModFileTime(){return T(this.data.readUInt16LE(10),this.data.readUInt16LE(12))}rawLastModFileTime(){return this.data.readUInt32LE(10)}crc32(){return this.data.readUInt32LE(14)}fileNameLength(){return this.data.readUInt16LE(26)}extraFieldLength(){return this.data.readUInt16LE(28)}fileName(){return v(this.data,this.useUTF8(),30,this.fileNameLength())}extraField(){const t=30+this.fileNameLength();return this.data.slice(t,t+this.extraFieldLength())}totalSize(){return 30+this.fileNameLength()+this.extraFieldLength()}useUTF8(){return 2048==(2048&this.flags())}}class L{constructor(t,e,r){this.header=t,this.record=e,this.data=r}decompress(){const t=this.header.compressionMethod(),e=k[t];if(e)return e(this.data,this.record.compressedSize(),this.record.uncompressedSize(),this.record.flag());{let e=O[t];throw e||(e=`Unknown: ${t}`),new h(l.EINVAL,`Invalid compression method on file '${this.header.fileName()}': ${e}`)}}getHeader(){return this.header}getRecord(){return this.record}getRawData(){return this.data}}class A{constructor(t,e){if(this.zipData=t,this.data=e,33639248!==this.data.readUInt32LE(0))throw new h(l.EINVAL,`Invalid Zip file: Central directory record has invalid signature: ${this.data.readUInt32LE(0)}`);this._filename=this.produceFilename()}versionMadeBy(){return this.data.readUInt16LE(4)}versionNeeded(){return this.data.readUInt16LE(6)}flag(){return this.data.readUInt16LE(8)}compressionMethod(){return this.data.readUInt16LE(10)}lastModFileTime(){return T(this.data.readUInt16LE(12),this.data.readUInt16LE(14))}rawLastModFileTime(){return this.data.readUInt32LE(12)}crc32(){return this.data.readUInt32LE(16)}compressedSize(){return this.data.readUInt32LE(20)}uncompressedSize(){return this.data.readUInt32LE(24)}fileNameLength(){return this.data.readUInt16LE(28)}extraFieldLength(){return this.data.readUInt16LE(30)}fileCommentLength(){return this.data.readUInt16LE(32)}diskNumberStart(){return this.data.readUInt16LE(34)}internalAttributes(){return this.data.readUInt16LE(36)}externalAttributes(){return this.data.readUInt32LE(38)}headerRelativeOffset(){return this.data.readUInt32LE(42)}produceFilename(){const t=v(this.data,this.useUTF8(),46,this.fileNameLength());return t.replace(/\\/g,"/")}fileName(){return this._filename}rawFileName(){return this.data.slice(46,46+this.fileNameLength())}extraField(){const t=44+this.fileNameLength();return this.data.slice(t,t+this.extraFieldLength())}fileComment(){const t=46+this.fileNameLength()+this.extraFieldLength();return v(this.data,this.useUTF8(),t,this.fileCommentLength())}rawFileComment(){const t=46+this.fileNameLength()+this.extraFieldLength();return this.data.slice(t,t+this.fileCommentLength())}totalSize(){return 46+this.fileNameLength()+this.extraFieldLength()+this.fileCommentLength()}isDirectory(){const t=this.fileName();return!!(16&this.externalAttributes())||"/"===t.charAt(t.length-1)}isFile(){return!this.isDirectory()}useUTF8(){return 2048==(2048&this.flag())}isEncrypted(){return 1==(1&this.flag())}getFileData(){const t=this.headerRelativeOffset(),e=new R(this.zipData.slice(t));return new L(e,this,this.zipData.slice(t+e.totalSize()))}getData(){return this.getFileData().decompress()}getRawData(){return this.getFileData().getRawData()}getStats(){return new u(f.FILE,this.uncompressedSize(),365,Date.now(),this.lastModFileTime().getTime())}}class D{constructor(t){if(this.data=t,101010256!==this.data.readUInt32LE(0))throw new h(l.EINVAL,`Invalid Zip file: End of central directory record has invalid signature: ${this.data.readUInt32LE(0)}`)}diskNumber(){return this.data.readUInt16LE(4)}cdDiskNumber(){return this.data.readUInt16LE(6)}cdDiskEntryCount(){return this.data.readUInt16LE(8)}cdTotalEntryCount(){return this.data.readUInt16LE(10)}cdSize(){return this.data.readUInt32LE(12)}cdOffset(){return this.data.readUInt32LE(16)}cdZipCommentLength(){return this.data.readUInt16LE(20)}cdZipComment(){return v(this.data,!0,22,this.cdZipCommentLength())}rawCdZipComment(){return this.data.slice(22,22+this.cdZipCommentLength())}}class x{constructor(t,e,r,i){this.index=t,this.directoryEntries=e,this.eocd=r,this.data=i}}class P extends d{constructor(t,e=""){super(),this.name=e,this._index=new E,this._directoryEntries=[],this._eocd=null,this._index=t.index,this._directoryEntries=t.directoryEntries,this._eocd=t.eocd,this.data=t.data}static Create(t,e){try{P._computeIndex(t.zipData,(r,i)=>{if(i){const r=new P(i,t.name);e(null,r)}else e(r)})}catch(t){e(t)}}static isAvailable(){return!0}static RegisterDecompressionMethod(t,e){k[t]=e}static _getEOCD(t){const e=Math.min(65557,t.length-1);for(let r=22;r<e;r++)if(101010256===t.readUInt32LE(t.length-r))return new D(t.slice(t.length-r));throw new h(l.EINVAL,"Invalid ZIP file: Could not locate End of Central Directory signature.")}static _addToIndex(t,e){let r=t.fileName();if("/"===r.charAt(0))throw new h(l.EPERM,"Unexpectedly encountered an absolute path in a zip file. Please file a bug.");"/"===r.charAt(r.length-1)&&(r=r.substr(0,r.length-1)),t.isDirectory()?e.addPathFast("/"+r,new S(t)):e.addPathFast("/"+r,new b(t))}static _computeIndex(t,e){try{const r=new E,i=P._getEOCD(t);if(i.diskNumber()!==i.cdDiskNumber())return e(new h(l.EINVAL,"ZipFS does not support spanned zip files."));const n=i.cdOffset();if(4294967295===n)return e(new h(l.EINVAL,"ZipFS does not support Zip64."));const s=n+i.cdSize();P._computeIndexResponsive(t,r,n,s,e,[],i)}catch(t){e(t)}}static _computeIndexResponsiveTrampoline(t,e,r,i,n,s,o){try{P._computeIndexResponsive(t,e,r,i,n,s,o)}catch(t){n(t)}}static _computeIndexResponsive(t,e,r,i,n,s,o){if(r<i){let c=0;for(;c++<200&&r<i;){const i=new A(t,t.slice(r));P._addToIndex(i,e),r+=i.totalSize(),s.push(i)}a(()=>{P._computeIndexResponsiveTrampoline(t,e,r,i,n,s,o)})}else n(null,new x(e,s,o,t))}getName(){return P.Name+(""!==this.name?` ${this.name}`:"")}getCentralDirectoryEntry(t){const e=this._index.getInode(t);if(null===e)throw h.ENOENT(t);if(I(e))return e.getData();if(F(e))return e.getData();throw h.EPERM(`Invalid inode: ${e}`)}getCentralDirectoryEntryAt(t){const e=this._directoryEntries[t];if(!e)throw new RangeError(`Invalid directory index: ${t}.`);return e}getNumberOfCentralDirectoryEntries(){return this._directoryEntries.length}getEndOfCentralDirectory(){return this._eocd}diskSpace(t,e){e(this.data.length,0)}isReadOnly(){return!0}supportsLinks(){return!1}supportsProps(){return!1}supportsSynch(){return!0}statSync(t,e){const r=this._index.getInode(t);if(null===r)throw h.ENOENT(t);let i;if(I(r))i=r.getData().getStats();else{if(!F(r))throw new h(l.EINVAL,"Invalid inode.");i=r.getStats()}return i}openSync(t,e,r){if(e.isWriteable())throw new h(l.EPERM,t);const i=this._index.getInode(t);if(!i)throw h.ENOENT(t);if(!I(i))throw h.EISDIR(t);{const r=i.getData(),n=r.getStats();switch(e.pathExistsAction()){case p.THROW_EXCEPTION:case p.TRUNCATE_FILE:throw h.EEXIST(t);case p.NOP:return new y(this,t,e,n,r.getData());default:throw new h(l.EINVAL,"Invalid FileMode object.")}}}readdirSync(t){const e=this._index.getInode(t);if(e){if(F(e))return e.getListing();throw h.ENOTDIR(t)}throw h.ENOENT(t)}readFileSync(t,e,r){const i=this.openSync(t,r,420);try{const t=i,r=t.getBuffer();return null===e?m(r):r.toString(e)}finally{i.closeSync()}}}return P.Name="ZipFS",P.Options={zipData:{type:"object",description:"The zip file as a Buffer object.",validator:w},name:{type:"string",optional:!0,description:"The name of the zip file (optional)."}},P.CompressionMethod=O,P.RegisterDecompressionMethod(O.DEFLATE,(t,e,r)=>g(_(t.slice(0,e),{chunkSize:r}))),P.RegisterDecompressionMethod(O.STORED,(t,e,r)=>m(t,0,r)),P}),t("skylark-browserfs/backend/IsoFS",["../core/api_error","../core/node_fs_stats","../core/file_system","../core/file_flag","../generic/preload_file","../core/util","../libs/path"],function(t,e,r,i,n,s,o){"use strict";const{ApiError:a,ErrorCode:c}=t,{Stats:h,FileType:l}=e,{SynchronousFileSystem:u}=r,{ActionType:f}=i,{NoSyncFile:d}=n,{copyingSlice:p,bufferValidator:y}=s,g="IEEE_P1282";function m(t,e,r){return t.toString("ascii",e,e+r).trim()}function w(t,e,r){if(1===r)return String.fromCharCode(t[e]);const i=Math.floor(r/2),n=new Array(i);for(let r=0;r<i;r++){const i=e+(r<<1);n[r]=String.fromCharCode(t[i+1]|t[i]<<8)}return n.join("")}function _(t,e){const r=parseInt(m(t,e,4),10),i=parseInt(m(t,e+4,2),10),n=parseInt(m(t,e+6,2),10),s=parseInt(m(t,e+8,2),10),o=parseInt(m(t,e+10,2),10),a=parseInt(m(t,e+12,2),10),c=parseInt(m(t,e+14,2),10);return new Date(r,i,n,s,o,a,100*c)}function E(t,e){const r=t[e],i=t[e+1],n=t[e+2],s=t[e+3],o=t[e+4],a=t[e+5];return new Date(r,i-1,n,s,o,a)}function S(t,e){const r=t.slice(e),i=new R(r);switch(i.signatureWord()){case 17221:return new L(r);case 20548:return new A(r);case 21328:return new D(r);case 21332:return new x(r);case 17746:return new P(r);case 17747:return new C(r);case 20568:return new M(r);case 20558:return new B(r);case 21324:return new z(r);case 20045:return new V(r);case 17228:return new q(r);case 20556:return new H(r);case 21061:return new W(r);case 21574:return new $(r);case 21318:return new Y(r);case 21074:return new U(r);default:return i}}function b(t,e,r,i){r-=4;let n=new Array;for(;e<r;){const r=S(t,e),s=r.length();if(0===s)return n;if(e+=s,r instanceof x)break;r instanceof L?n=n.concat(r.getEntries(i)):n.push(r)}return n}class F{constructor(t){this._data=t}type(){return this._data[0]}standardIdentifier(){return m(this._data,1,5)}version(){return this._data[6]}data(){return this._data.slice(7,2048)}}class I extends F{constructor(t){super(t),this._root=null}systemIdentifier(){return this._getString32(8)}volumeIdentifier(){return this._getString32(40)}volumeSpaceSize(){return this._data.readUInt32LE(80)}volumeSetSize(){return this._data.readUInt16LE(120)}volumeSequenceNumber(){return this._data.readUInt16LE(124)}logicalBlockSize(){return this._data.readUInt16LE(128)}pathTableSize(){return this._data.readUInt32LE(132)}locationOfTypeLPathTable(){return this._data.readUInt32LE(140)}locationOfOptionalTypeLPathTable(){return this._data.readUInt32LE(144)}locationOfTypeMPathTable(){return this._data.readUInt32BE(148)}locationOfOptionalTypeMPathTable(){return this._data.readUInt32BE(152)}rootDirectoryEntry(t){return null===this._root&&(this._root=this._constructRootDirectoryRecord(this._data.slice(156)),this._root.rootCheckForRockRidge(t)),this._root}volumeSetIdentifier(){return this._getString(190,128)}publisherIdentifier(){return this._getString(318,128)}dataPreparerIdentifier(){return this._getString(446,128)}applicationIdentifier(){return this._getString(574,128)}copyrightFileIdentifier(){return this._getString(702,38)}abstractFileIdentifier(){return this._getString(740,36)}bibliographicFileIdentifier(){return this._getString(776,37)}volumeCreationDate(){return _(this._data,813)}volumeModificationDate(){return _(this._data,830)}volumeExpirationDate(){return _(this._data,847)}volumeEffectiveDate(){return _(this._data,864)}fileStructureVersion(){return this._data[881]}applicationUsed(){return this._data.slice(883,1395)}reserved(){return this._data.slice(1395,2048)}_getString32(t){return this._getString(t,32)}}class k extends I{constructor(t){if(super(t),1!==this.type())throw new a(c.EIO,"Invalid primary volume descriptor.")}name(){return"ISO9660"}_constructRootDirectoryRecord(t){return new T(t,-1)}_getString(t,e){return this._getString(t,e)}}class N extends I{constructor(t){if(super(t),2!==this.type())throw new a(c.EIO,"Invalid supplementary volume descriptor.");const e=this.escapeSequence(),r=e[2];if(37!==e[0]||47!==e[1]||64!==r&&67!==r&&69!==r)throw new a(c.EIO,`Unrecognized escape sequence for SupplementaryVolumeDescriptor: ${e.toString()}`)}name(){return"Joliet"}escapeSequence(){return this._data.slice(88,120)}_constructRootDirectoryRecord(t){return new v(t,-1)}_getString(t,e){return w(this._data,t,e)}}class O{constructor(t,e){this._suEntries=null,this._fileOrDir=null,this._data=t,this._rockRidgeOffset=e}hasRockRidge(){return this._rockRidgeOffset>-1}getRockRidgeOffset(){return this._rockRidgeOffset}rootCheckForRockRidge(t){const e=this.getDirectory(t);this._rockRidgeOffset=e.getDotEntry(t)._getRockRidgeOffset(t),this._rockRidgeOffset>-1&&(this._fileOrDir=null)}length(){return this._data[0]}extendedAttributeRecordLength(){return this._data[1]}lba(){return 2048*this._data.readUInt32LE(2)}dataLength(){return this._data.readUInt32LE(10)}recordingDate(){return E(this._data,18)}fileFlags(){return this._data[25]}fileUnitSize(){return this._data[26]}interleaveGapSize(){return this._data[27]}volumeSequenceNumber(){return this._data.readUInt16LE(28)}identifier(){return this._getString(33,this._data[32])}fileName(t){if(this.hasRockRidge()){const e=this._rockRidgeFilename(t);if(null!==e)return e}const e=this.identifier();if(this.isDirectory(t))return e;const r=e.indexOf(";");return-1===r?e:"."===e[r-1]?e.slice(0,r-1):e.slice(0,r)}isDirectory(t){let e=!!(2&this.fileFlags());return!e&&this.hasRockRidge()&&(e=this.getSUEntries(t).filter(t=>t instanceof q).length>0),e}isSymlink(t){return this.hasRockRidge()&&this.getSUEntries(t).filter(t=>t instanceof z).length>0}getSymlinkPath(t){let e="";const r=this.getSUEntries(t),i=this._getGetString();for(const t of r)if(t instanceof z){const r=t.componentRecords();for(const t of r){const r=t.flags();2&r?e+="./":4&r?e+="../":8&r?e+="/":(e+=t.content(i),1&r||(e+="/"))}if(!t.continueFlag())break}return e.length>1&&"/"===e[e.length-1]?e.slice(0,e.length-1):e}getFile(t){if(this.isDirectory(t))throw new Error("Tried to get a File from a directory.");return null===this._fileOrDir&&(this._fileOrDir=t.slice(this.lba(),this.lba()+this.dataLength())),this._fileOrDir}getDirectory(t){if(!this.isDirectory(t))throw new Error("Tried to get a Directory from a file.");return null===this._fileOrDir&&(this._fileOrDir=this._constructDirectory(t)),this._fileOrDir}getSUEntries(t){return this._suEntries||this._constructSUEntries(t),this._suEntries}_rockRidgeFilename(t){const e=this.getSUEntries(t).filter(t=>t instanceof V);if(0===e.length||6&e[0].flags())return null;let r="";const i=this._getGetString();for(const t of e)if(r+=t.name(i),!(1&t.flags()))break;return r}_constructSUEntries(t){let e=33+this._data[32];e%2==1&&e++,e+=this._rockRidgeOffset,this._suEntries=b(this._data,e,this.length(),t)}_getRockRidgeOffset(t){this._rockRidgeOffset=0;const e=this.getSUEntries(t);if(e.length>0){const t=e[0];if(t instanceof D&&t.checkBytesPass())for(let r=1;r<e.length;r++){const i=e[r];if(i instanceof U||i instanceof P&&i.extensionIdentifier()===g)return t.bytesSkipped()}}return this._rockRidgeOffset=-1,-1}}class T extends O{constructor(t,e){super(t,e)}_getString(t,e){return m(this._data,t,e)}_constructDirectory(t){return new J(this,t)}_getGetString(){return m}}class v extends O{constructor(t,e){super(t,e)}_getString(t,e){return w(this._data,t,e)}_constructDirectory(t){return new Z(this,t)}_getGetString(){return w}}class R{constructor(t){this._data=t}signatureWord(){return this._data.readUInt16BE(0)}signatureWordString(){return m(this._data,0,2)}length(){return this._data[2]}suVersion(){return this._data[3]}}class L extends R{constructor(t){super(t),this._entries=null}continuationLba(){return this._data.readUInt32LE(4)}continuationLbaOffset(){return this._data.readUInt32LE(12)}continuationLength(){return this._data.readUInt32LE(20)}getEntries(t){if(!this._entries){const e=2048*this.continuationLba()+this.continuationLbaOffset();this._entries=b(t,e,this.continuationLength(),t)}return this._entries}}class A extends R{constructor(t){super(t)}}class D extends R{constructor(t){super(t)}checkBytesPass(){return 190===this._data[4]&&239===this._data[5]}bytesSkipped(){return this._data[6]}}class x extends R{constructor(t){super(t)}}class P extends R{constructor(t){super(t)}identifierLength(){return this._data[4]}descriptorLength(){return this._data[5]}sourceLength(){return this._data[6]}extensionVersion(){return this._data[7]}extensionIdentifier(){return m(this._data,8,this.identifierLength())}extensionDescriptor(){return m(this._data,8+this.identifierLength(),this.descriptorLength())}extensionSource(){return m(this._data,8+this.identifierLength()+this.descriptorLength(),this.sourceLength())}}class C extends R{constructor(t){super(t)}extensionSequence(){return this._data[4]}}class U extends R{constructor(t){super(t)}}class M extends R{constructor(t){super(t)}mode(){return this._data.readUInt32LE(4)}fileLinks(){return this._data.readUInt32LE(12)}uid(){return this._data.readUInt32LE(20)}gid(){return this._data.readUInt32LE(28)}inode(){return this._data.readUInt32LE(36)}}class B extends R{constructor(t){super(t)}devTHigh(){return this._data.readUInt32LE(4)}devTLow(){return this._data.readUInt32LE(12)}}class z extends R{constructor(t){super(t)}flags(){return this._data[4]}continueFlag(){return 1&this.flags()}componentRecords(){const t=new Array;let e=5;for(;e<this.length();){const r=new j(this._data.slice(e));t.push(r),e+=r.length()}return t}}class j{constructor(t){this._data=t}flags(){return this._data[0]}length(){return 2+this.componentLength()}componentLength(){return this._data[1]}content(t){return t(this._data,2,this.componentLength())}}class V extends R{constructor(t){super(t)}flags(){return this._data[4]}name(t){return t(this._data,5,this.length()-5)}}class q extends R{constructor(t){super(t)}childDirectoryLba(){return this._data.readUInt32LE(4)}}class H extends R{constructor(t){super(t)}parentDirectoryLba(){return this._data.readUInt32LE(4)}}class W extends R{constructor(t){super(t)}}class $ extends R{constructor(t){super(t)}flags(){return this._data[4]}creation(){return 1&this.flags()?this._longFormDates()?_(this._data,5):E(this._data,5):null}modify(){if(2&this.flags()){const t=1&this.flags()?1:0;return this._longFormDates?_(this._data,5+17*t):E(this._data,5+7*t)}return null}access(){if(4&this.flags()){let t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,this._longFormDates?_(this._data,5+17*t):E(this._data,5+7*t)}return null}backup(){if(16&this.flags()){let t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,t+=4&this.flags()?1:0,this._longFormDates?_(this._data,5+17*t):E(this._data,5+7*t)}return null}expiration(){if(32&this.flags()){let t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,t+=4&this.flags()?1:0,t+=16&this.flags()?1:0,this._longFormDates?_(this._data,5+17*t):E(this._data,5+7*t)}return null}effective(){if(64&this.flags()){let t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,t+=4&this.flags()?1:0,t+=16&this.flags()?1:0,t+=32&this.flags()?1:0,this._longFormDates?_(this._data,5+17*t):E(this._data,5+7*t)}return null}_longFormDates(){return!!this.flags()}}class Y extends R{constructor(t){super(t)}virtualSizeHigh(){return this._data.readUInt32LE(4)}virtualSizeLow(){return this._data.readUInt32LE(12)}tableDepth(){return this._data[20]}}class X{constructor(t,e){this._fileList=[],this._fileMap={},this._record=t;let r=t.lba(),i=r+t.dataLength();if(!(2&t.fileFlags())){const n=t.getSUEntries(e).filter(t=>t instanceof q)[0];r=2048*n.childDirectoryLba(),i=1/0}for(;r<i;){const t=e[r];if(0===t){r++;continue}const n=this._constructDirectoryRecord(e.slice(r)),s=n.fileName(e);"\0"!==s&&""!==s?n.hasRockRidge()&&0!==n.getSUEntries(e).filter(t=>t instanceof W).length||(this._fileMap[s]=n,this._fileList.push(s)):i===1/0&&(i=r+n.dataLength()),r+=n.length()}}getRecord(t){return this._fileMap[t]}getFileList(){return this._fileList}getDotEntry(t){return this._constructDirectoryRecord(t.slice(this._record.lba()))}}class J extends X{constructor(t,e){super(t,e)}_constructDirectoryRecord(t){return new T(t,this._record.getRockRidgeOffset())}}class Z extends X{constructor(t,e){super(t,e)}_constructDirectoryRecord(t){return new v(t,this._record.getRockRidgeOffset())}}class K extends u{constructor(t,e=""){super(),this._data=t;let r=!1,i=32768;const n=new Array;for(;!r;){const e=t.slice(i),s=new F(e);switch(s.type()){case 1:n.push(new k(e));break;case 2:n.push(new N(e));break;case 255:r=!0}i+=2048}if(0===n.length)throw new a(c.EIO,"Unable to find a suitable volume descriptor.");n.forEach(t=>{this._pvd&&2===this._pvd.type()||(this._pvd=t)}),this._root=this._pvd.rootDirectoryEntry(t),this._name=e}static Create(t,e){try{e(null,new K(t.data,t.name))}catch(t){e(t)}}static isAvailable(){return!0}getName(){let t=`IsoFS${this._name}${this._pvd?`-${this._pvd.name()}`:""}`;return this._root&&this._root.hasRockRidge()&&(t+="-RockRidge"),t}diskSpace(t,e){e(this._data.length,0)}isReadOnly(){return!0}supportsLinks(){return!1}supportsProps(){return!1}supportsSynch(){return!0}statSync(t,e){const r=this._getDirectoryRecord(t);if(null===r)throw a.ENOENT(t);return this._getStats(t,r)}openSync(t,e,r){if(e.isWriteable())throw new a(c.EPERM,t);const i=this._getDirectoryRecord(t);if(!i)throw a.ENOENT(t);if(i.isSymlink(this._data))return this.openSync(o.resolve(t,i.getSymlinkPath(this._data)),e,r);if(i.isDirectory(this._data))throw a.EISDIR(t);{const r=i.getFile(this._data),n=this._getStats(t,i);switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:throw a.EEXIST(t);case f.NOP:return new d(this,t,e,n,r);default:throw new a(c.EINVAL,"Invalid FileMode object.")}}}readdirSync(t){const e=this._getDirectoryRecord(t);if(e){if(e.isDirectory(this._data))return e.getDirectory(this._data).getFileList().slice(0);throw a.ENOTDIR(t)}throw a.ENOENT(t)}readFileSync(t,e,r){const i=this.openSync(t,r,420);try{const t=i,r=t.getBuffer();return null===e?p(r):r.toString(e)}finally{i.closeSync()}}_getDirectoryRecord(t){if("/"===t)return this._root;const e=t.split("/").slice(1);let r=this._root;for(const t of e){if(!r.isDirectory(this._data))return null;if(!(r=r.getDirectory(this._data).getRecord(t)))return null}return r}_getStats(t,e){if(e.isSymlink(this._data)){const r=o.resolve(t,e.getSymlinkPath(this._data)),i=this._getDirectoryRecord(r);return i?this._getStats(r,i):null}{const t=e.dataLength();let r=365;const i=e.recordingDate().getTime();let n=i,s=i,o=i;if(e.hasRockRidge()){const t=e.getSUEntries(this._data);for(const e of t)if(e instanceof M)r=e.mode();else if(e instanceof $){const t=e.flags();4&t&&(n=e.access().getTime()),2&t&&(s=e.modify().getTime()),1&t&&(o=e.creation().getTime())}}return r&=365,new h(e.isDirectory(this._data)?l.DIRECTORY:l.FILE,t,r,n,s,o)}}}return K.Name="IsoFS",K.Options={data:{type:"object",description:"The ISO file in a buffer",validator:y}},K}),t("skylark-browserfs/core/backends",["./util","../backend/AsyncMirror","../backend/Dropbox","../backend/Emscripten","../backend/FolderAdapter","../backend/HTML5FS","../backend/InMemory","../backend/IndexedDB","../backend/LocalStorage","../backend/MountableFileSystem","../backend/OverlayFS","../backend/WorkerFS","../backend/HTTPRequest","../backend/ZipFS","../backend/IsoFS"],function(t,e,r,i,n,s,o,a,c,h,l,u,f,d,p){"use strict";const{checkOptions:y}=t;[e,r,i,n,s,o,a,p,c,h,l,u,f,d].forEach(t=>{const e=t.Create;t.Create=function(r,i){const n="function"==typeof r,s=n?r:i,o=n?{}:r;y(t,o,function(r){r?s(r):e.call(t,o,s)})}});const g={AsyncMirror:e,Dropbox:r,Emscripten:i,FolderAdapter:n,HTML5FS:s,InMemory:o,IndexedDB:a,IsoFS:p,LocalStorage:c,MountableFileSystem:h,OverlayFS:l,WorkerFS:u,HTTPRequest:f,XmlHttpRequest:f,ZipFS:d};return g}),t("skylark-browserfs/core/browserfs",["../libs/process","../libs/buffers","./node_fs","../libs/path","../generic/emscripten_fs","./backends","./util","./api_error","../generic/setImmediate"],function(t,e,r,i,n,s,o,a,c){"use strict";const{Buffer:h}=e;function l(module){switch(module){case"fs":return r;case"path":return i;case"buffer":return buffer;case"process":return t;case"bfs_utils":return o;default:return s[module]}}function u(t){return r.initialize(t)}function f(t,e){const r=t.fs;if(!r)return e(new a.ApiError(a.ErrorCode.EPERM,'Missing "fs" property on configuration object.'));const i=t.options;let n=0,o=!1;function c(){if(!o){o=!0;const t=s[r];t?t.Create(i,e):e(new a.ApiError(a.ErrorCode.EPERM,`File system ${r} is not available in BrowserFS.`))}}if(null!==i&&"object"==typeof i){let t=!1;const r=Object.keys(i).filter(t=>"fs"!==t);r.forEach(r=>{const s=i[r];null!==s&&"object"==typeof s&&s.fs&&(n++,f(s,function(s,a){if(n--,s){if(o)return;o=!0,e(s)}else i[r]=a,0===n&&t&&c()}))}),t=!0}0===n&&c()}return t.initializeTTYs&&t.initializeTTYs(),{install:function(e){e.Buffer=h,e.process=t;const r=e.require?e.require:null;e.require=function(t){const e=l(t);return e||r.apply(null,Array.prototype.slice.call(arguments,0))}},registerFileSystem:function(t,e){s[t]=e},BFSRequire:l,initialize:u,configure:function(t,e){f(t,(t,r)=>{r?(u(r),e()):e(t)})},getFileSystem:f,EmscriptenFS:n,FileSystem:s,Errors:a,setImmediate:c}}),t("skylark-browserfs/main",["./core/browserfs"],function(t){return t}),t("skylark-browserfs",["skylark-browserfs/main"],function(t){return t})}(r,require),!i){var o=require("skylark-langx-ns");n?module.exports=o:e.skylarkjs=o}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-browserfs.js.map
